<html>

<head>
	<style>
		body {
            background-color: #E0E1E2 !important;
            -webkit-app-region:drag !important;
        }

		th {
            background: #767676 !important;
			color: white !important;
		}

		div.barFrame {
			user-select: none;
			display:block;
			position:fixed;
			top:0;
			width:100%;
			height: 50px;
		}

		div.dataFrame {
			-webkit-app-region:no-drag;
			position:fixed;
			top:40px;
      margin-top: 8px; 
      padding:4px;
      overflow-x: hidden; 
      overflow-x: auto; 
      text-align:justify;
			overflow-y:scroll;
			height: 94vh;
			width: 100%;
        }
  
        .item_found {
      background: yellow;
      color: black;
    }

    .highlighted
        {
            background-color: yellow;
        }
        .highlight
        {
            background-color: #fff34d;
            -moz-border-radius: 5px; /* FF1+ */
            -webkit-border-radius: 5px; /* Saf3-4 */
            border-radius: 5px; /* Opera 10.5, IE 9, Saf5, Chrome */
            -moz-box-shadow: 0 1px 4px rgba(0, 0, 0, 0.7); /* FF3.5+ */
            -webkit-box-shadow: 0 1px 4px rgba(0, 0, 0, 0.7); /* Saf3.0+, Chrome */
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.7); /* Opera 10.5+, IE 9.0 */
        }
        .highlight
        {
            padding: 1px 4px;
            margin: 0 -4px;
        }
	</style>
	<script type="text/javascript">
		window.$ = window.jQuery = require('jquery');
	</script>
	<link rel="stylesheet" type="text/css" href="../src/frameworks/semantic/semantic.css">
	<script src="../src/frameworks/semantic/semantic.js"></script>
    <link rel="stylesheet" type="text/css" href="../src/screen.css">
</head>

<body>
	<div class="container-fluid">
		<div class="barFrame">
			<div style="background-color: #E0E1E2 !important;" class="ui top attached menu">
				<button style="background: none;" class="ui icon button">
					<i class="book dead icon"></i>
				  </button>
				  <p style="margin-top: 12px;">JS Docs</p>
				<div class="right menu">
          <div style="-webkit-app-region: no-drag; color: #676768;" class="ui action input">
            <input id="FridaDocSearch" type="text" placeholder="Search">
            <button class="ui button" onclick="docSearch()">Search</button>
          </div>
					<div class="ui dropdown icon item">
						<a id="CloseDevice" style="-webkit-app-region: no-drag; color: #676768;" class="flex items-center pl-3 py-3 pr-2 text-gray-50 hover:bg-gray-100 rounded" href="#">
							<span class="inline-block mr-3">
							  <i class="x icon"></i></span>
						  </a>
					</div>
				</div>
			</div>
		</div>

		<div id="DataContainer" class="dataFrame">
			<!--Window Content-->
            <h2 id="table-of-contents">Table of contents</h2>

<ol>
  <li><strong>Runtime information</strong>
    <ol>
      <li><a href="#frida">Frida</a></li>
      <li><a href="#script">Script</a></li>
    </ol>
  </li>
  <li><strong>Process, Thread, Module and Memory</strong>
    <ol>
      <li><a href="#thread">Thread</a></li>
      <li><a href="#process">Process</a></li>
      <li><a href="#module">Module</a></li>
      <li><a href="#modulemap">ModuleMap</a></li>
      <li><a href="#memory">Memory</a></li>
      <li><a href="#memoryaccessmonitor">MemoryAccessMonitor</a></li>
      <li><a href="#cmodule">CModule</a></li>
      <li><a href="#apiresolver">ApiResolver</a></li>
      <li><a href="#debugsymbol">DebugSymbol</a></li>
      <li><a href="#kernel">Kernel</a></li>
    </ol>
  </li>
  <li><strong>Data Types, Function and Callback</strong>
    <ol>
      <li><a href="#int64">Int64</a></li>
      <li><a href="#uint64">UInt64</a></li>
      <li><a href="#nativepointer">NativePointer</a></li>
      <li><a href="#arraybuffer">ArrayBuffer</a></li>
      <li><a href="#nativefunction">NativeFunction</a></li>
      <li><a href="#nativecallback">NativeCallback</a></li>
      <li><a href="#systemfunction">SystemFunction</a></li>
    </ol>
  </li>
  <li><strong>Network</strong>
    <ol>
      <li><a href="#socket">Socket</a></li>
      <li><a href="#socketlistener">SocketListener</a></li>
      <li><a href="#socketconnection">SocketConnection</a></li>
    </ol>
  </li>
  <li><strong>File and Stream</strong>
    <ol>
      <li><a href="#file">File</a></li>
      <li><a href="#iostream">IOStream</a></li>
      <li><a href="#inputstream">InputStream</a></li>
      <li><a href="#outputstream">OutputStream</a></li>
      <li><a href="#unixinputstream">UnixInputStream</a></li>
      <li><a href="#unixoutputstream">UnixOutputStream</a></li>
      <li><a href="#win32inputstream">Win32InputStream</a></li>
      <li><a href="#win32outputstream">Win32OutputStream</a></li>
    </ol>
  </li>
  <li><strong>Database</strong>
    <ol>
      <li><a href="#sqlitedatabase">SqliteDatabase</a></li>
      <li><a href="#sqlitestatement">SqliteStatement</a></li>
    </ol>
  </li>
  <li><strong>Instrumentation</strong>
    <ol>
      <li><a href="#interceptor">Interceptor</a></li>
      <li><a href="#stalker">Stalker</a></li>
      <li><a href="#objc">ObjC</a></li>
      <li><a href="#java">Java</a></li>
    </ol>
  </li>
  <li><strong>CPU Instruction</strong>
    <ol>
      <li><a href="#instruction">Instruction</a></li>
      <li><a href="#x86writer">X86Writer</a></li>
      <li><a href="#x86relocator">X86Relocator</a></li>
      <li><a href="#x86-enum-types">x86 enum types</a></li>
      <li><a href="#armwriter">ArmWriter</a></li>
      <li><a href="#armrelocator">ArmRelocator</a></li>
      <li><a href="#thumbwriter">ThumbWriter</a></li>
      <li><a href="#thumbrelocator">ThumbRelocator</a></li>
      <li><a href="#arm-enum-types">ARM enum types</a></li>
      <li><a href="#arm64writer">Arm64Writer</a></li>
      <li><a href="#arm64relocator">Arm64Relocator</a></li>
      <li><a href="#aarch64-enum-types">AArch64 enum types</a></li>
      <li><a href="#mipswriter">MipsWriter</a></li>
      <li><a href="#mipsrelocator">MipsRelocator</a></li>
      <li><a href="#mips-enum-types">MIPS enum types</a></li>
    </ol>
  </li>
  <li><strong>Other</strong>
    <ol>
      <li><a href="#console">Console</a></li>
      <li><a href="#hexdump">Hexdump</a></li>
      <li><a href="#shorthand">Shorthand</a></li>
      <li><a href="#communication-between-host-and-injected-process">Communication between host and injected process</a></li>
      <li><a href="#timing-events">Timing events</a></li>
      <li><a href="#garbage-collection">Garbage collection</a></li>
    </ol>
  </li>
</ol>

<hr />

<h2 id="runtime-information">Runtime information</h2>

<h3 id="frida">Frida</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Frida.version</code>: property containing the current Frida version, as a string.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Frida.heapSize</code>: dynamic property containing the current size of Frida’s
private heap, shared by all scripts and Frida’s own runtime. This is useful
for keeping an eye on how much memory your instrumentation is using out of
the total consumed by the hosting process.</p>
  </li>
</ul>

<h3 id="script">Script</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Script.runtime</code>: string property containing the runtime being used.
Either <code class="language-plaintext highlighter-rouge">QJS</code> or <code class="language-plaintext highlighter-rouge">V8</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Script.pin()</code>: temporarily prevents the current script from being unloaded.
This is reference-counted, so there must be one matching <em>unpin()</em> happening
at a later point. Typically used in the callback of <em>bindWeak()</em> when you
need to schedule cleanup on another thread.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Script.unpin()</code>: reverses a previous <em>pin()</em> so the current script may be
unloaded.</p>
  </li>
  <li>
    <p id="bindweak"><code class="language-plaintext highlighter-rouge">Script.bindWeak(value, fn)</code>: monitors <code class="language-plaintext highlighter-rouge">value</code> and calls the <code class="language-plaintext highlighter-rouge">fn</code> callback
as soon as <code class="language-plaintext highlighter-rouge">value</code> has been garbage-collected, or the script is about to get
unloaded. Returns an ID that you can pass to <a href="#unbindweak"><code class="language-plaintext highlighter-rouge">Script.unbindWeak()</code></a>
for explicit cleanup.</p>

    <p>This API is useful if you’re building a language-binding, where you need to
free native resources when a JS value is no longer needed.</p>
  </li>
  <li>
    <p id="unbindweak"><code class="language-plaintext highlighter-rouge">Script.unbindWeak(id)</code>: stops monitoring the value passed to
<code class="language-plaintext highlighter-rouge">Script.bindWeak(value, fn)</code>, and call the <code class="language-plaintext highlighter-rouge">fn</code> callback immediately.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Script.setGlobalAccessHandler(handler | null)</code>: installs or uninstalls a
handler that is used to resolve attempts to access non-existent global
variables. Useful for implementing a REPL where unknown identifiers may be
fetched lazily from a database.</p>

    <p>The <code class="language-plaintext highlighter-rouge">handler</code> is an object containing two properties:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">enumerate()</code>: queries which additional globals exist. Must return an
               array of strings.</li>
      <li><code class="language-plaintext highlighter-rouge">get(property)</code>: retrieves the value for the given property.</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="process-thread-module-and-memory">Process, Thread, Module and Memory</h2>

<h3 id="thread">Thread</h3>

<ul>
  <li>
    <p id="thread-backtrace"><code class="language-plaintext highlighter-rouge">Thread.backtrace([context, backtracer])</code>: generate a backtrace for the
current thread, returned as an array of <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> objects.</p>

    <p>If you call this from Interceptor’s <a href="#interceptor-onenter"><code class="language-plaintext highlighter-rouge">onEnter</code></a> or
<a href="#interceptor-onleave"><code class="language-plaintext highlighter-rouge">onLeave</code></a> callbacks you
should provide <code class="language-plaintext highlighter-rouge">this.context</code> for the optional <code class="language-plaintext highlighter-rouge">context</code> argument, as it
will give you a more accurate backtrace. Omitting <code class="language-plaintext highlighter-rouge">context</code> means the
backtrace will be generated from the current stack location, which may
not give you a very good backtrace due to the JavaScript VM’s stack frames.
The optional <code class="language-plaintext highlighter-rouge">backtracer</code> argument specifies the kind of backtracer to use,
and must be either <code class="language-plaintext highlighter-rouge">Backtracer.FUZZY</code> or <code class="language-plaintext highlighter-rouge">Backtracer.ACCURATE</code>, where the
latter is the default if not specified. The accurate kind of backtracers
rely on debugger-friendly binaries or presence of debug information to do a
good job, whereas the fuzzy backtracers perform forensics on the stack in
order to guess the return addresses, which means you will get false
positives, but it will work on any binary.</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">Module</span><span class="p">.</span><span class="nx">getExportByName</span><span class="p">(</span><span class="dl">'</span><span class="s1">libcommonCrypto.dylib</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">CCCryptorCreate</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">onEnter</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">CCCryptorCreate called from:</span><span class="se">\n</span><span class="dl">'</span> <span class="o">+</span>
        <span class="nx">Thread</span><span class="p">.</span><span class="nx">backtrace</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="nx">Backtracer</span><span class="p">.</span><span class="nx">ACCURATE</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">DebugSymbol</span><span class="p">.</span><span class="nx">fromAddress</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">)</span> <span class="o">+</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Thread.sleep(delay)</code>: suspend execution of the current thread for <code class="language-plaintext highlighter-rouge">delay</code>
seconds specified as a number. For example 0.05 to sleep for 50 ms.</li>
</ul>

<h3 id="process">Process</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Process.id</code>: property containing the PID as a number</p>
  </li>
  <li>
    <p id="process-arch"><code class="language-plaintext highlighter-rouge">Process.arch</code>: property containing the string <code class="language-plaintext highlighter-rouge">ia32</code>, <code class="language-plaintext highlighter-rouge">x64</code>, <code class="language-plaintext highlighter-rouge">arm</code>
or <code class="language-plaintext highlighter-rouge">arm64</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Process.platform</code>: property containing the string <code class="language-plaintext highlighter-rouge">windows</code>,
<code class="language-plaintext highlighter-rouge">darwin</code>, <code class="language-plaintext highlighter-rouge">linux</code> or <code class="language-plaintext highlighter-rouge">qnx</code></p>
  </li>
  <li>
    <p id="process-pagesize"><code class="language-plaintext highlighter-rouge">Process.pageSize</code>: property containing the size of a virtual memory page
(in bytes) as a number. This is used to make your scripts more portable.</p>
  </li>
  <li>
    <p id="process-pointersize"><code class="language-plaintext highlighter-rouge">Process.pointerSize</code>: property containing the size of a pointer
(in bytes) as a number. This is used to make your scripts more portable.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Process.codeSigningPolicy</code>: property containing the string <code class="language-plaintext highlighter-rouge">optional</code> or
<code class="language-plaintext highlighter-rouge">required</code>, where the latter means Frida will avoid modifying existing code
in memory and will not try to run unsigned code. Currently this property
will always be set to <code class="language-plaintext highlighter-rouge">optional</code> unless you are using <strong><a href="/docs/gadget">Gadget</a></strong>
and have configured it to assume that code-signing is required. This
property allows you to determine whether the <strong><a href="#interceptor">Interceptor</a></strong> API
is off limits, and whether it is safe to modify code or run unsigned code.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Process.isDebuggerAttached()</code>: returns a boolean indicating whether a
debugger is currently attached</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Process.getCurrentThreadId()</code>: get this thread’s OS-specific id as a number</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Process.enumerateThreads()</code>: enumerates all threads, returning an array of
objects containing the following properties:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">id</code>: OS-specific id</li>
      <li><code class="language-plaintext highlighter-rouge">state</code>: string specifying either <code class="language-plaintext highlighter-rouge">running</code>, <code class="language-plaintext highlighter-rouge">stopped</code>, <code class="language-plaintext highlighter-rouge">waiting</code>,
<code class="language-plaintext highlighter-rouge">uninterruptible</code> or <code class="language-plaintext highlighter-rouge">halted</code></li>
      <li><code class="language-plaintext highlighter-rouge">context</code>: object with the keys <code class="language-plaintext highlighter-rouge">pc</code> and <code class="language-plaintext highlighter-rouge">sp</code>, which are
<strong><a href="#nativepointer">NativePointer</a></strong> objects specifying EIP/RIP/PC and
ESP/RSP/SP, respectively, for ia32/x64/arm. Other processor-specific keys
are also available, e.g. <code class="language-plaintext highlighter-rouge">eax</code>, <code class="language-plaintext highlighter-rouge">rax</code>, <code class="language-plaintext highlighter-rouge">r0</code>, <code class="language-plaintext highlighter-rouge">x0</code>, etc.</li>
    </ul>
  </li>
  <li>
    <p id="process-getmodulebyname"><code class="language-plaintext highlighter-rouge">Process.findModuleByAddress(address)</code>,
<code class="language-plaintext highlighter-rouge">Process.getModuleByAddress(address)</code>,
<code class="language-plaintext highlighter-rouge">Process.findModuleByName(name)</code>,
<code class="language-plaintext highlighter-rouge">Process.getModuleByName(name)</code>:
returns a <strong><a href="#module">Module</a></strong> whose <em>address</em> or <em>name</em> matches the one
specified. In the event that no such module could be found, the
<em>find</em>-prefixed functions return <em>null</em> whilst the <em>get</em>-prefixed functions
throw an exception.</p>
  </li>
  <li>
    <p id="process-enumeratemodules"><code class="language-plaintext highlighter-rouge">Process.enumerateModules()</code>: enumerates modules loaded right now, returning
an array of <strong><a href="#module">Module</a></strong> objects.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Process.findRangeByAddress(address)</code>, <code class="language-plaintext highlighter-rouge">getRangeByAddress(address)</code>:
return an object with details about the range containing <em>address</em>. In the
event that no such range could be found, <em>findRangeByAddress()</em> returns
<em>null</em> whilst <em>getRangeByAddress()</em> throws an exception.  See
<a href="#process-enumerateranges"><code class="language-plaintext highlighter-rouge">Process.enumerateRanges()</code></a> for details about which
fields are included.</p>
  </li>
  <li>
    <p id="process-enumerateranges"><code class="language-plaintext highlighter-rouge">Process.enumerateRanges(protection|specifier)</code>: enumerates memory ranges
satisfying <code class="language-plaintext highlighter-rouge">protection</code> given as a string of the form: <code class="language-plaintext highlighter-rouge">rwx</code>, where <code class="language-plaintext highlighter-rouge">rw-</code>
means “must be at least readable and writable”. Alternatively you may
provide a <code class="language-plaintext highlighter-rouge">specifier</code> object with a <code class="language-plaintext highlighter-rouge">protection</code> key whose value is as
aforementioned, and a <code class="language-plaintext highlighter-rouge">coalesce</code> key set to <code class="language-plaintext highlighter-rouge">true</code> if you’d like neighboring
ranges with the same protection to be coalesced (the default is <code class="language-plaintext highlighter-rouge">false</code>;
i.e. keeping the ranges separate). Returns an array of objects containing
the following properties:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">base</code>: base address as a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a></li>
      <li><code class="language-plaintext highlighter-rouge">size</code>: size in bytes</li>
      <li><code class="language-plaintext highlighter-rouge">protection</code>: protection string (see above)</li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">file</code>: (when available) file mapping details as an object
containing:</p>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">path</code>: full filesystem path as a string</li>
          <li><code class="language-plaintext highlighter-rouge">offset</code>: offset in the mapped file on disk, in bytes</li>
          <li><code class="language-plaintext highlighter-rouge">size</code>: size in the mapped file on disk, in bytes</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Process.enumerateMallocRanges()</code>: just like <a href="#process-enumerateranges"><code class="language-plaintext highlighter-rouge">enumerateRanges()</code></a>,
but for individual memory allocations known to the system heap.</p>
  </li>
  <li>
    <p id="process-setexceptionhandler"><code class="language-plaintext highlighter-rouge">Process.setExceptionHandler(callback)</code>: install a process-wide exception
handler callback that gets a chance to handle native exceptions before the
hosting process itself does. Called with a single argument, <code class="language-plaintext highlighter-rouge">details</code>, that
is an object containing:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">type</code>: string specifying one of:
        <ul>
          <li>abort</li>
          <li>access-violation</li>
          <li>guard-page</li>
          <li>illegal-instruction</li>
          <li>stack-overflow</li>
          <li>arithmetic</li>
          <li>breakpoint</li>
          <li>single-step</li>
          <li>system</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">address</code>: address where the exception occurred, as a <strong><a href="#nativepointer">NativePointer</a></strong></li>
      <li><code class="language-plaintext highlighter-rouge">memory</code>: if present, is an object containing:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">operation</code>: the kind of operation that triggered the exception, as
a string specifying either <code class="language-plaintext highlighter-rouge">read</code>, <code class="language-plaintext highlighter-rouge">write</code>, or <code class="language-plaintext highlighter-rouge">execute</code></li>
          <li><code class="language-plaintext highlighter-rouge">address</code>: address that was accessed when the exception occurred, as
a <strong><a href="#nativepointer">NativePointer</a></strong></li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">context</code>: object with the keys <code class="language-plaintext highlighter-rouge">pc</code> and <code class="language-plaintext highlighter-rouge">sp</code>, which are
<strong><a href="#nativepointer">NativePointer</a></strong> objects specifying EIP/RIP/PC and
ESP/RSP/SP, respectively, for ia32/x64/arm. Other processor-specific keys
are also available, e.g. <code class="language-plaintext highlighter-rouge">eax</code>, <code class="language-plaintext highlighter-rouge">rax</code>, <code class="language-plaintext highlighter-rouge">r0</code>, <code class="language-plaintext highlighter-rouge">x0</code>, etc.
You may also update register values by assigning to these keys.</li>
      <li><code class="language-plaintext highlighter-rouge">nativeContext</code>: address of the OS and architecture-specific CPU context
struct, as a <strong><a href="#nativepointer">NativePointer</a></strong>. This is only exposed as a
last resort for edge-cases where <code class="language-plaintext highlighter-rouge">context</code> isn’t providing enough details. We
would however discourage using this and rather submit a pull-request to add
the missing bits needed for your use-case.</li>
    </ul>

    <p>It is up to your callback to decide what to do with the exception. It could
log the issue, notify your application through a <strong><a href="#communication-send">send()</a></strong>
followed by a blocking recv() for acknowledgement of the sent data being received,
or it can modify registers and memory to recover from the exception. You should
return <code class="language-plaintext highlighter-rouge">true</code> if you did handle the exception, in which case Frida will
resume the thread immediately. If you do not return <code class="language-plaintext highlighter-rouge">true</code>, Frida will
forward the exception to the hosting process’ exception handler, if it has
one, or let the OS terminate the process.</p>
  </li>
</ul>

<h3 id="module">Module</h3>

<p>Objects returned by e.g. <a href="#module-load"><code class="language-plaintext highlighter-rouge">Module.load()</code></a> and <a href="#process-enumeratemodules"><code class="language-plaintext highlighter-rouge">Process.enumerateModules()</code></a>.<br /><br /></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">name</code>: canonical module name as a string</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">base</code>: base address as a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">size</code>: size in bytes</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">path</code>: full filesystem path as a string</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">enumerateImports()</code>: enumerates imports of module, returning an array of
objects containing the following properties:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">type</code>: string specifying either <code class="language-plaintext highlighter-rouge">function</code> or <code class="language-plaintext highlighter-rouge">variable</code></li>
      <li><code class="language-plaintext highlighter-rouge">name</code>: import name as a string</li>
      <li><code class="language-plaintext highlighter-rouge">module</code>: module name as a string</li>
      <li><code class="language-plaintext highlighter-rouge">address</code>: absolute address as a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a></li>
      <li><code class="language-plaintext highlighter-rouge">slot</code>: memory location where the import is stored, as a
<a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a></li>
    </ul>

    <p>Only the <code class="language-plaintext highlighter-rouge">name</code> field is guaranteed to be present for all imports. The
platform-specific backend will do its best to resolve the other fields
even beyond what the native metadata provides, but there is no guarantee
that it will succeed.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">enumerateExports()</code>: enumerates exports of module, returning an array
of objects containing the following properties:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">type</code>: string specifying either <code class="language-plaintext highlighter-rouge">function</code> or <code class="language-plaintext highlighter-rouge">variable</code></li>
      <li><code class="language-plaintext highlighter-rouge">name</code>: export name as a string</li>
      <li><code class="language-plaintext highlighter-rouge">address</code>: absolute address as a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a></li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">enumerateSymbols()</code>: enumerates symbols of module, returning an array of
objects containing the following properties:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">isGlobal</code>: boolean specifying whether symbol is globally visible</li>
      <li><code class="language-plaintext highlighter-rouge">type</code>: string specifying one of:
        <ul>
          <li>unknown</li>
          <li>section</li>
          <li>undefined (Mach-O)</li>
          <li>absolute (Mach-O)</li>
          <li>prebound-undefined (Mach-O)</li>
          <li>indirect (Mach-O)</li>
          <li>object (ELF)</li>
          <li>function (ELF)</li>
          <li>file (ELF)</li>
          <li>common (ELF)</li>
          <li>tls (ELF)</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">section</code>: if present, is an object containing:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">id</code>: string containing section index, segment name (if
      applicable) and section name – same format as
      <a href="https://radare.org/r/">r2</a>’s section IDs</li>
          <li><code class="language-plaintext highlighter-rouge">protection</code>: protection like in <a href="#process-enumerateranges"><code class="language-plaintext highlighter-rouge">Process.enumerateRanges()</code></a></li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">name</code>: symbol name as a string</li>
      <li><code class="language-plaintext highlighter-rouge">address</code>: absolute address as a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a></li>
      <li><code class="language-plaintext highlighter-rouge">size</code>: if present, a number specifying the symbol’s size in bytes</li>
    </ul>
  </li>
</ul>

<div class="note info">
  <h5>enumerateSymbols() is only available on i/macOS and Linux-based OSes</h5>
  <p>
    We would love to support this on the other platforms too, so if you find
    this useful and would like to help out, please get in touch. You may also
    find the <strong><a href="#debugsymbol">DebugSymbol</a></strong> API adequate, depending on your use-case.
  </p>
</div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">enumerateRanges(protection)</code>: just like <a href="#process-enumerateranges"><code class="language-plaintext highlighter-rouge">Process.enumerateRanges</code></a>,
except it’s scoped to the module.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">findExportByName(exportName)</code>,
<code class="language-plaintext highlighter-rouge">getExportByName(exportName)</code>: returns the absolute address of the export
named <code class="language-plaintext highlighter-rouge">exportName</code>. In the event that no such export could be found, the
<em>find</em>-prefixed function returns <em>null</em> whilst the <em>get</em>-prefixed function
throws an exception.</p>
  </li>
  <li>
    <p id="module-load"><code class="language-plaintext highlighter-rouge">Module.load(path)</code>: loads the specified module from the filesystem path
and returns a <a href="#module"><code class="language-plaintext highlighter-rouge">Module</code></a> object. Throws an exception if the specified
module cannot be loaded.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Module.ensureInitialized(name)</code>: ensures that initializers of the specified
module have been run. This is important during early instrumentation, i.e.
code run early in the process lifetime, to be able to safely interact with
APIs. One such use-case is interacting with <strong><a href="#objc">ObjC</a></strong> classes provided
by a given module.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Module.findBaseAddress(name)</code>,
<code class="language-plaintext highlighter-rouge">Module.getBaseAddress(name)</code>: returns the base address of the <code class="language-plaintext highlighter-rouge">name</code>
module. In the event that no such module could be found, the <em>find</em>-prefixed
function returns <em>null</em> whilst the <em>get</em>-prefixed function throws an
exception.</p>
  </li>
  <li>
    <p id="module-getexportbyname"><code class="language-plaintext highlighter-rouge">Module.findExportByName(moduleName|null, exportName)</code>,
<code class="language-plaintext highlighter-rouge">Module.getExportByName(moduleName|null, exportName)</code>: returns the absolute
address of the export named <code class="language-plaintext highlighter-rouge">exportName</code> in <code class="language-plaintext highlighter-rouge">moduleName</code>. If the module
isn’t known you may pass <code class="language-plaintext highlighter-rouge">null</code> instead of its name, but this can be a
costly search and should be avoided. In the event that no such module or
export could be found, the <em>find</em>-prefixed function returns <em>null</em> whilst
the <em>get</em>-prefixed function throws an exception.</p>
  </li>
</ul>

<h3 id="modulemap">ModuleMap</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new ModuleMap([filter])</code>: create a new module map optimized for determining
which module a given memory address belongs to, if any. Takes a snapshot of
the currently loaded modules when created, which may be refreshed by calling
<a href="#modulemap-update"><code class="language-plaintext highlighter-rouge">update()</code></a>. The <code class="language-plaintext highlighter-rouge">filter</code> argument is optional and allows
you to pass a function used for filtering the list of modules. This is useful if
you e.g. only care about modules owned by the application itself, and allows you
to quickly check if an address belongs to one of its modules. The <code class="language-plaintext highlighter-rouge">filter</code>
function is passed a <strong><a href="#module">Module</a></strong> object and must return <code class="language-plaintext highlighter-rouge">true</code> for
each module that should be kept in the map. It is called for each loaded
module every time the map is updated.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">has(address)</code>: check if <code class="language-plaintext highlighter-rouge">address</code> belongs to any of the contained modules,
and returns the result as a boolean</p>
  </li>
  <li>
    <p id="modulemap-find"><code class="language-plaintext highlighter-rouge">find(address)</code>, <code class="language-plaintext highlighter-rouge">get(address)</code>: returns a <strong><a href="#module">Module</a></strong> with details
about the module that <code class="language-plaintext highlighter-rouge">address</code> belongs to. In the event that no such module
could be found, <code class="language-plaintext highlighter-rouge">find()</code> returns <code class="language-plaintext highlighter-rouge">null</code> whilst <code class="language-plaintext highlighter-rouge">get()</code> throws an exception.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">findName(address)</code>,
<code class="language-plaintext highlighter-rouge">getName(address)</code>,
<code class="language-plaintext highlighter-rouge">findPath(address)</code>,
<code class="language-plaintext highlighter-rouge">getPath(address)</code>:
just like <a href="#modulemap-find"><code class="language-plaintext highlighter-rouge">find()</code></a> and <a href="#modulemap-find"><code class="language-plaintext highlighter-rouge">get()</code></a>, but only
returns the <code class="language-plaintext highlighter-rouge">name</code> or <code class="language-plaintext highlighter-rouge">path</code> field, which means less overhead when you don’t need
the other details.</p>
  </li>
  <li>
    <p id="modulemap-update"><code class="language-plaintext highlighter-rouge">update()</code>: update the map. You should call this after a module has been
loaded or unloaded to avoid operating on stale data.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">values()</code>: returns an array with the <strong><a href="#module">Module</a></strong> objects currently in
the map. The returned array is a deep copy and will not mutate after a call
to <a href="#modulemap-update"><code class="language-plaintext highlighter-rouge">update()</code></a>.</p>
  </li>
</ul>

<h3 id="memory">Memory</h3>

<ul>
  <li>
    <p id="memory-scan"><code class="language-plaintext highlighter-rouge">Memory.scan(address, size, pattern, callbacks)</code>: scan memory for
occurrences of <code class="language-plaintext highlighter-rouge">pattern</code> in the memory range given by <code class="language-plaintext highlighter-rouge">address</code> and <code class="language-plaintext highlighter-rouge">size</code>.</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">pattern</code> must be of the form “13 37 ?? ff” to match 0x13 followed by
0x37 followed by any byte followed by 0xff.
For more advanced matching it is also possible to specify an
<a href="https://radare.org/r/">r2</a>-style mask. The mask is bitwise AND-ed against both the needle
and the haystack. To specify the mask append a <code class="language-plaintext highlighter-rouge">:</code> character after the
needle, followed by the mask using the same syntax.
For example: “13 37 13 37 : 1f ff ff f1”.
For convenience it is also possible to specify nibble-level wildcards,
like “?3 37 13 ?7”, which gets translated into masks behind the scenes.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">callbacks</code> is an object with:</p>

        <ul>
          <li>
            <p><code class="language-plaintext highlighter-rouge">onMatch(address, size)</code>: called with <code class="language-plaintext highlighter-rouge">address</code> containing the
address of the occurence as a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> and
<code class="language-plaintext highlighter-rouge">size</code> specifying the size as a number.</p>

            <p>This function may return the string <code class="language-plaintext highlighter-rouge">stop</code> to cancel the memory
scanning early.</p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">onError(reason)</code>: called with <code class="language-plaintext highlighter-rouge">reason</code> when there was a memory
access error while scanning</p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">onComplete()</code>: called when the memory range has been fully scanned</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Memory.scanSync(address, size, pattern)</code>: synchronous version of <a href="#memory-scan"><code class="language-plaintext highlighter-rouge">scan()</code></a>
that returns an array of objects containing the following properties:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">address</code>: absolute address as a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a>.</li>
      <li><code class="language-plaintext highlighter-rouge">size</code>: size in bytes</li>
    </ul>

    <p>For example:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// Find the module for the program itself, always at index 0:</span>
<span class="kd">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="nx">Process</span><span class="p">.</span><span class="nx">enumerateModules</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>

<span class="c1">// Or load a module by name:</span>
<span class="c1">//const m = Module.load('win32u.dll');</span>

<span class="c1">// Print its properties:</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">m</span><span class="p">));</span>

<span class="c1">// Dump it from its base address:</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">hexdump</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">base</span><span class="p">));</span>

<span class="c1">// The pattern that you are interested in:</span>
<span class="kd">const</span> <span class="nx">pattern</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">00 00 00 00 ?? 13 37 ?? 42</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">Memory</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">onMatch</span><span class="p">(</span><span class="nx">address</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Memory.scan() found match at</span><span class="dl">'</span><span class="p">,</span> <span class="nx">address</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">with size</span><span class="dl">'</span><span class="p">,</span> <span class="nx">size</span><span class="p">);</span>

    <span class="c1">// Optionally stop scanning early:</span>
    <span class="k">return</span> <span class="dl">'</span><span class="s1">stop</span><span class="dl">'</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">onComplete</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Memory.scan() complete</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="nx">Memory</span><span class="p">.</span><span class="nx">scanSync</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Memory.scanSync() result:</span><span class="se">\n</span><span class="dl">'</span> <span class="o">+</span>
    <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">));</span></code></pre></figure>

<ul>
  <li>
    <p id="memory-alloc"><code class="language-plaintext highlighter-rouge">Memory.alloc(size[, options])</code>: allocate <code class="language-plaintext highlighter-rouge">size</code> bytes of memory on the
heap, or, if <code class="language-plaintext highlighter-rouge">size</code> is a multiple of
<a href="#process-pagesize"><code class="language-plaintext highlighter-rouge">Process.pageSize</code></a>, one or more raw memory pages
managed by the OS. When using page granularity you may also specify an
<code class="language-plaintext highlighter-rouge">options</code> object if you need the memory allocated close to a given address,
by specifying <code class="language-plaintext highlighter-rouge">{ near: address, maxDistance: distanceInBytes }</code>.
The returned value is a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> and the underlying
memory will be released when all JavaScript handles to it are gone. This
means you need to keep a reference to it while the pointer is being used by
code outside the JavaScript runtime.</p>
  </li>
  <li>
    <p id="memory-copy"><code class="language-plaintext highlighter-rouge">Memory.copy(dst, src, n)</code>: just like memcpy(). Returns nothing.</p>

    <ul>
      <li>dst: a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> specifying the destination base address.</li>
      <li>src: a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> specifying the source base address.</li>
      <li>n: size in bytes to be copied.</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Memory.dup(address, size)</code>: short-hand for <a href="#memory-alloc"><code class="language-plaintext highlighter-rouge">Memory.alloc()</code></a>
followed by <a href="#memory-copy"><code class="language-plaintext highlighter-rouge">Memory.copy()</code></a>. Returns a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a>
containing the base address of the freshly allocated memory. See <a href="#memory-copy"><code class="language-plaintext highlighter-rouge">Memory.copy()</code></a>
for details on the memory allocation’s lifetime.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Memory.protect(address, size, protection)</code>: update protection on a region
of memory, where <code class="language-plaintext highlighter-rouge">protection</code> is a string of the same format as
<a href="#process-enumerateranges"><code class="language-plaintext highlighter-rouge">Process.enumerateRanges()</code></a>.</p>

    <p>Returns a boolean indicating whether the operation completed successfully.</p>

    <p>For example:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Memory</span><span class="p">.</span><span class="nx">protect</span><span class="p">(</span><span class="nx">ptr</span><span class="p">(</span><span class="dl">'</span><span class="s1">0x1234</span><span class="dl">'</span><span class="p">),</span> <span class="mi">4096</span><span class="p">,</span> <span class="dl">'</span><span class="s1">rw-</span><span class="dl">'</span><span class="p">);</span></code></pre></figure>

<ul>
  <li>
    <p id="memory-patchcode"><code class="language-plaintext highlighter-rouge">Memory.patchCode(address, size, apply)</code>: safely modify <code class="language-plaintext highlighter-rouge">size</code> bytes at
<code class="language-plaintext highlighter-rouge">address</code>, specified as a <strong><a href="#nativepointer">NativePointer</a></strong>. The supplied
JavaScript function <code class="language-plaintext highlighter-rouge">apply</code> gets called with a writable pointer where you must
write the desired modifications before returning. Do not make any assumptions
about this being the same location as <code class="language-plaintext highlighter-rouge">address</code>, as some systems require
modifications to be written to a temporary location before being mapped into
memory on top of the original memory page (e.g. on iOS, where directly modifying
in-memory code may result in the process losing its CS_VALID status).</p>

    <p>For example:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">getLivesLeft</span> <span class="o">=</span> <span class="nx">Module</span><span class="p">.</span><span class="nx">getExportByName</span><span class="p">(</span><span class="dl">'</span><span class="s1">game-engine.so</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">get_lives_left</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">maxPatchSize</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span> <span class="c1">// Do not write out of bounds, may be a temporary buffer!</span>
<span class="nx">Memory</span><span class="p">.</span><span class="nx">patchCode</span><span class="p">(</span><span class="nx">getLivesLeft</span><span class="p">,</span> <span class="nx">maxPatchSize</span><span class="p">,</span> <span class="nx">code</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">cw</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">X86Writer</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="p">{</span> <span class="na">pc</span><span class="p">:</span> <span class="nx">getLivesLeft</span> <span class="p">});</span>
  <span class="nx">cw</span><span class="p">.</span><span class="nx">putMovRegU32</span><span class="p">(</span><span class="dl">'</span><span class="s1">eax</span><span class="dl">'</span><span class="p">,</span> <span class="mi">9000</span><span class="p">);</span>
  <span class="nx">cw</span><span class="p">.</span><span class="nx">putRet</span><span class="p">();</span>
  <span class="nx">cw</span><span class="p">.</span><span class="nx">flush</span><span class="p">();</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Memory.allocUtf8String(str)</code>,
<code class="language-plaintext highlighter-rouge">Memory.allocUtf16String(str)</code>,
<code class="language-plaintext highlighter-rouge">Memory.allocAnsiString(str)</code>:
allocate, encode and write out <code class="language-plaintext highlighter-rouge">str</code> as a UTF-8/UTF-16/ANSI string on the
heap. The returned object is a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a>. See
<a href="#memory-alloc"><code class="language-plaintext highlighter-rouge">Memory.alloc()</code></a> for details about its lifetime.</li>
</ul>

<h3 id="memoryaccessmonitor">MemoryAccessMonitor</h3>

<ul>
  <li>
    <p id="memoryaccessmonitor-enable"><code class="language-plaintext highlighter-rouge">MemoryAccessMonitor.enable(ranges, callbacks)</code>: monitor one or more memory
ranges for access, and notify on the first access of each contained memory
page. <code class="language-plaintext highlighter-rouge">ranges</code> is either a single range object or an array of such objects,
each of which contains:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">base</code>: base address as a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a></li>
      <li><code class="language-plaintext highlighter-rouge">size</code>: size in bytes</li>
    </ul>

    <p><code class="language-plaintext highlighter-rouge">callbacks</code> is an object specifying:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">onAccess(details)</code>: called synchronously with <code class="language-plaintext highlighter-rouge">details</code> object
containing:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">operation</code>: the kind of operation that triggered the access, as a
string specifying either <code class="language-plaintext highlighter-rouge">read</code>, <code class="language-plaintext highlighter-rouge">write</code>, or <code class="language-plaintext highlighter-rouge">execute</code></li>
          <li><code class="language-plaintext highlighter-rouge">from</code>: address of instruction performing the access as a
<a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a></li>
          <li><code class="language-plaintext highlighter-rouge">address</code>: address being accessed as a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a></li>
          <li><code class="language-plaintext highlighter-rouge">rangeIndex</code>: index of the accessed range in the ranges provided to
<code class="language-plaintext highlighter-rouge">MemoryAccessMonitor.enable()</code></li>
          <li><code class="language-plaintext highlighter-rouge">pageIndex</code>: index of the accessed memory page inside the specified
range</li>
          <li><code class="language-plaintext highlighter-rouge">pagesCompleted</code>: overall number of pages which have been accessed
so far (and are no longer being monitored)</li>
          <li><code class="language-plaintext highlighter-rouge">pagesTotal</code>: overall number of pages that were initially monitored</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">MemoryAccessMonitor.disable()</code>: stop monitoring the remaining memory ranges
passed to <a href="#memoryaccessmonitor-enable"><code class="language-plaintext highlighter-rouge">MemoryAccessMonitor.enable()</code></a>.</p>
  </li>
</ul>

<h3 id="cmodule">CModule</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new CModule(code[, symbols, options])</code>: creates a new C module from the
provided <code class="language-plaintext highlighter-rouge">code</code>, either a string containing the C source code to compile, or
an ArrayBuffer containing a precompiled shared library. The C module gets
mapped into memory and becomes fully accessible to JavaScript.</p>

    <p>Useful for implementing hot callbacks, e.g. for <strong><a href="#interceptor">Interceptor</a></strong>
and <strong><a href="#stalker">Stalker</a></strong>, but also useful when needing to start new threads
in order to call functions in a tight loop, e.g. for fuzzing purposes.</p>

    <p>Global functions are automatically exported as <strong><a href="#nativepointer">NativePointer</a></strong>
properties named exactly like in the C source code. This means you can pass them
to <strong><a href="#interceptor">Interceptor</a></strong> and <strong><a href="#stalker">Stalker</a></strong>, or call them
using <strong><a href="#nativepointer">NativePointer</a></strong>.</p>

    <p>In addition to accessing a curated subset of Gum, GLib, and standard C APIs,
the code being mapped in can also communicate with JavaScript through the
<code class="language-plaintext highlighter-rouge">symbols</code> exposed to it. This is the optional second argument, an object
specifying additional symbol names and their
<strong><a href="#nativepointer">NativePointer</a></strong> values, each of which will be plugged in
at creation. This may for example be one or more memory blocks allocated
using <strong><a href="#memory-alloc">Memory.alloc()</a></strong>, and/or
<strong><a href="#nativecallback">NativeCallback</a></strong> values for receiving callbacks from
the C module.</p>

    <p>To perform initialization and cleanup, you may define functions with the
following names and signatures:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">void init (void)</code></li>
      <li><code class="language-plaintext highlighter-rouge">void finalize (void)</code></li>
    </ul>

    <p>Note that all data is read-only, so writable globals should be declared
<em>extern</em>, allocated using e.g. <strong><a href="#memory-alloc">Memory.alloc()</a></strong>, and passed
in as symbols through the constructor’s second argument.</p>

    <p>The optional third argument, <code class="language-plaintext highlighter-rouge">options</code>, is an object that may be used to
specify which toolchain to use, e.g.: <code class="language-plaintext highlighter-rouge">{ toolchain: 'external' }</code>. Supported
values are:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">internal</code>: use TinyCC, which is statically linked into the runtime.
Never touches the filesystem and works even in sandboxed processes. The
generated code is however not optimized, as TinyCC optimizes for small
compiler footprint and short compilation times.</li>
      <li><code class="language-plaintext highlighter-rouge">external</code>: use toolchain provided by the target system, assuming it is
accessible to the process we’re executing inside.</li>
      <li><code class="language-plaintext highlighter-rouge">any</code>: same as <code class="language-plaintext highlighter-rouge">internal</code> if <a href="#process-arch"><code class="language-plaintext highlighter-rouge">Process.arch</code></a> is
supported by TinyCC, and <code class="language-plaintext highlighter-rouge">external</code> otherwise. This is the default
behavior if left unspecified.</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dispose()</code>: eagerly unmaps the module from memory. Useful for short-lived
modules when waiting for a future garbage collection isn’t desirable.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">builtins</code>: an object specifying builtins present when constructing a
CModule from C source code. This is typically used by a scaffolding tool
such as <code class="language-plaintext highlighter-rouge">frida-create</code> in order to set up a build environment that matches
what CModule uses. The exact contents depends on the
<a href="#process-arch"><code class="language-plaintext highlighter-rouge">Process.arch</code></a> and Frida version, but may look something
like the following:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  defines: {
    'GLIB_SIZEOF_VOID_P': '8',
    'G_GINT16_MODIFIER': '"h"',
    'G_GINT32_MODIFIER': '""',
    'G_GINT64_MODIFIER': '"ll"',
    'G_GSIZE_MODIFIER': '"l"',
    'G_GSSIZE_MODIFIER': '"l"',
    'HAVE_I386': true
  },
  headers: {
    'gum/arch-x86/gumx86writer.h': '…',
    'gum/gumdefs.h': '…',
    'gum/guminterceptor.h': '…',
    'gum/gummemory.h': '…',
    'gum/gummetalarray.h': '…',
    'gum/gummetalhash.h': '…',
    'gum/gummodulemap.h': '…',
    'gum/gumprocess.h': '…',
    'gum/gumspinlock.h': '…',
    'gum/gumstalker.h': '…',
    'glib.h': '…',
    'json-glib/json-glib.h': '…',
    'capstone.h': '…'
  }
}
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="examples">Examples</h4>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">cm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CModule</span><span class="p">(</span><span class="s2">`
#include &lt;stdio.h&gt;

void hello(void) {
  printf("Hello World from CModule\\n");
}
`</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">cm</span><span class="p">));</span>

<span class="kd">const</span> <span class="nx">hello</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NativeFunction</span><span class="p">(</span><span class="nx">cm</span><span class="p">.</span><span class="nx">hello</span><span class="p">,</span> <span class="dl">'</span><span class="s1">void</span><span class="dl">'</span><span class="p">,</span> <span class="p">[]);</span>
<span class="nx">hello</span><span class="p">();</span></code></pre></figure>

<p>Which you might load using Frida’s REPL:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>frida <span class="nt">-p</span> 0 <span class="nt">-l</span> example.js</code></pre></figure>

<p>(The REPL monitors the file on disk and reloads the script on change.)</p>

<p>You can then type <code class="language-plaintext highlighter-rouge">hello()</code> in the REPL to call the C function.</p>

<p>For prototyping we recommend using the Frida REPL’s built-in CModule support:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>frida <span class="nt">-p</span> 0 <span class="nt">-C</span> example.c</code></pre></figure>

<p>You may also add <code class="language-plaintext highlighter-rouge">-l example.js</code> to load some JavaScript next to it.
The JavaScript code may use the global variable named <code class="language-plaintext highlighter-rouge">cm</code> to access
the CModule object, but only after <a href="#rpc-exports"><code class="language-plaintext highlighter-rouge">rpc.exports.init()</code></a> has been
called, so perform any initialization depending on the CModule there. You may
also inject symbols by assigning to the global object named <code class="language-plaintext highlighter-rouge">cs</code>, but this
must be done <em>before</em> <a href="#rpc-exports"><code class="language-plaintext highlighter-rouge">rpc.exports.init()</code></a> gets called.</p>

<p>More details on CModule can be found in the <strong><a href="/news/2019/09/18/frida-12-7-released/">Frida 12.7 release notes</a></strong>.</p>

<h3 id="apiresolver">ApiResolver</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new ApiResolver(type)</code>: create a new resolver of the given <code class="language-plaintext highlighter-rouge">type</code>, allowing
you to quickly find functions by name, with globs permitted. Precisely which
resolvers are available depends on the current platform and runtimes loaded
in the current process. As of the time of writing, the available resolvers
are:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">module</code>: Resolves exported and imported functions of shared libraries
          currently loaded. Always available.</li>
      <li><code class="language-plaintext highlighter-rouge">objc</code>: Resolves Objective-C methods of classes currently loaded.
        Available on macOS and iOS in processes that have the Objective-C
        runtime loaded. Use <a href="#objc-available"><code class="language-plaintext highlighter-rouge">ObjC.available</code></a> to check at
        runtime, or wrap your <code class="language-plaintext highlighter-rouge">new ApiResolver('objc')</code> call in a <em>try-catch</em>.</li>
    </ul>

    <p>The resolver will load the minimum amount of data required on creation, and
lazy-load the rest depending on the queries it receives. It is thus
recommended to use the same instance for a batch of queries, but recreate it
for future batches to avoid looking at stale data.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">enumerateMatches(query)</code>: performs the resolver-specific <code class="language-plaintext highlighter-rouge">query</code> string,
optionally suffixed with <code class="language-plaintext highlighter-rouge">/i</code> to perform case-insensitive matching,
returning an array of objects containing the following properties:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">name</code>: name of the API that was found</li>
      <li><code class="language-plaintext highlighter-rouge">address</code>: address as a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a></li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">resolver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ApiResolver</span><span class="p">(</span><span class="dl">'</span><span class="s1">module</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nx">resolver</span><span class="p">.</span><span class="nx">enumerateMatches</span><span class="p">(</span><span class="dl">'</span><span class="s1">exports:*!open*</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">first</span> <span class="o">=</span> <span class="nx">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="cm">/*
 * Where `first` is an object similar to:
 *
 * {
 *   name: '/usr/lib/libSystem.B.dylib!opendir$INODE64',
 *   address: ptr('0x7fff870135c9')
 * }
 */</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">resolver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ApiResolver</span><span class="p">(</span><span class="dl">'</span><span class="s1">objc</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nx">resolver</span><span class="p">.</span><span class="nx">enumerateMatches</span><span class="p">(</span><span class="dl">'</span><span class="s1">-[NSURL* *HTTP*]</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">first</span> <span class="o">=</span> <span class="nx">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="cm">/*
 * Where `first` contains an object like this one:
 *
 * {
 *   name: '-[NSURLRequest valueForHTTPHeaderField:]',
 *   address: ptr('0x7fff94183e22')
 * }
 */</span></code></pre></figure>

<h3 id="debugsymbol">DebugSymbol</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">DebugSymbol.fromAddress(address)</code>, <code class="language-plaintext highlighter-rouge">DebugSymbol.fromName(name)</code>:
look up debug information for <code class="language-plaintext highlighter-rouge">address</code>/<code class="language-plaintext highlighter-rouge">name</code> and return it as an object
containing:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">address</code>: Address that this symbol is for, as a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a>.</li>
      <li><code class="language-plaintext highlighter-rouge">name</code>: Name of the symbol, as a string, or null if unknown.</li>
      <li><code class="language-plaintext highlighter-rouge">moduleName</code>: Module name owning this symbol, as a string, or null if
              unknown.</li>
      <li><code class="language-plaintext highlighter-rouge">fileName</code>: File name owning this symbol, as a string, or null if
            unknown.</li>
      <li><code class="language-plaintext highlighter-rouge">lineNumber</code>: Line number in <code class="language-plaintext highlighter-rouge">fileName</code>, as a number, or null if
              unknown.</li>
    </ul>

    <p>You may also call <code class="language-plaintext highlighter-rouge">toString()</code> on it, which is very useful when combined
with <a href="#thread-backtrace"><code class="language-plaintext highlighter-rouge">Thread.backtrace()</code></a>:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">Module</span><span class="p">.</span><span class="nx">getExportByName</span><span class="p">(</span><span class="dl">'</span><span class="s1">libcommonCrypto.dylib</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">CCCryptorCreate</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">onEnter</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">CCCryptorCreate called from:</span><span class="se">\n</span><span class="dl">'</span> <span class="o">+</span>
        <span class="nx">Thread</span><span class="p">.</span><span class="nx">backtrace</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="nx">Backtracer</span><span class="p">.</span><span class="nx">ACCURATE</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">DebugSymbol</span><span class="p">.</span><span class="nx">fromAddress</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">)</span> <span class="o">+</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">DebugSymbol.getFunctionByName(name)</code>: resolves a function name and
returns its address as a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a>. Returns the first if
more than one function is found. Throws an exception if the name cannot be
resolved.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">DebugSymbol.findFunctionsNamed(name)</code>: resolves a function name and returns
its addresses as an array of <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> objects.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">DebugSymbol.findFunctionsMatching(glob)</code>: resolves function names matching
<code class="language-plaintext highlighter-rouge">glob</code> and returns their addresses as an array of <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a>
objects.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">DebugSymbol.load(path)</code>: loads debug symbols for a specific module.</p>
  </li>
</ul>

<h3 id="kernel">Kernel</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Kernel.available</code>: a boolean specifying whether the Kernel API is
available. Do not invoke any other <code class="language-plaintext highlighter-rouge">Kernel</code> properties or methods unless
this is the case.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Kernel.base</code>: base address of the kernel, as a <strong><a href="#uint64">UInt64</a></strong>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Kernel.pageSize</code>: size of a kernel page in bytes, as a number.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Kernel.enumerateModules()</code>: enumerates kernel modules loaded right now,
returning an array of objects containing the following properties:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">name</code>: canonical module name as a string</li>
      <li><code class="language-plaintext highlighter-rouge">base</code>: base address as a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a></li>
      <li><code class="language-plaintext highlighter-rouge">size</code>: size in bytes</li>
    </ul>
  </li>
  <li>
    <p id="kernel-enumerateranges"><code class="language-plaintext highlighter-rouge">Kernel.enumerateRanges(protection|specifier)</code>: enumerate kernel memory
ranges satisfying <code class="language-plaintext highlighter-rouge">protection</code> given as a string of the form: <code class="language-plaintext highlighter-rouge">rwx</code>, where
<code class="language-plaintext highlighter-rouge">rw-</code> means “must be at least readable and writable”. Alternatively you may
provide a <code class="language-plaintext highlighter-rouge">specifier</code> object with a <code class="language-plaintext highlighter-rouge">protection</code> key whose value is as
aforementioned, and a <code class="language-plaintext highlighter-rouge">coalesce</code> key set to <code class="language-plaintext highlighter-rouge">true</code> if you’d like neighboring
ranges with the same protection to be coalesced (the default is <code class="language-plaintext highlighter-rouge">false</code>;
i.e. keeping the ranges separate). Returns an array of objects containing
the following properties:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">base</code>: base address as a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a></li>
      <li><code class="language-plaintext highlighter-rouge">size</code>: size in bytes</li>
      <li><code class="language-plaintext highlighter-rouge">protection</code>: protection string (see above)</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Kernel.enumerateModuleRanges(name, protection)</code>: just like
<a href="#kernel-enumerateranges"><code class="language-plaintext highlighter-rouge">Kernel.enumerateRanges</code></a>, except it’s scoped to the
specified module <code class="language-plaintext highlighter-rouge">name</code> – which may be <code class="language-plaintext highlighter-rouge">null</code> for the module of the kernel
itself. Each range also has a <code class="language-plaintext highlighter-rouge">name</code> field containing a unique identifier as a
string.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Kernel.alloc(size)</code>: allocate <code class="language-plaintext highlighter-rouge">size</code> bytes of kernel memory, rounded up to
a multiple of the kernel’s page size. The returned value is a <a href="#uint64"><code class="language-plaintext highlighter-rouge">UInt64</code></a>
specifying the base address of the allocation.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Kernel.protect(address, size, protection)</code>: update protection on a region
of kernel memory, where <code class="language-plaintext highlighter-rouge">protection</code> is a string of the same format as
<a href="#kernel-enumerateranges"><code class="language-plaintext highlighter-rouge">Kernel.enumerateRanges()</code></a>.</p>

    <p>For example:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Kernel</span><span class="p">.</span><span class="nx">protect</span><span class="p">(</span><span class="nx">UInt64</span><span class="p">(</span><span class="dl">'</span><span class="s1">0x1234</span><span class="dl">'</span><span class="p">),</span> <span class="mi">4096</span><span class="p">,</span> <span class="dl">'</span><span class="s1">rw-</span><span class="dl">'</span><span class="p">);</span></code></pre></figure>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Kernel.readByteArray(address, length)</code>: just like
<a href="#nativepointer-readbytearray"><code class="language-plaintext highlighter-rouge">NativePointer#readByteArray</code></a>, but reading from
kernel memory.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Kernel.writeByteArray(address, bytes)</code>: just like
<a href="#nativepointer-writebytearray"><code class="language-plaintext highlighter-rouge">NativePointer#writeByteArray</code></a>, but writing to
kernel memory.</p>
  </li>
  <li>
    <p id="kernel-scan"><code class="language-plaintext highlighter-rouge">Kernel.scan(address, size, pattern, callbacks)</code>: just like <a href="#memory-scan"><code class="language-plaintext highlighter-rouge">Memory.scan</code></a>,
but scanning kernel memory.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Kernel.scanSync(address, size, pattern)</code>: synchronous version of <a href="#kernel-scan"><code class="language-plaintext highlighter-rouge">scan()</code></a>
that returns the matches in an array.</p>
  </li>
</ul>

<hr />

<h2 id="data-types-function-and-callback">Data Types, Function and Callback</h2>

<h3 id="int64">Int64</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new Int64(v)</code>: create a new Int64 from <code class="language-plaintext highlighter-rouge">v</code>, which is either a number or a
string containing a value in decimal, or hexadecimal if prefixed with “0x”.
You may use the <code class="language-plaintext highlighter-rouge">int64(v)</code> short-hand for brevity.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">add(rhs)</code>, <code class="language-plaintext highlighter-rouge">sub(rhs)</code>,
<code class="language-plaintext highlighter-rouge">and(rhs)</code>, <code class="language-plaintext highlighter-rouge">or(rhs)</code>,
<code class="language-plaintext highlighter-rouge">xor(rhs)</code>:
make a new Int64 with this Int64 plus/minus/and/or/xor <code class="language-plaintext highlighter-rouge">rhs</code>, which may
either be a number or another Int64</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">shr(n)</code>, <code class="language-plaintext highlighter-rouge">shl(n)</code>:
make a new Int64 with this Int64 shifted right/left by <code class="language-plaintext highlighter-rouge">n</code> bits</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">compare(rhs)</code>: returns an integer comparison result just like
<strong><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare">String#localeCompare()</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">toNumber()</code>: cast this Int64 to a number</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">toString([radix = 10])</code>: convert to a string of optional radix (defaults to
10)</p>
  </li>
</ul>

<h3 id="uint64">UInt64</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new UInt64(v)</code>: create a new UInt64 from <code class="language-plaintext highlighter-rouge">v</code>, which is either a number or a
string containing a value in decimal, or hexadecimal if prefixed with “0x”.
You may use the <code class="language-plaintext highlighter-rouge">uint64(v)</code> short-hand for brevity.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">add(rhs)</code>, <code class="language-plaintext highlighter-rouge">sub(rhs)</code>,
<code class="language-plaintext highlighter-rouge">and(rhs)</code>, <code class="language-plaintext highlighter-rouge">or(rhs)</code>,
<code class="language-plaintext highlighter-rouge">xor(rhs)</code>:
make a new UInt64 with this UInt64 plus/minus/and/or/xor <code class="language-plaintext highlighter-rouge">rhs</code>, which may
either be a number or another UInt64</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">shr(n)</code>, <code class="language-plaintext highlighter-rouge">shl(n)</code>:
make a new UInt64 with this UInt64 shifted right/left by <code class="language-plaintext highlighter-rouge">n</code> bits</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">compare(rhs)</code>: returns an integer comparison result just like
<strong><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare">String#localeCompare()</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">toNumber()</code>: cast this UInt64 to a number</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">toString([radix = 10])</code>: convert to a string of optional radix (defaults to
10)</p>
  </li>
</ul>

<h3 id="nativepointer">NativePointer</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new NativePointer(s)</code>: creates a new <strong><a href="#nativepointer">NativePointer</a></strong> from the
string <code class="language-plaintext highlighter-rouge">s</code> containing a memory address in either decimal, or hexadecimal if
prefixed with ‘0x’. You may use the <code class="language-plaintext highlighter-rouge">ptr(s)</code> short-hand for brevity.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">isNull()</code>: returns a boolean allowing you to conveniently check if a
pointer is NULL</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">add(rhs)</code>, <code class="language-plaintext highlighter-rouge">sub(rhs)</code>,
<code class="language-plaintext highlighter-rouge">and(rhs)</code>, <code class="language-plaintext highlighter-rouge">or(rhs)</code>,
<code class="language-plaintext highlighter-rouge">xor(rhs)</code>:
makes a new <strong><a href="#nativepointer">NativePointer</a></strong> with this <strong><a href="#nativepointer">NativePointer</a></strong>
plus/minus/and/or/xor <code class="language-plaintext highlighter-rouge">rhs</code>, which may either be a number or another <strong><a href="#nativepointer">NativePointer</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">shr(n)</code>, <code class="language-plaintext highlighter-rouge">shl(n)</code>:
makes a new <strong><a href="#nativepointer">NativePointer</a></strong> with this <strong><a href="#nativepointer">NativePointer</a></strong>
shifted right/left by <code class="language-plaintext highlighter-rouge">n</code> bits</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">not()</code>: makes a new <strong><a href="#nativepointer">NativePointer</a></strong> with this <strong><a href="#nativepointer">NativePointer</a></strong>’s
bits inverted</p>
  </li>
  <li>
    <p id="nativepointer-sign"><code class="language-plaintext highlighter-rouge">sign([key, data])</code>: makes a new <strong><a href="#nativepointer">NativePointer</a></strong> by taking this
<strong><a href="#nativepointer">NativePointer</a></strong>’s bits and adding pointer authentication bits,
creating a signed pointer. This is a no-op if the current process does not support
pointer authentication, returning this <strong><a href="#nativepointer">NativePointer</a></strong> instead
of a new value.</p>

    <p>Optionally, <code class="language-plaintext highlighter-rouge">key</code> may be specified as a string. Supported values are:</p>
    <ul>
      <li>ia: The IA key, for signing code pointers. This is the default.</li>
      <li>ib: The IB key, for signing code pointers.</li>
      <li>da: The DA key, for signing data pointers.</li>
      <li>db: The DB key, for signing data pointers.</li>
    </ul>

    <p>The <code class="language-plaintext highlighter-rouge">data</code> argument may also be specified as a <strong><a href="#nativepointer">NativePointer</a></strong>/number-like
value to provide extra data used for the signing, and defaults to <code class="language-plaintext highlighter-rouge">0</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">strip([key])</code>: makes a new <strong><a href="#nativepointer">NativePointer</a></strong> by taking this <strong><a href="#nativepointer">NativePointer</a></strong>’s
bits and removing its pointer authentication bits, creating a raw pointer.
This is a no-op if the current process does not support pointer
authentication, returning this <strong><a href="#nativepointer">NativePointer</a></strong> instead of a
new value.</p>

    <p>Optionally, <code class="language-plaintext highlighter-rouge">key</code> may be passed to specify which key was used to sign the
pointer being stripped. Defaults to <code class="language-plaintext highlighter-rouge">ia</code>. (See <a href="#nativepointer-sign"><code class="language-plaintext highlighter-rouge">sign()</code></a>
for supported values.)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">blend(smallInteger)</code>: makes a new <strong><a href="#nativepointer">NativePointer</a></strong> by taking
this <strong><a href="#nativepointer">NativePointer</a></strong>’s bits and blending them with a constant,
which may in turn be passed to <a href="#nativepointer-sign"><code class="language-plaintext highlighter-rouge">sign()</code></a> as <code class="language-plaintext highlighter-rouge">data</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">equals(rhs)</code>: returns a boolean indicating whether <code class="language-plaintext highlighter-rouge">rhs</code> is equal to
this one; i.e. it has the same pointer value</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">compare(rhs)</code>: returns an integer comparison result just like
<strong><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare">String#localeCompare()</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">toInt32()</code>: casts this <strong><a href="#nativepointer">NativePointer</a></strong> to a signed 32-bit integer</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">toString([radix = 16])</code>: converts to a string of optional radix (defaults
to 16)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">toMatchPattern()</code>: returns a string containing a <a href="#memory-scan"><code class="language-plaintext highlighter-rouge">Memory.scan()</code></a>-compatible
match pattern for this pointer’s raw value</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">readPointer()</code>: reads a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> from this memory location.</p>

    <p>A JavaScript exception will be thrown if the address isn’t readable.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">writePointer(ptr)</code>: writes <code class="language-plaintext highlighter-rouge">ptr</code> to this memory location.</p>

    <p>A JavaScript exception will be thrown if the address isn’t writable.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">readS8()</code>, <code class="language-plaintext highlighter-rouge">readU8()</code>,
<code class="language-plaintext highlighter-rouge">readS16()</code>, <code class="language-plaintext highlighter-rouge">readU16()</code>,
<code class="language-plaintext highlighter-rouge">readS32()</code>, <code class="language-plaintext highlighter-rouge">readU32()</code>,
<code class="language-plaintext highlighter-rouge">readShort()</code>, <code class="language-plaintext highlighter-rouge">readUShort()</code>,
<code class="language-plaintext highlighter-rouge">readInt()</code>, <code class="language-plaintext highlighter-rouge">readUInt()</code>,
<code class="language-plaintext highlighter-rouge">readFloat()</code>, <code class="language-plaintext highlighter-rouge">readDouble()</code>:
reads a signed or unsigned 8/16/32/etc. or float/double value from
this memory location and returns it as a number.</p>

    <p>A JavaScript exception will be thrown if the address isn’t readable.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">writeS8(value)</code>, <code class="language-plaintext highlighter-rouge">writeU8(value)</code>,
<code class="language-plaintext highlighter-rouge">writeS16(value)</code>, <code class="language-plaintext highlighter-rouge">writeU16(value)</code>,
<code class="language-plaintext highlighter-rouge">writeS32(value)</code>, <code class="language-plaintext highlighter-rouge">writeU32(value)</code>,
<code class="language-plaintext highlighter-rouge">writeShort(value)</code>, <code class="language-plaintext highlighter-rouge">writeUShort(value)</code>,
<code class="language-plaintext highlighter-rouge">writeInt(value)</code>, <code class="language-plaintext highlighter-rouge">writeUInt(value)</code>,
<code class="language-plaintext highlighter-rouge">writeFloat(value)</code>, <code class="language-plaintext highlighter-rouge">writeDouble(value)</code>:
writes a signed or unsigned 8/16/32/etc. or float/double <code class="language-plaintext highlighter-rouge">value</code> to this
memory location.</p>

    <p>A JavaScript exception will be thrown if the address isn’t writable.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">readS64()</code>, <code class="language-plaintext highlighter-rouge">readU64()</code>,
<code class="language-plaintext highlighter-rouge">readLong()</code>, <code class="language-plaintext highlighter-rouge">readULong()</code>:
reads a signed or unsigned 64-bit, or long-sized, value from this memory
location and returns it as an <strong><a href="#int64">Int64</a></strong>/<strong><a href="#uint64">UInt64</a></strong> value.</p>

    <p>A JavaScript exception will be thrown if the address isn’t readable.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">writeS64(value)</code>, <code class="language-plaintext highlighter-rouge">writeU64(value)</code>,
<code class="language-plaintext highlighter-rouge">writeLong(value)</code>, <code class="language-plaintext highlighter-rouge">writeULong(value)</code>:
writes the <strong><a href="#int64">Int64</a></strong>/<strong><a href="#uint64">UInt64</a></strong> <code class="language-plaintext highlighter-rouge">value</code> to this memory
location.</p>

    <p>A JavaScript exception will be thrown if the address isn’t writable.</p>
  </li>
  <li>
    <p id="nativepointer-readbytearray"><code class="language-plaintext highlighter-rouge">readByteArray(length)</code>: reads <code class="language-plaintext highlighter-rouge">length</code> bytes from this memory location, and
returns it as an <strong><a href="#arraybuffer">ArrayBuffer</a></strong>. This buffer may be efficiently
transferred to your Frida-based application by passing it as the second argument
to <a href="#communication-send"><code class="language-plaintext highlighter-rouge">send()</code></a>.</p>

    <p>A JavaScript exception will be thrown if any of the <code class="language-plaintext highlighter-rouge">length</code> bytes read from
the address isn’t readable.</p>
  </li>
  <li>
    <p id="nativepointer-writebytearray"><code class="language-plaintext highlighter-rouge">writeByteArray(bytes)</code>: writes <code class="language-plaintext highlighter-rouge">bytes</code> to this memory location, where
<code class="language-plaintext highlighter-rouge">bytes</code> is either an <strong><a href="#arraybuffer">ArrayBuffer</a></strong>, typically returned from
<code class="language-plaintext highlighter-rouge">readByteArray()</code>, or an array of integers between 0 and 255. For example:
<code class="language-plaintext highlighter-rouge">[ 0x13, 0x37, 0x42 ]</code>.</p>

    <p>A JavaScript exception will be thrown if any of the bytes written to
the address isn’t writable.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">readCString([size = -1])</code>,
<code class="language-plaintext highlighter-rouge">readUtf8String([size = -1])</code>,
<code class="language-plaintext highlighter-rouge">readUtf16String([length = -1])</code>,
<code class="language-plaintext highlighter-rouge">readAnsiString([size = -1])</code>:
reads the bytes at this memory location as an ASCII, UTF-8, UTF-16, or ANSI
string. Supply the optional <code class="language-plaintext highlighter-rouge">size</code> argument if you know the size of the
string in bytes, or omit it or specify <em>-1</em> if the string is NUL-terminated.
Likewise you may supply the optional <code class="language-plaintext highlighter-rouge">length</code> argument if you know the
length of the string in characters.</p>

    <p>A JavaScript exception will be thrown if any of the <code class="language-plaintext highlighter-rouge">size</code> / <code class="language-plaintext highlighter-rouge">length</code> bytes
read from the address isn’t readable.</p>

    <p>Note that <code class="language-plaintext highlighter-rouge">readAnsiString()</code> is only available (and relevant) on Windows.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">writeUtf8String(str)</code>,
<code class="language-plaintext highlighter-rouge">writeUtf16String(str)</code>,
<code class="language-plaintext highlighter-rouge">writeAnsiString(str)</code>:
encodes and writes the JavaScript string to this memory location (with
NUL-terminator).</p>

    <p>A JavaScript exception will be thrown if any of the bytes written to
the address isn’t writable.</p>

    <p>Note that <code class="language-plaintext highlighter-rouge">writeAnsiString()</code> is only available (and relevant) on Windows.</p>
  </li>
</ul>

<h3 id="arraybuffer">ArrayBuffer</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">wrap(address, size)</code>: creates an ArrayBuffer backed by an existing memory
region, where <code class="language-plaintext highlighter-rouge">address</code> is a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> specifying the
base address of the region, and <code class="language-plaintext highlighter-rouge">size</code> is a number specifying its size. Unlike
the <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> read/write APIs, no validation is performed
on access, meaning a bad pointer will crash the process.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">unwrap()</code>: returns a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> specifying the base
address of the ArrayBuffer’s backing store. It is the caller’s responsibility to
keep the buffer alive while the backing store is still being used.</p>
  </li>
</ul>

<h3 id="nativefunction">NativeFunction</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new NativeFunction(address, returnType, argTypes[, abi])</code>: create a new
NativeFunction to call the function at <code class="language-plaintext highlighter-rouge">address</code> (specified with a
<a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a>), where <code class="language-plaintext highlighter-rouge">returnType</code> specifies the return type,
and the <code class="language-plaintext highlighter-rouge">argTypes</code> array specifies the argument types. You may optionally also
specify <code class="language-plaintext highlighter-rouge">abi</code> if not system default. For variadic functions, add a <code class="language-plaintext highlighter-rouge">'...'</code>
entry to <code class="language-plaintext highlighter-rouge">argTypes</code> between the fixed arguments and the variadic ones.</p>

    <ul>
      <li>
        <h4 id="structs--classes-by-value">Structs &amp; Classes by Value</h4>

        <p>As for structs or classes passed by value, instead of a string provide an
  array containing the struct’s field types following each other. You may nest
  these as deep as desired for representing structs inside structs. Note that
  the returned object is also a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a>, and can thus
  be passed to <a href="#interceptor-attach"><code class="language-plaintext highlighter-rouge">Interceptor#attach</code></a>.</p>

        <p>This must match the struct/class exactly, so if you have a struct with three
  ints, you must pass <code class="language-plaintext highlighter-rouge">['int', 'int', 'int']</code>.</p>

        <p>For a class that has virtual methods, the first field will be a pointer
  to <strong><a href="https://en.wikipedia.org/wiki/Virtual_method_table">the vtable</a></strong>.</p>

        <p>For C++ scenarios involving a return value that is larger than
  <a href="#process-pointersize"><code class="language-plaintext highlighter-rouge">Process.pointerSize</code></a>, a typical ABI may expect
  that a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> to preallocated space must be
  passed in as the first parameter. (This scenario is common in WebKit,
  for example.)</p>
      </li>
      <li>
        <h4 id="supported-types">Supported Types</h4>
        <ul>
          <li>void</li>
          <li>pointer</li>
          <li>int</li>
          <li>uint</li>
          <li>long</li>
          <li>ulong</li>
          <li>char</li>
          <li>uchar</li>
          <li>size_t</li>
          <li>ssize_t</li>
          <li>float</li>
          <li>double</li>
          <li>int8</li>
          <li>uint8</li>
          <li>int16</li>
          <li>uint16</li>
          <li>int32</li>
          <li>uint32</li>
          <li>int64</li>
          <li>uint64</li>
          <li>bool</li>
        </ul>
      </li>
      <li>
        <h4 id="supported-abis">Supported ABIs</h4>
        <ul>
          <li>default</li>
          <li>Windows 32-bit:
            <ul>
              <li>sysv</li>
              <li>stdcall</li>
              <li>thiscall</li>
              <li>fastcall</li>
              <li>mscdecl</li>
            </ul>
          </li>
          <li>Windows 64-bit:
            <ul>
              <li>win64</li>
            </ul>
          </li>
          <li>UNIX x86:
            <ul>
              <li>sysv</li>
              <li>unix64</li>
            </ul>
          </li>
          <li>UNIX ARM:
            <ul>
              <li>sysv</li>
              <li>vfp</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new NativeFunction(address, returnType, argTypes[, options])</code>: just like
the previous constructor, but where the fourth argument, <code class="language-plaintext highlighter-rouge">options</code>, is an
object that may contain one or more of the following keys:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">abi</code>: same enum as above.</li>
      <li><code class="language-plaintext highlighter-rouge">scheduling</code>: scheduling behavior as a string. Supported values are:
        <ul>
          <li>cooperative: Allow other threads to execute JavaScript code while
             calling the native function, i.e. let go of the lock
             before the call, and re-acquire it afterwards.
             This is the default behavior.</li>
          <li>exclusive: Do not allow other threads to execute JavaScript code
           while calling the native function, i.e. keep holding the
           JavaScript lock.
           This is faster but may result in deadlocks.</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">exceptions</code>: exception behavior as a string. Supported values are:
        <ul>
          <li>steal: If the called function generates a native exception, e.g.
       by dereferencing an invalid pointer, Frida will unwind the
       stack and steal the exception, turning it into a JavaScript
       exception that can be handled. This may leave the application
       in an undefined state, but is useful to avoid crashing the
       process while experimenting.
       This is the default behavior.</li>
          <li>propagate: Let the application deal with any native exceptions that
           occur during the function call. (Or, the handler
           installed through <a href="#process-setexceptionhandler"><code class="language-plaintext highlighter-rouge">Process.setExceptionHandler()</code></a>.)</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">traps</code>: code traps to be enabled, as a string. Supported values are:
        <ul>
          <li>default: <strong><a href="#interceptor-attach">Interceptor.attach()</a></strong> callbacks will be
         called if any hooks are triggered by a function call.</li>
          <li>all: In addition to <strong><a href="#interceptor">Interceptor</a></strong> callbacks, <strong><a href="#stalker">Stalker</a></strong>
     may also be temporarily reactivated for the duration of each function
     call. This is useful for e.g. measuring code coverage while guiding a
     fuzzer, implementing “step into” in a debugger, etc.
     Note that this is also possible when using the <strong><a href="#java">Java</a></strong>
     and <strong><a href="#objc">ObjC</a></strong> APIs, as method wrappers also provide a
     <code class="language-plaintext highlighter-rouge">clone(options)</code> API to create a new method wrapper with custom
     NativeFunction options.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="nativecallback">NativeCallback</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">new NativeCallback(func, returnType, argTypes[, abi])</code>: create a new
NativeCallback implemented by the JavaScript function <code class="language-plaintext highlighter-rouge">func</code>, where
<code class="language-plaintext highlighter-rouge">returnType</code> specifies the return type, and the <code class="language-plaintext highlighter-rouge">argTypes</code> array specifies
the argument types. You may also specify the abi if not system default.
See <a href="#nativefunction"><code class="language-plaintext highlighter-rouge">NativeFunction</code></a> for details about supported types and
abis. Note that the returned object is also a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a>,
and can thus be passed to <a href="#interceptor-replace"><code class="language-plaintext highlighter-rouge">Interceptor#replace</code></a>.
When using the resulting callback with <strong><a href="#interceptor-replace">Interceptor.replace()</a></strong>,
<code class="language-plaintext highlighter-rouge">func</code> will be invoked with <code class="language-plaintext highlighter-rouge">this</code> bound to an object with some useful properties,
just like the one in <strong><a href="#interceptor-attach">Interceptor.attach()</a></strong>.</li>
</ul>

<h3 id="systemfunction">SystemFunction</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new SystemFunction(address, returnType, argTypes[, abi])</code>: just like
<a href="#nativefunction"><code class="language-plaintext highlighter-rouge">NativeFunction</code></a>, but also provides a snapshot of the thread’s
last error status. The return value is an object wrapping the actual return value
as <code class="language-plaintext highlighter-rouge">value</code>, with one additional platform-specific field named either <code class="language-plaintext highlighter-rouge">errno</code>
(UNIX) or <code class="language-plaintext highlighter-rouge">lastError</code> (Windows).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new SystemFunction(address, returnType, argTypes[, options])</code>: same as
above but accepting an <code class="language-plaintext highlighter-rouge">options</code> object like <a href="#nativefunction"><code class="language-plaintext highlighter-rouge">NativeFunction</code></a>’s
corresponding constructor.</p>
  </li>
</ul>

<hr />

<h2 id="network">Network</h2>

<h3 id="socket">Socket</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Socket.listen([options])</code>: open a TCP or UNIX listening socket. Returns a
<em>Promise</em> that receives a <strong><a href="#socketlistener">SocketListener</a></strong>.</p>

    <p>Defaults to listening on both IPv4 and IPv6, if supported, and binding on
all interfaces on a randomly selected TCP port.</p>

    <p>The optional <code class="language-plaintext highlighter-rouge">options</code> argument is an object that may contain some of the
following keys:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">family</code>: address family as a string. Supported values are:
        <ul>
          <li>unix</li>
          <li>ipv4</li>
          <li>ipv6
Defaults to listening on both <code class="language-plaintext highlighter-rouge">ipv4</code> and <code class="language-plaintext highlighter-rouge">ipv6</code> if supported.</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">host</code>: (IP family) IP address as a string. Defaults to all interfaces.</li>
      <li><code class="language-plaintext highlighter-rouge">port</code>: (IP family) IP port as a number. Defaults to any available.</li>
      <li><code class="language-plaintext highlighter-rouge">type</code>: (UNIX family) UNIX socket type as a string. Supported types are:
        <ul>
          <li>anonymous</li>
          <li>path</li>
          <li>abstract</li>
          <li>abstract-padded
Defaults to <code class="language-plaintext highlighter-rouge">path</code>.</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">path</code>: (UNIX family) UNIX socket path as a string.</li>
      <li><code class="language-plaintext highlighter-rouge">backlog</code>: Listen backlog as a number. Defaults to <code class="language-plaintext highlighter-rouge">10</code>.</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Socket.connect(options)</code>: connect to a TCP or UNIX server. Returns a
<em>Promise</em> that receives a <strong><a href="#socketconnection">SocketConnection</a></strong>.</p>

    <p>The <code class="language-plaintext highlighter-rouge">options</code> argument is an object that should contain some of the
following keys:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">family</code>: address family as a string. Supported values are:
        <ul>
          <li>unix</li>
          <li>ipv4</li>
          <li>ipv6
Defaults to an IP family depending on the <code class="language-plaintext highlighter-rouge">host</code> specified.</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">host</code>: (IP family) IP address as a string. Defaults to <code class="language-plaintext highlighter-rouge">localhost</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">port</code>: (IP family) IP port as a number.</li>
      <li><code class="language-plaintext highlighter-rouge">type</code>: (UNIX family) UNIX socket type as a string. Supported types are:
        <ul>
          <li>anonymous</li>
          <li>path</li>
          <li>abstract</li>
          <li>abstract-padded
Defaults to <code class="language-plaintext highlighter-rouge">path</code>.</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">path</code>: (UNIX family) UNIX socket path as a string.</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Socket.type(handle)</code>: inspect the OS socket <code class="language-plaintext highlighter-rouge">handle</code> and return its type
as a string which is either <code class="language-plaintext highlighter-rouge">tcp</code>, <code class="language-plaintext highlighter-rouge">udp</code>, <code class="language-plaintext highlighter-rouge">tcp6</code>, <code class="language-plaintext highlighter-rouge">udp6</code>, <code class="language-plaintext highlighter-rouge">unix:stream</code>,
<code class="language-plaintext highlighter-rouge">unix:dgram</code>, or <code class="language-plaintext highlighter-rouge">null</code> if invalid or unknown.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Socket.localAddress(handle)</code>,
<code class="language-plaintext highlighter-rouge">Socket.peerAddress(handle)</code>:
inspect the OS socket <code class="language-plaintext highlighter-rouge">handle</code> and return its local or peer address, or
<code class="language-plaintext highlighter-rouge">null</code> if invalid or unknown.</p>

    <p>The object returned has the fields:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">ip</code>: (IP sockets) IP address as a string.</li>
      <li><code class="language-plaintext highlighter-rouge">port</code>: (IP sockets) IP port as a number.</li>
      <li><code class="language-plaintext highlighter-rouge">path</code>: (UNIX sockets) UNIX path as a string.</li>
    </ul>
  </li>
</ul>

<h3 id="socketlistener">SocketListener</h3>

<p>All methods are fully asynchronous and return Promise objects.<br /><br /></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">path</code>: (UNIX family) path being listened on.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">port</code>: (IP family) IP port being listened on.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">close()</code>: close the listener, releasing resources related to it. Once the
listener is closed, all other operations will fail. Closing a listener
multiple times is allowed and will not result in an error.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">accept()</code>: wait for the next client to connect. The returned <em>Promise</em>
receives a <strong><a href="#socketconnection">SocketConnection</a></strong>.</p>
  </li>
</ul>

<h3 id="socketconnection">SocketConnection</h3>

<p>Inherits from <strong><a href="#iostream">IOStream</a></strong>.
All methods are fully asynchronous and return Promise objects.<br /><br /></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">setNoDelay(noDelay)</code>: disable the Nagle algorithm if <code class="language-plaintext highlighter-rouge">noDelay</code> is <code class="language-plaintext highlighter-rouge">true</code>,
otherwise enable it. The Nagle algorithm is enabled by default, so it is
only necessary to call this method if you wish to optimize for low delay
instead of high throughput.</li>
</ul>

<hr />

<h2 id="file-and-stream">File and Stream</h2>

<h3 id="file">File</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new File(filePath, mode)</code>: open or create the file at <code class="language-plaintext highlighter-rouge">filePath</code> with
the <code class="language-plaintext highlighter-rouge">mode</code> string specifying how it should be opened. For example <code class="language-plaintext highlighter-rouge">"wb"</code>
to open the file for writing in binary mode (this is the same format as
<code class="language-plaintext highlighter-rouge">fopen()</code> from the C standard library).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">write(data)</code>: synchronously write <code class="language-plaintext highlighter-rouge">data</code> to the file, where <code class="language-plaintext highlighter-rouge">data</code> is
either a string or a buffer as returned by <a href="#nativepointer-readbytearray"><code class="language-plaintext highlighter-rouge">NativePointer#readByteArray</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">flush()</code>: flush any buffered data to the underlying file</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">close()</code>: close the file. You should call this function when you’re done
with the file unless you are fine with this happening when the object is
garbage-collected or the script is unloaded.</p>
  </li>
</ul>

<h3 id="iostream">IOStream</h3>

<p>All methods are fully asynchronous and return Promise objects.<br /><br /></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">input</code>: the <strong><a href="#inputstream">InputStream</a></strong> to read from.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">output</code>: the <strong><a href="#outputstream">OutputStream</a></strong> to write to.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">close()</code>: close the stream, releasing resources related to it. This will
also close the individual input and output streams. Once the stream is
closed, all other operations will fail. Closing a stream multiple times is
allowed and will not result in an error.</p>
  </li>
</ul>

<h3 id="inputstream">InputStream</h3>

<p>All methods are fully asynchronous and return Promise objects.<br /><br /></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">close()</code>: close the stream, releasing resources related to it. Once the
stream is closed, all other operations will fail. Closing a stream multiple
times is allowed and will not result in an error.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">read(size)</code>: read up to <code class="language-plaintext highlighter-rouge">size</code> bytes from the stream. The returned
<strong>Promise</strong> receives an <strong><a href="#arraybuffer">ArrayBuffer</a></strong> up to <code class="language-plaintext highlighter-rouge">size</code> bytes long.
End of stream is signalled through an empty buffer.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">readAll(size)</code>: keep reading from the stream until exactly <code class="language-plaintext highlighter-rouge">size</code> bytes
have been consumed. The returned <em>Promise</em> receives an <strong><a href="#arraybuffer">ArrayBuffer</a></strong>
that is exactly <code class="language-plaintext highlighter-rouge">size</code> bytes long. Premature error or end of stream results in the
<em>Promise</em> getting rejected with an error, where the <code class="language-plaintext highlighter-rouge">Error</code> object has a
<code class="language-plaintext highlighter-rouge">partialData</code> property containing the incomplete data.</p>
  </li>
</ul>

<h3 id="outputstream">OutputStream</h3>

<p>All methods are fully asynchronous and return Promise objects.<br /><br /></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">close()</code>: close the stream, releasing resources related to it. Once the
stream is closed, all other operations will fail. Closing a stream multiple
times is allowed and will not result in an error.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">write(data)</code>: try to write <code class="language-plaintext highlighter-rouge">data</code> to the stream. The <code class="language-plaintext highlighter-rouge">data</code> value is either
an <strong><a href="#arraybuffer">ArrayBuffer</a></strong> or an array of integers between 0 and 255. The
returned <em>Promise</em> receives a <em>Number</em> specifying how many bytes of <code class="language-plaintext highlighter-rouge">data</code> were
written to the stream.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">writeAll(data)</code>: keep writing to the stream until all of <code class="language-plaintext highlighter-rouge">data</code> has been
written. The <code class="language-plaintext highlighter-rouge">data</code> value is either an <strong><a href="#arraybuffer">ArrayBuffer</a></strong> or an array
of integers between 0 and 255. Premature error or end of stream results in an
error, where the <code class="language-plaintext highlighter-rouge">Error</code> object has a <code class="language-plaintext highlighter-rouge">partialSize</code> property specifying how many
bytes of <code class="language-plaintext highlighter-rouge">data</code> were written to the stream before the error occurred.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">writeMemoryRegion(address, size)</code>: try to write <code class="language-plaintext highlighter-rouge">size</code> bytes to the stream,
reading them from <code class="language-plaintext highlighter-rouge">address</code>, which is a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a>. The
returned <em>Promise</em> receives a <em>Number</em> specifying how many bytes of <code class="language-plaintext highlighter-rouge">data</code> were
written to the stream.</p>
  </li>
</ul>

<h3 id="unixinputstream">UnixInputStream</h3>

<p>(Only available on UNIX-like OSes.)<br /><br /></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new UnixInputStream(fd[, options])</code>: create a new
<strong><a href="#inputstream">InputStream</a></strong> from the specified file descriptor <code class="language-plaintext highlighter-rouge">fd</code>.</p>

    <p>You may also supply an <code class="language-plaintext highlighter-rouge">options</code> object with <code class="language-plaintext highlighter-rouge">autoClose</code> set to <code class="language-plaintext highlighter-rouge">true</code> to
make the stream close the underlying file descriptor when the stream is
released, either through <code class="language-plaintext highlighter-rouge">close()</code> or future garbage-collection.</p>
  </li>
</ul>

<h3 id="unixoutputstream">UnixOutputStream</h3>

<p>(Only available on UNIX-like OSes.)<br /><br /></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new UnixOutputStream(fd[, options])</code>: create a new
<strong><a href="#outputstream">OutputStream</a></strong> from the specified file descriptor <code class="language-plaintext highlighter-rouge">fd</code>.</p>

    <p>You may also supply an <code class="language-plaintext highlighter-rouge">options</code> object with <code class="language-plaintext highlighter-rouge">autoClose</code> set to <code class="language-plaintext highlighter-rouge">true</code> to
make the stream close the underlying file descriptor when the stream is
released, either through <code class="language-plaintext highlighter-rouge">close()</code> or future garbage-collection.</p>
  </li>
</ul>

<h3 id="win32inputstream">Win32InputStream</h3>

<p>(Only available on Windows.)<br /><br /></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new Win32InputStream(handle[, options])</code>: create a new
<strong><a href="#inputstream">InputStream</a></strong> from the specified <code class="language-plaintext highlighter-rouge">handle</code>, which is a Windows
<em>HANDLE</em> value.</p>

    <p>You may also supply an <code class="language-plaintext highlighter-rouge">options</code> object with <code class="language-plaintext highlighter-rouge">autoClose</code> set to <code class="language-plaintext highlighter-rouge">true</code> to
make the stream close the underlying handle when the stream is released,
either through <code class="language-plaintext highlighter-rouge">close()</code> or future garbage-collection.</p>
  </li>
</ul>

<h3 id="win32outputstream">Win32OutputStream</h3>

<p>(Only available on Windows.)<br /><br /></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new Win32OutputStream(handle[, options])</code>: create a new
<strong><a href="#outputstream">OutputStream</a></strong> from the specified <code class="language-plaintext highlighter-rouge">handle</code>, which is a
Windows <em>HANDLE</em> value.</p>

    <p>You may also supply an <code class="language-plaintext highlighter-rouge">options</code> object with <code class="language-plaintext highlighter-rouge">autoClose</code> set to <code class="language-plaintext highlighter-rouge">true</code> to
make the stream close the underlying handle when the stream is released,
either through <code class="language-plaintext highlighter-rouge">close()</code> or future garbage-collection.</p>
  </li>
</ul>

<h2 id="database">Database</h2>

<h3 id="sqlitedatabase">SqliteDatabase</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">SqliteDatabase.open(path[, options])</code>: opens the SQLite v3 database
specified by <code class="language-plaintext highlighter-rouge">path</code>, a string containing the filesystem path to the
database. By default the database will be opened read-write, but you may
customize this behavior by providing an <code class="language-plaintext highlighter-rouge">options</code> object with a property
named <code class="language-plaintext highlighter-rouge">flags</code>, specifying an array of strings containing one or more of the
following values: <code class="language-plaintext highlighter-rouge">readonly</code>, <code class="language-plaintext highlighter-rouge">readwrite</code>, <code class="language-plaintext highlighter-rouge">create</code>.  The returned
SqliteDatabase object will allow you to perform queries on the database.</p>
  </li>
  <li>
    <p id="sqlitedatabase-openinline"><code class="language-plaintext highlighter-rouge">SqliteDatabase.openInline(encodedContents)</code>: just like <code class="language-plaintext highlighter-rouge">open()</code> but the
contents of the database is provided as a string containing its data,
Base64-encoded. We recommend gzipping the database before Base64-encoding
it, but this is optional and detected by looking for a gzip magic marker.
The database is opened read-write, but is 100% in-memory and never touches
the filesystem. This is useful for agents that need to bundle a cache of
precomputed data, e.g. static analysis data used to guide dynamic analysis.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">close()</code>: close the database. You should call this function when you’re
done with the database, unless you are fine with this happening when the
object is garbage-collected or the script is unloaded.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">exec(sql)</code>: execute a raw SQL query, where <code class="language-plaintext highlighter-rouge">sql</code> is a string containing
the text-representation of the query. The query’s result is ignored, so this
should only be used for queries for setting up the database, e.g. table
creation.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">prepare(sql)</code>: compile the provided SQL into a
<strong><a href="#sqlitestatement">SqliteStatement</a></strong> object, where <code class="language-plaintext highlighter-rouge">sql</code> is a string
containing the text-representation of the query.</p>

    <p>For example:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">SqliteDatabase</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">/path/to/people.db</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">smt</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="dl">'</span><span class="s1">SELECT name, bio FROM people WHERE age = ?</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">People whose age is 42:</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">smt</span><span class="p">.</span><span class="nx">bindInteger</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">row</span><span class="p">;</span>
<span class="k">while</span> <span class="p">((</span><span class="nx">row</span> <span class="o">=</span> <span class="nx">smt</span><span class="p">.</span><span class="nx">step</span><span class="p">())</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">name</span><span class="p">,</span> <span class="nx">bio</span><span class="p">]</span> <span class="o">=</span> <span class="nx">row</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Name:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Bio:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">bio</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">smt</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span></code></pre></figure>

<ul>
  <li><code class="language-plaintext highlighter-rouge">dump()</code>: dump the database to a gzip-compressed blob encoded as Base64,
where the result is returned as a string. This is useful for inlining a
cache in your agent’s code, loaded by calling <a href="#sqlitedatabase-openinline"><code class="language-plaintext highlighter-rouge">SqliteDatabase.openInline()</code></a>.</li>
</ul>

<h3 id="sqlitestatement">SqliteStatement</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">bindInteger(index, value)</code>: bind the integer <code class="language-plaintext highlighter-rouge">value</code> to <code class="language-plaintext highlighter-rouge">index</code></li>
  <li><code class="language-plaintext highlighter-rouge">bindFloat(index, value)</code>: bind the floating point <code class="language-plaintext highlighter-rouge">value</code> to <code class="language-plaintext highlighter-rouge">index</code></li>
  <li><code class="language-plaintext highlighter-rouge">bindText(index, value)</code>: bind the text <code class="language-plaintext highlighter-rouge">value</code> to <code class="language-plaintext highlighter-rouge">index</code></li>
  <li><code class="language-plaintext highlighter-rouge">bindBlob(index, bytes)</code>: bind the blob <code class="language-plaintext highlighter-rouge">bytes</code> to <code class="language-plaintext highlighter-rouge">index</code>, where <code class="language-plaintext highlighter-rouge">bytes</code>
is an <strong><a href="#arraybuffer">ArrayBuffer</a></strong>, array of byte values, or a string</li>
  <li><code class="language-plaintext highlighter-rouge">bindNull(index)</code>: bind a null value to <code class="language-plaintext highlighter-rouge">index</code></li>
  <li><code class="language-plaintext highlighter-rouge">step()</code>: either start a new query and get the first result, or move to the
next one. Returns an array containing the values in the order specified by
the query, or <code class="language-plaintext highlighter-rouge">null</code> when the last result is reached. You should call
<code class="language-plaintext highlighter-rouge">reset()</code> at that point if you intend to use this object again.</li>
  <li><code class="language-plaintext highlighter-rouge">reset()</code>: reset internal state to allow subsequent queries</li>
</ul>

<hr />

<h2 id="instrumentation">Instrumentation</h2>

<h3 id="interceptor">Interceptor</h3>

<ul>
  <li>
    <p id="interceptor-attach"><code class="language-plaintext highlighter-rouge">Interceptor.attach(target, callbacks[, data])</code>: intercept calls to function
at <code class="language-plaintext highlighter-rouge">target</code>. This is a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> specifying the address
of the function you would like to intercept calls to. Note that on 32-bit ARM this
address must have its least significant bit set to 0 for ARM functions, and
1 for Thumb functions. Frida takes care of this detail for you if you get
the address from a Frida API (for example <a href="#module-getexportbyname"><code class="language-plaintext highlighter-rouge">Module.getExportByName()</code></a>).</p>

    <p>The <code class="language-plaintext highlighter-rouge">callbacks</code> argument is an object containing one or more of:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">onEnter(args)</code>: callback function given one argument <code class="language-plaintext highlighter-rouge">args</code> that can be
used to read or write arguments as an array of
<a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> objects. {: #interceptor-onenter}</p>
      </li>
      <li>
        <p id="interceptor-onleave"><code class="language-plaintext highlighter-rouge">onLeave(retval)</code>: callback function given one argument <code class="language-plaintext highlighter-rouge">retval</code> that is
a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a>-derived object containing the raw
return value.
You may call <code class="language-plaintext highlighter-rouge">retval.replace(1337)</code> to replace the return value with
the integer <code class="language-plaintext highlighter-rouge">1337</code>, or <code class="language-plaintext highlighter-rouge">retval.replace(ptr("0x1234"))</code> to replace with
a pointer.
Note that this object is recycled across <em>onLeave</em> calls, so do not
store and use it outside your callback. Make a deep copy if you need
to store the contained value, e.g.: <code class="language-plaintext highlighter-rouge">ptr(retval.toString())</code>.</p>
      </li>
    </ul>

    <p>In case the hooked function is very hot, <code class="language-plaintext highlighter-rouge">onEnter</code> and <code class="language-plaintext highlighter-rouge">onLeave</code> may be
<a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> values pointing at native C functions compiled
using <strong><a href="#cmodule">CModule</a></strong>. Their signatures are:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">void onEnter (GumInvocationContext * ic)</code></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">void onLeave (GumInvocationContext * ic)</code></p>
      </li>
    </ul>

    <p>In such cases, the third optional argument <code class="language-plaintext highlighter-rouge">data</code> may be a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a>
accessible through <code class="language-plaintext highlighter-rouge">gum_invocation_context_get_listener_function_data()</code>.</p>

    <p>You may also intercept arbitrary instructions by passing a function instead
of the <code class="language-plaintext highlighter-rouge">callbacks</code> object. This function has the same signature as
<code class="language-plaintext highlighter-rouge">onEnter</code>, but the <code class="language-plaintext highlighter-rouge">args</code> argument passed to it will only give you sensible
values if the intercepted instruction is at the beginning of a function or
at a point where registers/stack have not yet deviated from that point.</p>

    <p>Just like above, this function may also be implemented in C by specifying
a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> instead of a function.</p>

    <p>Returns a listener object that you can call <code class="language-plaintext highlighter-rouge">detach()</code> on.</p>

    <p>Note that these functions will be invoked with <code class="language-plaintext highlighter-rouge">this</code> bound to a
per-invocation (thread-local) object where you can store arbitrary data,
which is useful if you want to read an argument in <code class="language-plaintext highlighter-rouge">onEnter</code> and act on it
in <code class="language-plaintext highlighter-rouge">onLeave</code>.</p>

    <p>For example:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">Module</span><span class="p">.</span><span class="nx">getExportByName</span><span class="p">(</span><span class="dl">'</span><span class="s1">libc.so</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">read</span><span class="dl">'</span><span class="p">),</span> <span class="p">{</span>
  <span class="nx">onEnter</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">fileDescriptor</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">toInt32</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">onLeave</span><span class="p">(</span><span class="nx">retval</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">retval</span><span class="p">.</span><span class="nx">toInt32</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/* do something with this.fileDescriptor */</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li>
    <p>Additionally, the object contains some useful properties:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">returnAddress</code>: return address as a <strong><a href="#nativepointer">NativePointer</a></strong></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">context</code>: object with the keys <code class="language-plaintext highlighter-rouge">pc</code> and <code class="language-plaintext highlighter-rouge">sp</code>, which are
<strong><a href="#nativepointer">NativePointer</a></strong> objects specifying EIP/RIP/PC and
ESP/RSP/SP, respectively, for ia32/x64/arm. Other processor-specific keys
are also available, e.g. <code class="language-plaintext highlighter-rouge">eax</code>, <code class="language-plaintext highlighter-rouge">rax</code>, <code class="language-plaintext highlighter-rouge">r0</code>, <code class="language-plaintext highlighter-rouge">x0</code>, etc.
You may also update register values by assigning to these keys.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">errno</code>: (UNIX) current errno value (you may replace it)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">lastError</code>: (Windows) current OS error value (you may replace it)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">threadId</code>: OS thread ID</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">depth</code>: call depth of relative to other invocations</p>
      </li>
    </ul>

    <p>For example:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">Module</span><span class="p">.</span><span class="nx">getExportByName</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="dl">'</span><span class="s1">read</span><span class="dl">'</span><span class="p">),</span> <span class="p">{</span>
  <span class="nx">onEnter</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Context information:</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Context  : </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">));</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Return   : </span><span class="dl">'</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">returnAddress</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ThreadId : </span><span class="dl">'</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">threadId</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Depth    : </span><span class="dl">'</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">depth</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Errornr  : </span><span class="dl">'</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">err</span><span class="p">);</span>

    <span class="c1">// Save arguments for processing in onLeave.</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">fd</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">toInt32</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">buf</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">count</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">toInt32</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">onLeave</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">----------</span><span class="dl">'</span><span class="p">)</span>
    <span class="c1">// Show argument 1 (buf), saved during onEnter.</span>
    <span class="kd">const</span> <span class="nx">numBytes</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">toInt32</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">numBytes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">hexdump</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">,</span> <span class="p">{</span> <span class="na">length</span><span class="p">:</span> <span class="nx">numBytes</span><span class="p">,</span> <span class="na">ansi</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>
    <span class="p">}</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Result   : </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">numBytes</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})</span></code></pre></figure>

<div class="note">
  <h5>Performance considerations</h5>
  <p>
    The callbacks provided have a significant impact on performance. If you only
    need to inspect arguments but do not care about the return value, or the
    other way around, make sure you omit the callback that you don't need; i.e.
    avoid putting your logic in <i>onEnter</i> and leaving <i>onLeave</i> in
    there as an empty callback.
  </p>
  <p>
    On an iPhone 5S the base overhead when providing just <i>onEnter</i> might be
    something like 6 microseconds, and 11 microseconds with both <i>onEnter</i>
    and <i>onLeave</i> provided.
  </p>
  <p>
    Also be careful about intercepting calls to functions that are called a
    bazillion times per second; while <strong><a href="#communication-send">send()</a></strong> is
    asynchronous, the total overhead of sending a single message is not optimized for
    high frequencies, so that means Frida leaves it up to you to batch multiple values
    into a single <strong><a href="#communication-send">send()</a></strong>-call, based on whether low delay
    or high throughput is desired.
  </p>
  <p>
    However when hooking hot functions you may use Interceptor in conjunction
    with <strong><a href="#cmodule">CModule</a></strong> to implement the callbacks in C.
  </p>
</div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Interceptor.detachAll()</code>: detach all previously attached callbacks.</p>
  </li>
  <li>
    <p id="interceptor-replace"><code class="language-plaintext highlighter-rouge">Interceptor.replace(target, replacement[, data])</code>: replace function at
<code class="language-plaintext highlighter-rouge">target</code> with implementation at <code class="language-plaintext highlighter-rouge">replacement</code>. This is typically used if you
want to fully or partially replace an existing function’s implementation.</p>

    <p>Use <a href="#nativecallback"><code class="language-plaintext highlighter-rouge">NativeCallback</code></a> to implement a <code class="language-plaintext highlighter-rouge">replacement</code> in JavaScript.</p>

    <p>In case the replaced function is very hot, you may implement <code class="language-plaintext highlighter-rouge">replacement</code>
in C using <strong><a href="#cmodule">CModule</a></strong>. You may then also specify the third optional
argument <code class="language-plaintext highlighter-rouge">data</code>, which is a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> accessible through
<code class="language-plaintext highlighter-rouge">gum_invocation_context_get_listener_function_data()</code>. Use
<code class="language-plaintext highlighter-rouge">gum_interceptor_get_current_invocation()</code> to get hold of the
<code class="language-plaintext highlighter-rouge">GumInvocationContext *</code>.</p>

    <p>Note that <code class="language-plaintext highlighter-rouge">replacement</code> will be kept alive until <a href="#interceptor-revert"><code class="language-plaintext highlighter-rouge">Interceptor#revert</code></a> is
called.</p>

    <p>If you want to chain to the original implementation you can synchronously
call <code class="language-plaintext highlighter-rouge">target</code> through a <a href="#nativefunction"><code class="language-plaintext highlighter-rouge">NativeFunction</code></a> inside your
implementation, which will bypass and go directly to the original implementation.</p>

    <p>Here’s an example:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">openPtr</span> <span class="o">=</span> <span class="nx">Module</span><span class="p">.</span><span class="nx">getExportByName</span><span class="p">(</span><span class="dl">'</span><span class="s1">libc.so</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">open</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NativeFunction</span><span class="p">(</span><span class="nx">openPtr</span><span class="p">,</span> <span class="dl">'</span><span class="s1">int</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">pointer</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">int</span><span class="dl">'</span><span class="p">]);</span>
<span class="nx">Interceptor</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">openPtr</span><span class="p">,</span> <span class="k">new</span> <span class="nx">NativeCallback</span><span class="p">((</span><span class="nx">pathPtr</span><span class="p">,</span> <span class="nx">flags</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">pathPtr</span><span class="p">.</span><span class="nx">readUtf8String</span><span class="p">();</span>
  <span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Opening "</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">path</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">"</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">fd</span> <span class="o">=</span> <span class="nx">open</span><span class="p">(</span><span class="nx">pathPtr</span><span class="p">,</span> <span class="nx">flags</span><span class="p">);</span>
  <span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Got fd: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">fd</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">fd</span><span class="p">;</span>
<span class="p">},</span> <span class="dl">'</span><span class="s1">int</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">pointer</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">int</span><span class="dl">'</span><span class="p">]));</span></code></pre></figure>

<ul>
  <li>
    <p id="interceptor-revert"><code class="language-plaintext highlighter-rouge">Interceptor.revert(target)</code>: revert function at <code class="language-plaintext highlighter-rouge">target</code> to the previous
implementation.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Interceptor.flush()</code>: ensure any pending changes have been committed
to memory. This is should only be done in the few cases where this is
necessary, e.g. if you just <strong><a href="#interceptor-attach">attach()</a></strong>ed to or <strong><a href="#interceptor-replace">replace()</a></strong>d a function that you
are about to call using <strong><a href="#nativefunction">NativeFunction</a></strong>. Pending changes
are flushed automatically whenever the current thread is about to leave the
JavaScript runtime or calls <strong><a href="#communication-send">send()</a></strong>. This includes any
API built on top of <strong><a href="#communication-send">send()</a></strong>, like when returning from an
<strong><a href="#rpc-exports">RPC</a></strong> method, and calling any method on the <strong><a href="#console">console</a></strong> API.</p>
  </li>
</ul>

<h3 id="stalker">Stalker</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Stalker.exclude(range)</code>: marks the specified memory <code class="language-plaintext highlighter-rouge">range</code> as excluded,
which is an object with <code class="language-plaintext highlighter-rouge">base</code> and <code class="language-plaintext highlighter-rouge">size</code> properties – like the properties
in an object returned by e.g. <a href="#process-getmodulebyname"><code class="language-plaintext highlighter-rouge">Process.getModuleByName()</code></a>.</p>

    <p>This means Stalker will not follow execution when encountering a call to an
instruction in such a range. You will thus be able to observe/modify the
arguments going in, and the return value coming back, but won’t see the
instructions that happened between.</p>

    <p>Useful to improve performance and reduce noise.</p>
  </li>
  <li>
    <p id="stalker-follow"><code class="language-plaintext highlighter-rouge">Stalker.follow([threadId, options])</code>: start stalking <code class="language-plaintext highlighter-rouge">threadId</code> (or the
current thread if omitted), optionally with <code class="language-plaintext highlighter-rouge">options</code> for enabling events.</p>

    <p>For example:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">mainThread</span> <span class="o">=</span> <span class="nx">Process</span><span class="p">.</span><span class="nx">enumerateThreads</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>

<span class="nx">Stalker</span><span class="p">.</span><span class="nx">follow</span><span class="p">(</span><span class="nx">mainThread</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">events</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">call</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// CALL instructions: yes please</span>

    <span class="c1">// Other events:</span>
    <span class="na">ret</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// RET instructions</span>
    <span class="na">exec</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// all instructions: not recommended as it's</span>
                 <span class="c1">//                   a lot of data</span>
    <span class="na">block</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// block executed: coarse execution trace</span>
    <span class="na">compile</span><span class="p">:</span> <span class="kc">false</span> <span class="c1">// block compiled: useful for coverage</span>
  <span class="p">},</span>

  <span class="c1">//</span>
  <span class="c1">// Only specify one of the two following callbacks.</span>
  <span class="c1">// (See note below.)</span>
  <span class="c1">//</span>

  <span class="c1">//</span>
  <span class="c1">// onReceive: Called with `events` containing a binary blob</span>
  <span class="c1">//            comprised of one or more GumEvent structs.</span>
  <span class="c1">//            See `gumevent.h` for details about the</span>
  <span class="c1">//            format. Use `Stalker.parse()` to examine the</span>
  <span class="c1">//            data.</span>
  <span class="c1">//</span>
  <span class="c1">//onReceive(events) {</span>
  <span class="c1">//},</span>
  <span class="c1">//</span>

  <span class="c1">//</span>
  <span class="c1">// onCallSummary: Called with `summary` being a key-value</span>
  <span class="c1">//                mapping of call target to number of</span>
  <span class="c1">//                calls, in the current time window. You</span>
  <span class="c1">//                would typically implement this instead of</span>
  <span class="c1">//                `onReceive()` for efficiency, i.e. when</span>
  <span class="c1">//                you only want to know which targets were</span>
  <span class="c1">//                called and how many times, but don't care</span>
  <span class="c1">//                about the order that the calls happened</span>
  <span class="c1">//                in.</span>
  <span class="c1">//</span>
  <span class="nx">onCallSummary</span><span class="p">(</span><span class="nx">summary</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">},</span>

  <span class="c1">//</span>
  <span class="c1">// Advanced users: This is how you can plug in your own</span>
  <span class="c1">//                 StalkerTransformer, where the provided</span>
  <span class="c1">//                 function is called synchronously</span>
  <span class="c1">//                 whenever Stalker wants to recompile</span>
  <span class="c1">//                 a basic block of the code that's about</span>
  <span class="c1">//                 to be executed by the stalked thread.</span>
  <span class="c1">//</span>
  <span class="c1">//transform(iterator) {</span>
  <span class="c1">//  let instruction = iterator.next();</span>
  <span class="c1">//</span>
  <span class="c1">//  const startAddress = instruction.address;</span>
  <span class="c1">//  const isAppCode = startAddress.compare(appStart) &gt;= 0 &amp;&amp;</span>
  <span class="c1">//      startAddress.compare(appEnd) === -1;</span>
  <span class="c1">//</span>
  <span class="c1">//  do {</span>
  <span class="c1">//    if (isAppCode &amp;&amp; instruction.mnemonic === 'ret') {</span>
  <span class="c1">//      iterator.putCmpRegI32('eax', 60);</span>
  <span class="c1">//      iterator.putJccShortLabel('jb', 'nope', 'no-hint');</span>
  <span class="c1">//</span>
  <span class="c1">//      iterator.putCmpRegI32('eax', 90);</span>
  <span class="c1">//      iterator.putJccShortLabel('ja', 'nope', 'no-hint');</span>
  <span class="c1">//</span>
  <span class="c1">//      iterator.putCallout(onMatch);</span>
  <span class="c1">//</span>
  <span class="c1">//      iterator.putLabel('nope');</span>
  <span class="c1">//    }</span>
  <span class="c1">//</span>
  <span class="c1">//    iterator.keep();</span>
  <span class="c1">//  } while ((instruction = iterator.next()) !== null);</span>
  <span class="c1">//},</span>
  <span class="c1">//</span>
  <span class="c1">// The default implementation is just:</span>
  <span class="c1">//</span>
  <span class="c1">//   while (iterator.next() !== null)</span>
  <span class="c1">//     iterator.keep();</span>
  <span class="c1">//</span>
  <span class="c1">// The example above shows how you can insert your own code</span>
  <span class="c1">// just before every `ret` instruction across any code</span>
  <span class="c1">// executed by the stalked thread inside the app's own</span>
  <span class="c1">// memory range. It inserts code that checks if the `eax`</span>
  <span class="c1">// register contains a value between 60 and 90, and inserts</span>
  <span class="c1">// a synchronous callout back into JavaScript whenever that</span>
  <span class="c1">// is the case. The callback receives a single argument</span>
  <span class="c1">// that gives it access to the CPU registers, and it is</span>
  <span class="c1">// also able to modify them.</span>
  <span class="c1">//</span>
  <span class="c1">// function onMatch (context) {</span>
  <span class="c1">//   console.log('Match! pc=' + context.pc +</span>
  <span class="c1">//       ' rax=' + context.rax.toInt32());</span>
  <span class="c1">// }</span>
  <span class="c1">//</span>
  <span class="c1">// Note that not calling keep() will result in the</span>
  <span class="c1">// instruction getting dropped, which makes it possible</span>
  <span class="c1">// for your transform to fully replace certain instructions</span>
  <span class="c1">// when this is desirable.</span>
  <span class="c1">//</span>

  <span class="c1">//</span>
  <span class="c1">// Want better performance? Write the callbacks in C:</span>
  <span class="c1">//</span>
  <span class="c1">// /*</span>
  <span class="c1">//  * const cm = new CModule(\`</span>
  <span class="c1">//  *</span>
  <span class="c1">//  * #include &lt;gum/gumstalker.h&gt;</span>
  <span class="c1">//  *</span>
  <span class="c1">//  * static void on_ret (GumCpuContext * cpu_context,</span>
  <span class="c1">//  *     gpointer user_data);</span>
  <span class="c1">//  *</span>
  <span class="c1">//  * void</span>
  <span class="c1">//  * transform (GumStalkerIterator * iterator,</span>
  <span class="c1">//  *            GumStalkerOutput * output,</span>
  <span class="c1">//  *            gpointer user_data)</span>
  <span class="c1">//  * {</span>
  <span class="c1">//  *   cs_insn * insn;</span>
  <span class="c1">//  *</span>
  <span class="c1">//  *   while (gum_stalker_iterator_next (iterator, &amp;insn))</span>
  <span class="c1">//  *   {</span>
  <span class="c1">//  *     if (insn-&gt;id == X86_INS_RET)</span>
  <span class="c1">//  *     {</span>
  <span class="c1">//  *       gum_x86_writer_put_nop (output-&gt;writer.x86);</span>
  <span class="c1">//  *       gum_stalker_iterator_put_callout (iterator,</span>
  <span class="c1">//  *           on_ret, NULL, NULL);</span>
  <span class="c1">//  *     }</span>
  <span class="c1">//  *</span>
  <span class="c1">//  *     gum_stalker_iterator_keep (iterator);</span>
  <span class="c1">//  *   }</span>
  <span class="c1">//  * }</span>
  <span class="c1">//  *</span>
  <span class="c1">//  * static void</span>
  <span class="c1">//  * on_ret (GumCpuContext * cpu_context,</span>
  <span class="c1">//  *         gpointer user_data)</span>
  <span class="c1">//  * {</span>
  <span class="c1">//  *   printf ("on_ret!\n");</span>
  <span class="c1">//  * }</span>
  <span class="c1">//  *</span>
  <span class="c1">//  * void</span>
  <span class="c1">//  * process (const GumEvent * event,</span>
  <span class="c1">//  *          GumCpuContext * cpu_context,</span>
  <span class="c1">//  *          gpointer user_data)</span>
  <span class="c1">//  * {</span>
  <span class="c1">//  *   switch (event-&gt;type)</span>
  <span class="c1">//  *   {</span>
  <span class="c1">//  *     case GUM_CALL:</span>
  <span class="c1">//  *       break;</span>
  <span class="c1">//  *     case GUM_RET:</span>
  <span class="c1">//  *       break;</span>
  <span class="c1">//  *     case GUM_EXEC:</span>
  <span class="c1">//  *       break;</span>
  <span class="c1">//  *     case GUM_BLOCK:</span>
  <span class="c1">//  *       break;</span>
  <span class="c1">//  *     case GUM_COMPILE:</span>
  <span class="c1">//  *       break;</span>
  <span class="c1">//  *     default:</span>
  <span class="c1">//  *       break;</span>
  <span class="c1">//  *   }</span>
  <span class="c1">//  * }</span>
  <span class="c1">//  * `);</span>
  <span class="c1">//  */</span>
  <span class="c1">//</span>
  <span class="c1">//transform: cm.transform,</span>
  <span class="c1">//onEvent: cm.process,</span>
  <span class="c1">//data: ptr(1337) /* user_data */</span>
  <span class="c1">//</span>
  <span class="c1">// You may also use a hybrid approach and only write</span>
  <span class="c1">// some of the callouts in C.</span>
  <span class="c1">//</span>
<span class="p">});</span></code></pre></figure>

<div class="note">
  <h5>Performance considerations</h5>
  <p>
    The callbacks provided have a significant impact on performance. If you only
    need periodic call summaries but do not care about the raw events, or the
    other way around, make sure you omit the callback that you don't need; i.e.
    avoid putting your logic in <i>onCallSummary</i> and leaving
    <i>onReceive</i> in there as an empty callback.
  </p>
  <p>
    Also note that Stalker may be used in conjunction with <strong><a href="#cmodule">CModule</a></strong>,
    which means the callbacks may be implemented in C.
  </p>
</div>

<ul>
  <li>
    <p id="stalker-unfollow"><code class="language-plaintext highlighter-rouge">Stalker.unfollow([threadId])</code>: stop stalking <code class="language-plaintext highlighter-rouge">threadId</code> (or the current
thread if omitted).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Stalker.parse(events[, options])</code>: parse GumEvent binary blob, optionally
with <code class="language-plaintext highlighter-rouge">options</code> for customizing the output.</p>

    <p>For example:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js">  <span class="nx">onReceive</span><span class="p">(</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Stalker</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">annotate</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// to display the type of event</span>
      <span class="na">stringify</span><span class="p">:</span> <span class="kc">true</span>
        <span class="c1">// to format pointer values as strings instead of `NativePointer`</span>
        <span class="c1">// values, i.e. less overhead if you're just going to `send()` the</span>
        <span class="c1">// thing not actually parse the data agent-side</span>
    <span class="p">}));</span>
  <span class="p">},</span></code></pre></figure>

<ul>
  <li>
    <p id="stalker-flush"><code class="language-plaintext highlighter-rouge">Stalker.flush()</code>: flush out any buffered events. Useful when you don’t want
to wait until the next <a href="#stalker-queuedraininterval"><code class="language-plaintext highlighter-rouge">Stalker.queueDrainInterval</code></a> tick.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Stalker.garbageCollect()</code>: free accumulated memory at a safe point after
<a href="#stalker-unfollow"><code class="language-plaintext highlighter-rouge">Stalker#unfollow</code></a>. This is needed to avoid race-conditions
where the thread just unfollowed is executing its last instructions.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Stalker.invalidate(address)</code>: invalidates the current thread’s translated
code for a given basic block. Useful when providing a transform callback and
wanting to dynamically adapt the instrumentation for a given basic block.
This is much more efficient than unfollowing and re-following the thread,
which would discard all cached translations and require all encountered
basic blocks to be compiled from scratch.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Stalker.invalidate(threadId, address)</code>: invalidates a specific thread’s
translated code for a given basic block. Useful when providing a transform
callback and wanting to dynamically adapt the instrumentation for a given
basic block. This is much more efficient than unfollowing and re-following
the thread, which would discard all cached translations and require all
encountered basic blocks to be compiled from scratch.</p>
  </li>
  <li>
    <p id="stalker-addcallprobe"><code class="language-plaintext highlighter-rouge">Stalker.addCallProbe(address, callback[, data])</code>: call <code class="language-plaintext highlighter-rouge">callback</code> (see
<a href="#interceptor-attach"><code class="language-plaintext highlighter-rouge">Interceptor#attach#onEnter</code></a> for signature) synchronously
when a call is made to <code class="language-plaintext highlighter-rouge">address</code>. Returns an id that can be passed to
<a href="#stalker-removecallprobe"><code class="language-plaintext highlighter-rouge">Stalker#removeCallProbe</code></a> later.</p>

    <p>It is also possible to implement <code class="language-plaintext highlighter-rouge">callback</code> in C using <strong><a href="#cmodule">CModule</a></strong>,
by specifying a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a> instead of a function. Signature:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">void onCall (GumCallSite * site, gpointer user_data)</code></li>
    </ul>

    <p>In such cases, the third optional argument <code class="language-plaintext highlighter-rouge">data</code> may be a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a>
whose value is passed to the callback as <code class="language-plaintext highlighter-rouge">user_data</code>.</p>
  </li>
  <li>
    <p id="stalker-removecallprobe"><code class="language-plaintext highlighter-rouge">Stalker.removeCallProbe</code>: remove a call probe added by
<a href="#stalker-addcallprobe"><code class="language-plaintext highlighter-rouge">Stalker#addCallProbe</code></a>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Stalker.trustThreshold</code>: an integer specifying how many times a piece of
code needs to be executed before it is assumed it can be trusted to not
mutate.
Specify -1 for no trust (slow), 0 to trust code from the get-go, and N to
trust code after it has been executed N times. Defaults to 1.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Stalker.queueCapacity</code>: an integer specifying the capacity of the event
queue in number of events. Defaults to 16384 events.</p>
  </li>
  <li>
    <p id="stalker-queuedraininterval"><code class="language-plaintext highlighter-rouge">Stalker.queueDrainInterval</code>: an integer specifying the time in milliseconds
between each time the event queue is drained. Defaults to 250 ms, which
means that the event queue is drained four times per second. You may also
set this property to zero to disable periodic draining, and instead call
<a href="#stalker-flush"><code class="language-plaintext highlighter-rouge">Stalker.flush()</code></a> when you would like the queue to be drained.</p>
  </li>
</ul>

<h3 id="objc">ObjC</h3>

<ul>
  <li>
    <p id="objc-available"><code class="language-plaintext highlighter-rouge">ObjC.available</code>: a boolean specifying whether the current process has an
Objective-C runtime loaded. Do not invoke any other <code class="language-plaintext highlighter-rouge">ObjC</code> properties or
methods unless this is the case.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ObjC.api</code>: an object mapping function names to <a href="#nativefunction"><code class="language-plaintext highlighter-rouge">NativeFunction</code></a> instances
for direct access to a big portion of the Objective-C runtime API.</p>
  </li>
  <li>
    <p id="objc-classes"><code class="language-plaintext highlighter-rouge">ObjC.classes</code>: an object mapping class names to <a href="#objc-object"><code class="language-plaintext highlighter-rouge">ObjC.Object</code></a>
JavaScript bindings for each of the currently registered classes. You can interact
with objects by using dot notation and replacing colons with underscores, i.e.:
<code class="language-plaintext highlighter-rouge">[NSString stringWithString:@"Hello World"]</code>
becomes
<code class="language-plaintext highlighter-rouge">const { NSString } = ObjC.classes; NSString.stringWithString
    _("Hello World");</code>.
Note the underscore after the method name. Refer to iOS Examples section for
more details.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ObjC.protocols</code>: an object mapping protocol names to <a href="#objc-protocol"><code class="language-plaintext highlighter-rouge">ObjC.Protocol</code></a>
JavaScript bindings for each of the currently registered protocols.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ObjC.mainQueue</code>: the GCD queue of the main thread</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ObjC.schedule(queue, work)</code>: schedule the JavaScript function <code class="language-plaintext highlighter-rouge">work</code> on
the GCD queue specified by <code class="language-plaintext highlighter-rouge">queue</code>. An <code class="language-plaintext highlighter-rouge">NSAutoreleasePool</code> is created just
before calling <code class="language-plaintext highlighter-rouge">work</code>, and cleaned up on return.</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">NSSound</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span><span class="p">;</span> <span class="cm">/* macOS */</span>
<span class="nx">ObjC</span><span class="p">.</span><span class="nx">schedule</span><span class="p">(</span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">mainQueue</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sound</span> <span class="o">=</span> <span class="nx">NSSound</span><span class="p">.</span><span class="nx">alloc</span><span class="p">().</span><span class="nx">initWithContentsOfFile_byReference_</span><span class="p">(</span><span class="dl">"</span><span class="s2">/Users/oleavr/.Trash/test.mp3</span><span class="dl">"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="nx">sound</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li><code id="objc-object">new ObjC.Object(handle[, protocol])</code>: create a JavaScript binding given
the existing object at <code class="language-plaintext highlighter-rouge">handle</code> (a <strong><a href="#nativepointer">NativePointer</a></strong>). You may
also specify the <code class="language-plaintext highlighter-rouge">protocol</code> argument if you’d like to treat <code class="language-plaintext highlighter-rouge">handle</code> as an object
implementing a certain protocol only.</li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">myFunction</span><span class="p">.</span><span class="nx">implementation</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">onEnter</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ObjC: args[0] = self, args[1] = selector, args[2-n] = arguments</span>
    <span class="kd">const</span> <span class="nx">myString</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nb">Object</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">String argument: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">myString</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<blockquote>
  <p>This object has some special properties:</p>

  <ul>
    <li><code class="language-plaintext highlighter-rouge">$kind</code>: string specifying either <code class="language-plaintext highlighter-rouge">instance</code>, <code class="language-plaintext highlighter-rouge">class</code> or <code class="language-plaintext highlighter-rouge">meta-class</code></li>
    <li><code class="language-plaintext highlighter-rouge">$super</code>: an <strong><a href="#objc-object">ObjC.Object</a></strong> instance used for chaining up to
super-class method implementations</li>
    <li><code class="language-plaintext highlighter-rouge">$superClass</code>: super-class as an <strong><a href="#objc-object">ObjC.Object</a></strong> instance</li>
    <li><code class="language-plaintext highlighter-rouge">$class</code>: class of this object as an <strong><a href="#objc-object">ObjC.Object</a></strong> instance</li>
    <li><code class="language-plaintext highlighter-rouge">$className</code>: string containing the class name of this object</li>
    <li><code class="language-plaintext highlighter-rouge">$moduleName</code>: string containing the module path of this object</li>
    <li><code class="language-plaintext highlighter-rouge">$protocols</code>: object mapping protocol name to <a href="#objc-protocol"><code class="language-plaintext highlighter-rouge">ObjC.Protocol</code></a>
instance for each of the protocols that this object conforms to</li>
    <li><code class="language-plaintext highlighter-rouge">$methods</code>: array containing native method names exposed by this object’s
class and parent classes</li>
    <li><code class="language-plaintext highlighter-rouge">$ownMethods</code>: array containing native method names exposed by this object’s
class, not including parent classes</li>
    <li><code class="language-plaintext highlighter-rouge">$ivars</code>: object mapping each instance variable name to its current
value, allowing you to read and write each through access and assignment</li>
  </ul>

  <p>There is also an <code class="language-plaintext highlighter-rouge">equals(other)</code> method for checking whether two instances
  refer to the same underlying object.</p>

  <p>Note that all method wrappers provide a <code class="language-plaintext highlighter-rouge">clone(options)</code> API to create a new
  method wrapper with custom <strong><a href="#nativefunction">NativeFunction</a></strong> options.</p>
</blockquote>

<ul>
  <li>
    <p id="objc-protocol"><code class="language-plaintext highlighter-rouge">new ObjC.Protocol(handle)</code>: create a JavaScript binding given the existing
protocol at <code class="language-plaintext highlighter-rouge">handle</code> (a <strong><a href="#nativepointer">NativePointer</a></strong>).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new ObjC.Block(target[, options])</code>: create a JavaScript binding given the
existing block at <code class="language-plaintext highlighter-rouge">target</code> (a <strong><a href="#nativepointer">NativePointer</a></strong>), or, to define
a new block, <code class="language-plaintext highlighter-rouge">target</code> should be an object specifying the type signature and
JavaScript function to call whenever the block is invoked. The function is
specified with an <code class="language-plaintext highlighter-rouge">implementation</code> key, and the signature is specified either
through a <code class="language-plaintext highlighter-rouge">types</code> key, or through the <code class="language-plaintext highlighter-rouge">retType</code> and <code class="language-plaintext highlighter-rouge">argTypes</code> keys. See
<a href="#objc-registerclass"><code class="language-plaintext highlighter-rouge">ObjC.registerClass()</code></a> for details.</p>

    <p>Note that if an existing block lacks signature metadata, you may call
<code class="language-plaintext highlighter-rouge">declare(signature)</code>, where <code class="language-plaintext highlighter-rouge">signature</code> is an object with either a <code class="language-plaintext highlighter-rouge">types</code>
key, or <code class="language-plaintext highlighter-rouge">retType</code> and <code class="language-plaintext highlighter-rouge">argTypes</code> keys, as described above.</p>

    <p>You may also provide an <code class="language-plaintext highlighter-rouge">options</code> object with the same options as supported
by <strong><a href="#nativefunction">NativeFunction</a></strong>, e.g. to pass <code class="language-plaintext highlighter-rouge">traps: 'all'</code> in order
to <a href="#stalker-follow"><code class="language-plaintext highlighter-rouge">Stalker.follow()</code></a> the execution when calling the block.</p>

    <p>The most common use-case is hooking an existing block, which for a block
expecting two arguments would look something like:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">pendingBlocks</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Set</span><span class="p">();</span>

<span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(...,</span> <span class="p">{</span>
  <span class="nx">onEnter</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">block</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">Block</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
    <span class="nx">pendingBlocks</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">block</span><span class="p">);</span> <span class="c1">// Keep it alive</span>
    <span class="kd">const</span> <span class="nx">appCallback</span> <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">implementation</span><span class="p">;</span>
    <span class="nx">block</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Do your logging here</span>
      <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">appCallback</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
      <span class="nx">pendingBlocks</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">block</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ObjC.implement(method, fn)</code>: create a JavaScript implementation compatible
with the signature of <code class="language-plaintext highlighter-rouge">method</code>, where the JavaScript function <code class="language-plaintext highlighter-rouge">fn</code> is used
as the implementation. Returns a <a href="#nativecallback"><code class="language-plaintext highlighter-rouge">NativeCallback</code></a> that you may
assign to an ObjC method’s <code class="language-plaintext highlighter-rouge">implementation</code> property.</li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">NSSound</span> <span class="o">=</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span><span class="p">.</span><span class="nx">NSSound</span><span class="p">;</span> <span class="cm">/* macOS */</span>
<span class="kd">const</span> <span class="nx">oldImpl</span> <span class="o">=</span> <span class="nx">NSSound</span><span class="p">.</span><span class="nx">play</span><span class="p">.</span><span class="nx">implementation</span><span class="p">;</span>
<span class="nx">NSSound</span><span class="p">.</span><span class="nx">play</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">implement</span><span class="p">(</span><span class="nx">NSSound</span><span class="p">.</span><span class="nx">play</span><span class="p">,</span> <span class="p">(</span><span class="nx">handle</span><span class="p">,</span> <span class="nx">selector</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">oldImpl</span><span class="p">(</span><span class="nx">handle</span><span class="p">,</span> <span class="nx">selector</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">NSView</span> <span class="o">=</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span><span class="p">.</span><span class="nx">NSView</span><span class="p">;</span> <span class="cm">/* macOS */</span>
<span class="kd">const</span> <span class="nx">drawRect</span> <span class="o">=</span> <span class="nx">NSView</span><span class="p">[</span><span class="dl">'</span><span class="s1">- drawRect:</span><span class="dl">'</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">oldImpl</span> <span class="o">=</span> <span class="nx">drawRect</span><span class="p">.</span><span class="nx">implementation</span><span class="p">;</span>
<span class="nx">drawRect</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">implement</span><span class="p">(</span><span class="nx">drawRect</span><span class="p">,</span> <span class="p">(</span><span class="nx">handle</span><span class="p">,</span> <span class="nx">selector</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">oldImpl</span><span class="p">(</span><span class="nx">handle</span><span class="p">,</span> <span class="nx">selector</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<blockquote>
  <p>As the <code class="language-plaintext highlighter-rouge">implementation</code> property is a <a href="#nativefunction"><code class="language-plaintext highlighter-rouge">NativeFunction</code></a> and thus also a
  <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a>, you may also use <a href="#interceptor"><code class="language-plaintext highlighter-rouge">Interceptor</code></a> to hook functions:</p>
</blockquote>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">NSSound</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span><span class="p">;</span> <span class="cm">/* macOS */</span>
<span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">NSSound</span><span class="p">.</span><span class="nx">play</span><span class="p">.</span><span class="nx">implementation</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">onEnter</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">[NSSound play]</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ObjC.registerProxy(properties)</code>: create a new class designed to act as a
proxy for a target object, where <code class="language-plaintext highlighter-rouge">properties</code> is an object specifying:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">protocols</code>: (optional) Array of protocols this class conforms to.</li>
      <li><code class="language-plaintext highlighter-rouge">methods</code>: (optional) Object specifying methods to implement.</li>
      <li><code class="language-plaintext highlighter-rouge">events</code>: (optional) Object specifying callbacks for getting notified
about events:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">dealloc()</code>: Called right after the object has been deallocated.
This is where you might clean up any associated state.</li>
          <li><code class="language-plaintext highlighter-rouge">forward(name)</code>: Called with <code class="language-plaintext highlighter-rouge">name</code> specifying the method name that
we’re about to forward a call to. This might be where you’d start
out with a temporary callback that just logs the names to help you
decide which methods to override.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">MyConnectionDelegateProxy</span> <span class="o">=</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">registerProxy</span><span class="p">({</span>
  <span class="na">protocols</span><span class="p">:</span> <span class="p">[</span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">protocols</span><span class="p">.</span><span class="nx">NSURLConnectionDataDelegate</span><span class="p">],</span>
  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">- connection:didReceiveResponse:</span><span class="dl">'</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">conn</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/* fancy logging code here */</span>
      <span class="cm">/* this.data.foo === 1234 */</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">target</span>
          <span class="p">.</span><span class="nx">connection_didReceiveResponse_</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span> <span class="nx">resp</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="dl">'</span><span class="s1">- connection:didReceiveData:</span><span class="dl">'</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">conn</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/* other logging code here */</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">target</span>
          <span class="p">.</span><span class="nx">connection_didReceiveData_</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">events</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">forward</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">*** forwarding: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span><span class="p">.</span><span class="nx">NSURLConnection</span><span class="p">[</span>
    <span class="dl">'</span><span class="s1">- initWithRequest:delegate:startImmediately:</span><span class="dl">'</span><span class="p">];</span>
<span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">method</span><span class="p">.</span><span class="nx">implementation</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">onEnter</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyConnectionDelegateProxy</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">{</span>
      <span class="na">foo</span><span class="p">:</span> <span class="mi">1234</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li>
    <p id="objc-registerclass"><code class="language-plaintext highlighter-rouge">ObjC.registerClass(properties)</code>: create a new Objective-C class, where
<code class="language-plaintext highlighter-rouge">properties</code> is an object specifying:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">name</code>: (optional) String specifying the name of the class; omit this
if you don’t care about the globally visible name and would like the
runtime to auto-generate one for you.</li>
      <li><code class="language-plaintext highlighter-rouge">super</code>: (optional) Super-class, or <em>null</em> to create a new root class;
omit to inherit from <em>NSObject</em>.</li>
      <li><code class="language-plaintext highlighter-rouge">protocols</code>: (optional) Array of protocols this class conforms to.</li>
      <li><code class="language-plaintext highlighter-rouge">methods</code>: (optional) Object specifying methods to implement.</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">MyConnectionDelegateProxy</span> <span class="o">=</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">registerClass</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">MyConnectionDelegateProxy</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">super</span><span class="p">:</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span><span class="p">.</span><span class="nx">NSObject</span><span class="p">,</span>
  <span class="na">protocols</span><span class="p">:</span> <span class="p">[</span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">protocols</span><span class="p">.</span><span class="nx">NSURLConnectionDataDelegate</span><span class="p">],</span>
  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">- init</span><span class="dl">'</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nb">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="k">super</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">self</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ObjC</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="p">{</span>
          <span class="na">foo</span><span class="p">:</span> <span class="mi">1234</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="dl">'</span><span class="s1">- dealloc</span><span class="dl">'</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">ObjC</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nb">self</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="k">super</span><span class="p">.</span><span class="nx">dealloc</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="dl">'</span><span class="s1">- connection:didReceiveResponse:</span><span class="dl">'</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">conn</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/* this.data.foo === 1234 */</span>
    <span class="p">},</span>
    <span class="cm">/*
     * But those previous methods are declared assuming that
     * either the super-class or a protocol we conform to has
     * the same method so we can grab its type information.
     * However, if that's not the case, you would write it
     * like this:
     */</span>
    <span class="dl">'</span><span class="s1">- connection:didReceiveResponse:</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">retType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">void</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">argTypes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">object</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">object</span><span class="dl">'</span><span class="p">],</span>
      <span class="na">implementation</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">conn</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="cm">/* Or grab it from an existing class: */</span>
    <span class="dl">'</span><span class="s1">- connection:didReceiveResponse:</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">types</span><span class="p">:</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span>
          <span class="p">.</span><span class="nx">Foo</span><span class="p">[</span><span class="dl">'</span><span class="s1">- connection:didReceiveResponse:</span><span class="dl">'</span><span class="p">].</span><span class="nx">types</span><span class="p">,</span>
      <span class="na">implementation</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">conn</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="cm">/* Or from an existing protocol: */</span>
    <span class="dl">'</span><span class="s1">- connection:didReceiveResponse:</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">types</span><span class="p">:</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">protocols</span><span class="p">.</span><span class="nx">NSURLConnectionDataDelegate</span>
          <span class="p">.</span><span class="nx">methods</span><span class="p">[</span><span class="dl">'</span><span class="s1">- connection:didReceiveResponse:</span><span class="dl">'</span><span class="p">].</span><span class="nx">types</span><span class="p">,</span>
      <span class="na">implementation</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">conn</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="cm">/* Or write the signature by hand if you really want to: */</span>
    <span class="dl">'</span><span class="s1">- connection:didReceiveResponse:</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">types</span><span class="p">:</span> <span class="dl">'</span><span class="s1"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f385c0c1b3c3">[email&#160;protected]</a>:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3008700106">[email&#160;protected]</a>@24</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">implementation</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">conn</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="nx">MyConnectionDelegateProxy</span><span class="p">.</span><span class="nx">alloc</span><span class="p">().</span><span class="nx">init</span><span class="p">();</span>
<span class="cm">/* use `proxy`, and later: */</span>
<span class="nx">proxy</span><span class="p">.</span><span class="nx">release</span><span class="p">();</span></code></pre></figure>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ObjC.registerProtocol(properties)</code>: create a new Objective-C protocol,
where <code class="language-plaintext highlighter-rouge">properties</code> is an object specifying:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">name</code>: (optional) String specifying the name of the protocol; omit this
if you don’t care about the globally visible name and would like the
runtime to auto-generate one for you.</li>
      <li><code class="language-plaintext highlighter-rouge">protocols</code>: (optional) Array of protocols this protocol incorporates.</li>
      <li><code class="language-plaintext highlighter-rouge">methods</code>: (optional) Object specifying methods to declare.</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">MyDataDelegate</span> <span class="o">=</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">registerProtocol</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">MyDataDelegate</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">protocols</span><span class="p">:</span> <span class="p">[</span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">protocols</span><span class="p">.</span><span class="nx">NSURLConnectionDataDelegate</span><span class="p">],</span>
  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>
    <span class="cm">/* You must specify the signature: */</span>
    <span class="dl">'</span><span class="s1">- connection:didStuff:</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">retType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">void</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">argTypes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">object</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">object</span><span class="dl">'</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="cm">/* Or grab it from a method of an existing class: */</span>
    <span class="dl">'</span><span class="s1">- connection:didStuff:</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">types</span><span class="p">:</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span>
          <span class="p">.</span><span class="nx">Foo</span><span class="p">[</span><span class="dl">'</span><span class="s1">- connection:didReceiveResponse:</span><span class="dl">'</span><span class="p">].</span><span class="nx">types</span>
    <span class="p">},</span>
    <span class="cm">/* Or from an existing protocol method: */</span>
    <span class="dl">'</span><span class="s1">- connection:didStuff:</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">types</span><span class="p">:</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">protocols</span><span class="p">.</span><span class="nx">NSURLConnectionDataDelegate</span>
          <span class="p">.</span><span class="nx">methods</span><span class="p">[</span><span class="dl">'</span><span class="s1">- connection:didReceiveResponse:</span><span class="dl">'</span><span class="p">].</span><span class="nx">types</span>
    <span class="p">},</span>
    <span class="cm">/* Or write the signature by hand if you really want to: */</span>
    <span class="dl">'</span><span class="s1">- connection:didStuff:</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">types</span><span class="p">:</span> <span class="dl">'</span><span class="s1"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e99fdadba9d9">[email&#160;protected]</a>:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8bb3cbbabd">[email&#160;protected]</a>@24</span><span class="dl">'</span>
    <span class="p">},</span>
    <span class="cm">/* You can also make a method optional (default is required): */</span>
    <span class="dl">'</span><span class="s1">- connection:didStuff:</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">retType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">void</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">argTypes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">object</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">object</span><span class="dl">'</span><span class="p">],</span>
      <span class="na">optional</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ObjC.bind(obj, data)</code>: bind some JavaScript data to an Objective-C
instance; see <a href="#objc-registerclass"><code class="language-plaintext highlighter-rouge">ObjC.registerClass()</code></a> for an example.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ObjC.unbind(obj)</code>: unbind previous associated JavaScript data from an
Objective-C instance; see <a href="#objc-registerclass"><code class="language-plaintext highlighter-rouge">ObjC.registerClass()</code></a> for an example.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ObjC.getBoundData(obj)</code>: look up previously bound data from an Objective-C
object.</p>
  </li>
  <li>
    <p id="objc-enumerateloadedclasses"><code class="language-plaintext highlighter-rouge">ObjC.enumerateLoadedClasses([options, ]callbacks)</code>: enumerate classes
loaded right now, where <code class="language-plaintext highlighter-rouge">callbacks</code> is an object specifying:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">onMatch(name, owner)</code>: called for each loaded class with the <code class="language-plaintext highlighter-rouge">name</code> of
the class as a string, and <code class="language-plaintext highlighter-rouge">owner</code> specifying the path to the module
where the class was loaded from. To obtain a JavaScript wrapper for a
given class, do: <a href="#objc-classes"><code class="language-plaintext highlighter-rouge">ObjC.classes[name]</code></a>.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">onComplete()</code>: called when all classes have been enumerated.</p>
      </li>
    </ul>

    <p>For example:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">ObjC</span><span class="p">.</span><span class="nx">enumerateLoadedClasses</span><span class="p">({</span>
  <span class="nx">onMatch</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">owner</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">onMatch:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">owner</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">onComplete</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>The optional <code class="language-plaintext highlighter-rouge">options</code> argument is an object where you may specify the
<code class="language-plaintext highlighter-rouge">ownedBy</code> property to limit enumeration to modules in a given <a href="#modulemap"><code class="language-plaintext highlighter-rouge">ModuleMap</code></a>.</p>

<p>For example:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">appModules</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ModuleMap</span><span class="p">(</span><span class="nx">isAppModule</span><span class="p">);</span>
<span class="nx">ObjC</span><span class="p">.</span><span class="nx">enumerateLoadedClasses</span><span class="p">({</span> <span class="na">ownedBy</span><span class="p">:</span> <span class="nx">appModules</span> <span class="p">},</span> <span class="p">{</span>
  <span class="nx">onMatch</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">owner</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">onMatch:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">owner</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">onComplete</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">isAppModule</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">!</span><span class="sr">/^</span><span class="se">\/(</span><span class="sr">usr</span><span class="se">\/</span><span class="sr">lib|System|Developer</span><span class="se">)\/</span><span class="sr">/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">path</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ObjC.enumerateLoadedClassesSync([options])</code>: synchronous version of
<a href="#objc-enumerateloadedclasses"><code class="language-plaintext highlighter-rouge">enumerateLoadedClasses()</code></a> that returns an object
mapping owner module to an array of class names.</p>

    <p>For example:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">appModules</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ModuleMap</span><span class="p">(</span><span class="nx">isAppModule</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">appClasses</span> <span class="o">=</span> <span class="nx">ObjC</span><span class="p">.</span><span class="nx">enumerateLoadedClassesSync</span><span class="p">({</span> <span class="na">ownedBy</span><span class="p">:</span> <span class="nx">appModules</span> <span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">appClasses:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">appClasses</span><span class="p">));</span>

<span class="kd">function</span> <span class="nx">isAppModule</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">!</span><span class="sr">/^</span><span class="se">\/(</span><span class="sr">usr</span><span class="se">\/</span><span class="sr">lib|System|Developer</span><span class="se">)\/</span><span class="sr">/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">path</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<ul>
  <li>
    <p id="objc-choose"><code class="language-plaintext highlighter-rouge">ObjC.choose(specifier, callbacks)</code>: enumerate live instances of classes
matching <code class="language-plaintext highlighter-rouge">specifier</code> by scanning the heap. <code class="language-plaintext highlighter-rouge">specifier</code> is either a class
selector or an object specifying a class selector and desired options.
The class selector is an <strong><a href="#objc-object">ObjC.Object</a></strong> of a class, e.g.
<em>ObjC.classes.UIButton</em>.
When passing an object as the specifier you should provide the <code class="language-plaintext highlighter-rouge">class</code>
field with your class selector, and the <code class="language-plaintext highlighter-rouge">subclasses</code> field with a
boolean indicating whether you’re also interested in subclasses matching the
given class selector. The default is to also include subclasses.
The <code class="language-plaintext highlighter-rouge">callbacks</code> argument is an object specifying:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">onMatch(instance)</code>: called once for each live instance found with a
ready-to-use <code class="language-plaintext highlighter-rouge">instance</code> just as if you would have called
<a href="#objc-object"><code class="language-plaintext highlighter-rouge">new ObjC.Object(ptr("0x1234"))</code></a> knowing that this
particular Objective-C instance lives at <em>0x1234</em>.</p>

        <p>This function may return the string <code class="language-plaintext highlighter-rouge">stop</code> to cancel the enumeration
early.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">onComplete()</code>: called when all instances have been enumerated</p>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ObjC.chooseSync(specifier)</code>: synchronous version of <a href="#objc-choose"><code class="language-plaintext highlighter-rouge">choose()</code></a>
that returns the instances in an array.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ObjC.selector(name)</code>: convert the JavaScript string <code class="language-plaintext highlighter-rouge">name</code> to a selector</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ObjC.selectorAsString(sel)</code>: convert the selector <code class="language-plaintext highlighter-rouge">sel</code> to a JavaScript
string</p>
  </li>
</ul>

<h3 id="java">Java</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Java.available</code>: a boolean specifying whether the current process has the
a Java VM loaded, i.e. Dalvik or ART. Do not invoke any other <code class="language-plaintext highlighter-rouge">Java</code>
properties or methods unless this is the case.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Java.androidVersion</code>: a string specifying which version of Android we’re
running on.</p>
  </li>
  <li>
    <p id="java-enumerateloadedclasses"><code class="language-plaintext highlighter-rouge">Java.enumerateLoadedClasses(callbacks)</code>: enumerate classes loaded right
now, where <code class="language-plaintext highlighter-rouge">callbacks</code> is an object specifying:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">onMatch(name, handle)</code>: called for each loaded class with <code class="language-plaintext highlighter-rouge">name</code> that
may be passed to <a href="#java-use"><code class="language-plaintext highlighter-rouge">use()</code></a> to get a JavaScript wrapper.
You may also <a href="#java-cast"><code class="language-plaintext highlighter-rouge">Java.cast()</code></a> the <code class="language-plaintext highlighter-rouge">handle</code> to <code class="language-plaintext highlighter-rouge">java.lang.Class</code>.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">onComplete()</code>: called when all classes have been enumerated.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Java.enumerateLoadedClassesSync()</code>: synchronous version of
<a href="#java-enumerateloadedclasses"><code class="language-plaintext highlighter-rouge">enumerateLoadedClasses()</code></a> that returns the
class names in an array.</p>
  </li>
  <li>
    <p id="java-enumerateclassloaders"><code class="language-plaintext highlighter-rouge">Java.enumerateClassLoaders(callbacks)</code>: enumerate class loaders present
in the Java VM, where <code class="language-plaintext highlighter-rouge">callbacks</code> is an object specifying:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">onMatch(loader)</code>: called for each class loader with <code class="language-plaintext highlighter-rouge">loader</code>, a wrapper
for the specific <code class="language-plaintext highlighter-rouge">java.lang.ClassLoader</code>.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">onComplete()</code>: called when all class loaders have been enumerated.</p>
      </li>
    </ul>

    <p>You may pass such a loader to <code class="language-plaintext highlighter-rouge">Java.ClassFactory.get()</code> to be able to
<a href="#java-use"><code class="language-plaintext highlighter-rouge">.use()</code></a> classes on the specified class loader.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Java.enumerateClassLoadersSync()</code>: synchronous version of
<a href="#java-enumerateclassloaders"><code class="language-plaintext highlighter-rouge">enumerateClassLoaders()</code></a> that returns the
class loaders in an array.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Java.enumerateMethods(query)</code>: enumerate methods matching <code class="language-plaintext highlighter-rouge">query</code>,
specified as <code class="language-plaintext highlighter-rouge">"class!method"</code>, with globs permitted. May also be suffixed
with <code class="language-plaintext highlighter-rouge">/</code> and one or more modifiers:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">i</code>: Case-insensitive matching.</li>
      <li><code class="language-plaintext highlighter-rouge">s</code>: Include method signatures, so e.g. <code class="language-plaintext highlighter-rouge">"putInt"</code> becomes
<code class="language-plaintext highlighter-rouge">"putInt(java.lang.String, int): void"</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">u</code>: User-defined classes only, ignoring system classes.</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">groups</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">enumerateMethods</span><span class="p">(</span><span class="dl">'</span><span class="s1">*youtube*!on*</span><span class="dl">'</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">groups</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
<span class="p">});</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"loader"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;instance: java.lang.ClassLoader, $className: dalvik.system.PathClassLoader&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"classes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"com.google.android.apps.youtube.app.watch.nextgenwatch.ui.NextGenWatchLayout"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"onAttachedToWindow"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"onDetachedFromWindow"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"onFinishInflate"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"onInterceptTouchEvent"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"onLayout"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"onMeasure"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"onSizeChanged"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"onTouchEvent"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"onViewRemoved"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"com.google.android.apps.youtube.app.search.suggest.YouTubeSuggestionProvider"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"onCreate"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"com.google.android.libraries.youtube.common.ui.YouTubeButton"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"onInitializeAccessibilityNodeInfo"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="err">…</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span></code></pre></figure>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Java.scheduleOnMainThread(fn)</code>: run <code class="language-plaintext highlighter-rouge">fn</code> on the main thread of the VM.</p>
  </li>
  <li>
    <p id="java-perform"><code class="language-plaintext highlighter-rouge">Java.perform(fn)</code>: ensure that the current thread is attached to the VM
and call <code class="language-plaintext highlighter-rouge">fn</code>. (This isn’t necessary in callbacks from Java.)
Will defer calling <code class="language-plaintext highlighter-rouge">fn</code> if the app’s class loader is not available yet.
Use <a href="#java-performnow"><code class="language-plaintext highlighter-rouge">Java.performNow()</code></a> if access to the app’s classes is not needed.</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">Activity</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">android.app.Activity</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">Activity</span><span class="p">.</span><span class="nx">onResume</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">onResume() got called! Let</span><span class="se">\'</span><span class="s1">s call the original implementation</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onResume</span><span class="p">();</span>
  <span class="p">};</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li>
    <p id="java-performnow"><code class="language-plaintext highlighter-rouge">Java.performNow(fn)</code>: ensure that the current thread is attached to the
VM and call <code class="language-plaintext highlighter-rouge">fn</code>. (This isn’t necessary in callbacks from Java.)</p>
  </li>
  <li>
    <p id="java-use"><code class="language-plaintext highlighter-rouge">Java.use(className)</code>: dynamically get a JavaScript wrapper for
<code class="language-plaintext highlighter-rouge">className</code> that you can instantiate objects from by calling <code class="language-plaintext highlighter-rouge">$new()</code> on
it to invoke a constructor. Call <code class="language-plaintext highlighter-rouge">$dispose()</code> on an instance to clean it
up explicitly (or wait for the JavaScript object to get garbage-collected,
or script to get unloaded). Static and non-static methods are available,
and you can even replace a method implementation and throw an exception
from it:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">Activity</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">android.app.Activity</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">Exception</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">java.lang.Exception</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">Activity</span><span class="p">.</span><span class="nx">onResume</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nx">Exception</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="dl">'</span><span class="s1">Oh noes!</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">});</span></code></pre></figure>

<blockquote>
  <p>Uses the app’s class loader by default, but you may customize this by
  assigning a different loader instance to <code class="language-plaintext highlighter-rouge">Java.classFactory.loader</code>.</p>

  <p>Note that all method wrappers provide a <code class="language-plaintext highlighter-rouge">clone(options)</code> API to create a new
  method wrapper with custom <strong><a href="#nativefunction">NativeFunction</a></strong> options.</p>
</blockquote>

<ul>
  <li>
    <p id="java-openclassfile"><code class="language-plaintext highlighter-rouge">Java.openClassFile(filePath)</code>: open the .dex file at <code class="language-plaintext highlighter-rouge">filePath</code>, returning
an object with the following methods:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">load()</code>: load the contained classes into the VM.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">getClassNames()</code>: obtain an array of available class names.</p>
      </li>
    </ul>
  </li>
  <li>
    <p id="java-choose"><code class="language-plaintext highlighter-rouge">Java.choose(className, callbacks)</code>: enumerate live instances of the
<code class="language-plaintext highlighter-rouge">className</code> class by scanning the Java heap, where <code class="language-plaintext highlighter-rouge">callbacks</code> is an
object specifying:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">onMatch(instance)</code>: called with each live instance found with a
ready-to-use <code class="language-plaintext highlighter-rouge">instance</code> just as if you would have called
<a href="#java-cast"><code class="language-plaintext highlighter-rouge">Java.cast()</code></a> with a raw handle to this particular instance.</p>

        <p>This function may return the string <code class="language-plaintext highlighter-rouge">stop</code> to cancel the enumeration
early.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">onComplete()</code>: called when all instances have been enumerated</p>
      </li>
    </ul>
  </li>
  <li>
    <p id="java-retain"><code class="language-plaintext highlighter-rouge">Java.retain(obj)</code>: duplicates the JavaScript wrapper <code class="language-plaintext highlighter-rouge">obj</code> for later use
outside replacement method.</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">Activity</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">android.app.Activity</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">lastActivity</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nx">Activity</span><span class="p">.</span><span class="nx">onResume</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">lastActivity</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">retain</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onResume</span><span class="p">();</span>
  <span class="p">};</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li><code id="java-cast">Java.cast(handle, klass)</code>: create a JavaScript wrapper
given the existing instance at <code class="language-plaintext highlighter-rouge">handle</code> of given class <code class="language-plaintext highlighter-rouge">klass</code> as returned from
<a href="#java-use"><code class="language-plaintext highlighter-rouge">Java.use()</code></a>.
Such a wrapper also has a <code class="language-plaintext highlighter-rouge">class</code> property for getting a wrapper for its
class, and a <code class="language-plaintext highlighter-rouge">$className</code> property for getting a string representation of
its class-name.</li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">Activity</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">android.app.Activity</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">activity</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">cast</span><span class="p">(</span><span class="nx">ptr</span><span class="p">(</span><span class="dl">'</span><span class="s1">0x1234</span><span class="dl">'</span><span class="p">),</span> <span class="nx">Activity</span><span class="p">);</span></code></pre></figure>

<ul>
  <li><code id="java-array">Java.array(type, elements)</code>: creates a Java array with
 elements of the specified <code class="language-plaintext highlighter-rouge">type</code>, from a JavaScript array <code class="language-plaintext highlighter-rouge">elements</code>. The
 resulting Java array behaves like a JS array, but can be passed by reference to
 Java APIs in order to allow them to modify its contents.</li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">values</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">array</span><span class="p">(</span><span class="dl">'</span><span class="s1">int</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1003</span><span class="p">,</span> <span class="mi">1005</span><span class="p">,</span> <span class="mi">1007</span> <span class="p">]);</span>

<span class="kd">const</span> <span class="nx">JString</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">java.lang.String</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">JString</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="nx">Java</span><span class="p">.</span><span class="nx">array</span><span class="p">(</span><span class="dl">'</span><span class="s1">byte</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x69</span> <span class="p">]));</span></code></pre></figure>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Java.isMainThread()</code>: determine whether the caller is running on the main
thread.</p>
  </li>
  <li>
    <p id="java-registerclass"><code class="language-plaintext highlighter-rouge">Java.registerClass(spec)</code>: create a new Java class and return a wrapper for
it, where <code class="language-plaintext highlighter-rouge">spec</code> is an object containing:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">name</code>: String specifying the name of the class.</li>
      <li><code class="language-plaintext highlighter-rouge">superClass</code>: (optional) Super-class. Omit to inherit from
              <code class="language-plaintext highlighter-rouge">java.lang.Object</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">implements</code>: (optional) Array of interfaces implemented by this class.</li>
      <li><code class="language-plaintext highlighter-rouge">fields</code>: (optional) Object specifying the name and type of each field
          to expose.</li>
      <li><code class="language-plaintext highlighter-rouge">methods</code>: (optional) Object specifying methods to implement.</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">SomeBaseClass</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">com.example.SomeBaseClass</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">X509TrustManager</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">javax.net.ssl.X509TrustManager</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">MyTrustManager</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">registerClass</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">com.example.MyTrustManager</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">implements</span><span class="p">:</span> <span class="p">[</span><span class="nx">X509TrustManager</span><span class="p">],</span>
  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">checkClientTrusted</span><span class="p">(</span><span class="nx">chain</span><span class="p">,</span> <span class="nx">authType</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">},</span>
    <span class="nx">checkServerTrusted</span><span class="p">(</span><span class="nx">chain</span><span class="p">,</span> <span class="nx">authType</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">},</span>
    <span class="nx">getAcceptedIssuers</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[];</span>
    <span class="p">},</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">MyWeirdTrustManager</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">registerClass</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">com.example.MyWeirdTrustManager</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">superClass</span><span class="p">:</span> <span class="nx">SomeBaseClass</span><span class="p">,</span>
  <span class="na">implements</span><span class="p">:</span> <span class="p">[</span><span class="nx">X509TrustManager</span><span class="p">],</span>
  <span class="na">fields</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">java.lang.String</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">limit</span><span class="p">:</span> <span class="dl">'</span><span class="s1">int</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">$init</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Constructor called</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">checkClientTrusted</span><span class="p">(</span><span class="nx">chain</span><span class="p">,</span> <span class="nx">authType</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">checkClientTrusted</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">checkServerTrusted</span><span class="p">:</span> <span class="p">[{</span>
      <span class="na">returnType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">void</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">argumentTypes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">[Ljava.security.cert.X509Certificate;</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">java.lang.String</span><span class="dl">'</span><span class="p">],</span>
      <span class="nx">implementation</span><span class="p">(</span><span class="nx">chain</span><span class="p">,</span> <span class="nx">authType</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">checkServerTrusted A</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="na">returnType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">java.util.List</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">argumentTypes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">[Ljava.security.cert.X509Certificate;</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">java.lang.String</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">java.lang.String</span><span class="dl">'</span><span class="p">],</span>
      <span class="nx">implementation</span><span class="p">(</span><span class="nx">chain</span><span class="p">,</span> <span class="nx">authType</span><span class="p">,</span> <span class="nx">host</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">checkServerTrusted B</span><span class="dl">'</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}],</span>
    <span class="nx">getAcceptedIssuers</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">getAcceptedIssuers</span><span class="dl">'</span><span class="p">);</span>
      <span class="k">return</span> <span class="p">[];</span>
    <span class="p">},</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Java.deoptimizeEverything()</code>: forces the VM to execute everything with
its interpreter. Necessary to prevent optimizations from bypassing method
hooks in some cases, and allows ART’s Instrumentation APIs to be used for
tracing the runtime.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Java.deoptimizeBootImage()</code>: similar to Java.deoptimizeEverything() but
 only deoptimizes boot image code. Use with
 <code class="language-plaintext highlighter-rouge">dalvik.vm.dex2oat-flags --inline-max-code-units=0</code> for best results.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Java.vm</code>: object with the following methods:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">perform(fn)</code>: ensures that the current thread is attached to the VM and
calls <code class="language-plaintext highlighter-rouge">fn</code>. (This isn’t necessary in callbacks from Java.)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">getEnv()</code>: gets a wrapper for the current thread’s <code class="language-plaintext highlighter-rouge">JNIEnv</code>. Throws an
exception if the current thread is not attached to the VM.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">tryGetEnv()</code>: tries to get a wrapper for the current thread’s <code class="language-plaintext highlighter-rouge">JNIEnv</code>.
Returns <code class="language-plaintext highlighter-rouge">null</code> if the current thread is not attached to the VM.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Java.classFactory</code>: the default class factory used to implement e.g.
<a href="#java-use"><code class="language-plaintext highlighter-rouge">Java.use()</code></a>. Uses the application’s main class loader.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Java.ClassFactory</code>: class with the following properties:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">get(classLoader)</code>: Gets the class factory instance for a given class
loader. The default class factory used behind the scenes only interacts
with the application’s main class loader. Other class loaders can be
discovered through <code class="language-plaintext highlighter-rouge">Java.enumerateClassLoaders()</code> and interacted with
through this API.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">loader</code>: read-only property providing a wrapper for the class loader
currently being used. For the default class factory this is updated by
the first call to <a href="#java-perform"><code class="language-plaintext highlighter-rouge">Java.perform()</code></a>.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">cacheDir</code>: string containing path to cache directory currently being
used. For the default class factory this is updated by the first call
to <a href="#java-perform"><code class="language-plaintext highlighter-rouge">Java.perform()</code></a>.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">tempFileNaming</code>: object specifying naming convention to use for
temporary files. Defaults to <code class="language-plaintext highlighter-rouge">{ prefix: 'frida', suffix: 'dat' }</code>.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">use(className)</code>: like <a href="#java-use"><code class="language-plaintext highlighter-rouge">Java.use()</code></a> but for a specific class loader.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">openClassFile(filePath)</code>: like <a href="#java-openclassfile"><code class="language-plaintext highlighter-rouge">Java.openClassFile()</code></a>
but for a specific class loader.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">choose(className, callbacks)</code>: like <a href="#java-choose"><code class="language-plaintext highlighter-rouge">Java.choose()</code></a> but for a
specific class loader.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">retain(obj)</code>: like <a href="#java-retain"><code class="language-plaintext highlighter-rouge">Java.retain()</code></a> but for a specific class loader.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">cast(handle, klass)</code>: like <a href="#java-cast"><code class="language-plaintext highlighter-rouge">Java.cast()</code></a> but for a specific class
loader.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">array(type, elements)</code>: like <a href="#java-array"><code class="language-plaintext highlighter-rouge">Java.array()</code></a> but for a specific class
loader.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">registerClass(spec)</code>: like <a href="#java-registerclass"><code class="language-plaintext highlighter-rouge">Java.registerClass()</code></a> but for a specific
 class loader.</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="cpu-instruction">CPU Instruction</h2>

<h3 id="instruction">Instruction</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Instruction.parse(target)</code>: parse the instruction at the <code class="language-plaintext highlighter-rouge">target</code> address
in memory, represented by a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a>.
Note that on 32-bit ARM this address must have its least significant bit
set to 0 for ARM functions, and 1 for Thumb functions. Frida takes care
of this detail for you if you get the address from a Frida API (for
example <a href="#module-getexportbyname"><code class="language-plaintext highlighter-rouge">Module.getExportByName()</code></a>).</p>

    <p>The object returned has the fields:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">address</code>: address (EIP) of this instruction, as a <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">NativePointer</code></a></li>
      <li><code class="language-plaintext highlighter-rouge">next</code>: pointer to the next instruction, so you can <code class="language-plaintext highlighter-rouge">parse()</code> it</li>
      <li><code class="language-plaintext highlighter-rouge">size</code>: size of this instruction</li>
      <li><code class="language-plaintext highlighter-rouge">mnemonic</code>: string representation of instruction mnemonic</li>
      <li><code class="language-plaintext highlighter-rouge">opStr</code>: string representation of instruction operands</li>
      <li><code class="language-plaintext highlighter-rouge">operands</code>: array of objects describing each operand, each specifying
            the <code class="language-plaintext highlighter-rouge">type</code> and <code class="language-plaintext highlighter-rouge">value</code>, at a minimum, but potentially also
            additional properties depending on the architecture</li>
      <li><code class="language-plaintext highlighter-rouge">regsRead</code>: array of register names implicitly read by this instruction</li>
      <li><code class="language-plaintext highlighter-rouge">regsWritten</code>: array of register names implicitly written to by this
instruction</li>
      <li><code class="language-plaintext highlighter-rouge">groups</code>: array of group names that this instruction belongs to</li>
      <li><code class="language-plaintext highlighter-rouge">toString()</code>: convert to a human-readable string</li>
    </ul>

    <p>For details about <code class="language-plaintext highlighter-rouge">operands</code> and <code class="language-plaintext highlighter-rouge">groups</code>, please consult the
<strong><a href="http://www.capstone-engine.org/">Capstone</a></strong> documentation for your
architecture.</p>
  </li>
</ul>

<h3 id="x86writer">X86Writer</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new X86Writer(codeAddress[, { pc: ptr('0x1234') }])</code>: create a new code
writer for generating x86 machine code written directly to memory at
<code class="language-plaintext highlighter-rouge">codeAddress</code>, specified as a <strong><a href="#nativepointer">NativePointer</a></strong>.
The second argument is an optional options object where the initial program
counter may be specified, which is useful when generating code to a scratch
buffer. This is essential when using <a href="#memory-patchcode"><code class="language-plaintext highlighter-rouge">Memory.patchCode()</code></a>
on iOS, which may provide you with a temporary location that later gets mapped
into memory at the intended memory location.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">reset(codeAddress[, { pc: ptr('0x1234') }])</code>: recycle instance</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dispose()</code>: eagerly clean up memory</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">flush()</code>: resolve label references and write pending data to memory. You
should always call this once you’ve finished generating code. It is usually
also desirable to do this between pieces of unrelated code, e.g. when
generating multiple functions in one go.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">base</code>: memory location of the first byte of output, as a <strong><a href="#nativepointer">NativePointer</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">code</code>: memory location of the next byte of output, as a <strong><a href="#nativepointer">NativePointer</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">pc</code>: program counter at the next byte of output, as a <strong><a href="#nativepointer">NativePointer</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">offset</code>: current offset as a JavaScript Number</p>
  </li>
  <li>
    <p id="x86writer-putlabel"><code class="language-plaintext highlighter-rouge">putLabel(id)</code>: put a label at the current position, where <code class="language-plaintext highlighter-rouge">id</code> is a string
that may be referenced in past and future <code class="language-plaintext highlighter-rouge">put*Label()</code> calls</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallAddressWithArguments(func, args)</code>: put code needed for calling a C
function with the specified <code class="language-plaintext highlighter-rouge">args</code>, specified as a JavaScript array where
each element is either a string specifying the register, or a Number or
<strong><a href="#nativepointer">NativePointer</a></strong> specifying the immediate value.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallAddressWithAlignedArguments(func, args)</code>: like above, but also
ensures that the argument list is aligned on a 16 byte boundary</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallRegWithArguments(reg, args)</code>: put code needed for calling a C
function with the specified <code class="language-plaintext highlighter-rouge">args</code>, specified as a JavaScript array where
each element is either a string specifying the register, or a Number or
<strong><a href="#nativepointer">NativePointer</a></strong> specifying the immediate value.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallRegWithAlignedArguments(reg, args)</code>: like above, but also
ensures that the argument list is aligned on a 16 byte boundary</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallRegOffsetPtrWithArguments(reg, offset, args)</code>: put code needed for calling
a C function with the specified <code class="language-plaintext highlighter-rouge">args</code>, specified as a JavaScript array where
each element is either a string specifying the register, or a Number or
<strong><a href="#nativepointer">NativePointer</a></strong> specifying the immediate value.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallAddress(address)</code>: put a CALL instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallReg(reg)</code>: put a CALL instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallRegOffsetPtr(reg, offset)</code>: put a CALL instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallIndirect(addr)</code>: put a CALL instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallIndirectLabel(labelId)</code>: put a CALL instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#x86writer-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallNearLabel(labelId)</code>: put a CALL instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#x86writer-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLeave()</code>: put a LEAVE instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putRet()</code>: put a RET instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putRetImm(immValue)</code>: put a RET instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJmpAddress(address)</code>: put a JMP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJmpShortLabel(labelId)</code>: put a JMP instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#x86writer-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJmpNearLabel(labelId)</code>: put a JMP instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#x86writer-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJmpReg(reg)</code>: put a JMP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJmpRegPtr(reg)</code>: put a JMP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJmpRegOffsetPtr(reg, offset)</code>: put a JMP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJmpNearPtr(address)</code>: put a JMP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJccShort(instructionId, target, hint)</code>: put a JCC instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJccNear(instructionId, target, hint)</code>: put a JCC instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJccShortLabel(instructionId, labelId, hint)</code>: put a JCC instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#x86writer-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJccNearLabel(instructionId, labelId, hint)</code>: put a JCC instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#x86writer-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddRegImm(reg, immValue)</code>: put an ADD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddRegReg(dstReg, srcReg)</code>: put an ADD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddRegNearPtr(dstReg, srcAddress)</code>: put an ADD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putSubRegImm(reg, immValue)</code>: put a SUB instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putSubRegReg(dstReg, srcReg)</code>: put a SUB instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putSubRegNearPtr(dstReg, srcAddress)</code>: put a SUB instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putIncReg(reg)</code>: put an INC instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putDecReg(reg)</code>: put a DEC instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putIncRegPtr(target, reg)</code>: put an INC instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putDecRegPtr(target, reg)</code>: put a DEC instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLockXaddRegPtrReg(dstReg, srcReg)</code>: put a LOCK XADD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLockCmpxchgRegPtrReg(dstReg, srcReg)</code>: put a LOCK CMPXCHG instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLockIncImm32Ptr(target)</code>: put a LOCK INC IMM32 instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLockDecImm32Ptr(target)</code>: put a LOCK DEC IMM32 instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAndRegReg(dstReg, srcReg)</code>: put an AND instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAndRegU32(reg, immValue)</code>: put an AND instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putShlRegU8(reg, immValue)</code>: put a SHL instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putShrRegU8(reg, immValue)</code>: put a SHR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putXorRegReg(dstReg, srcReg)</code>: put an XOR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegReg(dstReg, srcReg)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegU32(dstReg, immValue)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegU64(dstReg, immValue)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegAddress(dstReg, address)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegPtrU32(dstReg, immValue)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegOffsetPtrU32(dstReg, dstOffset, immValue)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegPtrReg(dstReg, srcReg)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegOffsetPtrReg(dstReg, dstOffset, srcReg)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegRegPtr(dstReg, srcReg)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegRegOffsetPtr(dstReg, srcReg, srcOffset)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegBaseIndexScaleOffsetPtr(dstReg, baseReg, indexReg,
scale, offset)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegNearPtr(dstReg, srcAddress)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovNearPtrReg(dstAddress, srcReg)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovFsU32PtrReg(fsOffset, srcReg)</code>: put a MOV FS instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegFsU32Ptr(dstReg, fsOffset)</code>: put a MOV FS instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovGsU32PtrReg(fsOffset, srcReg)</code>: put a MOV GS instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegGsU32Ptr(dstReg, fsOffset)</code>: put a MOV GS instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovqXmm0EspOffsetPtr(offset)</code>: put a MOVQ XMM0 ESP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovqEaxOffsetPtrXmm0(offset)</code>: put a MOVQ EAX XMM0 instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovdquXmm0EspOffsetPtr(offset)</code>: put a MOVDQU XMM0 ESP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovdquEaxOffsetPtrXmm0(offset)</code>: put a MOVDQU EAX XMM0 instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLeaRegRegOffset(dstReg, srcReg, srcOffset)</code>: put a LEA instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putXchgRegRegPtr(leftReg, rightReg)</code>: put an XCHG instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPushU32(immValue)</code>: put a PUSH instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPushNearPtr(address)</code>: put a PUSH instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPushReg(reg)</code>: put a PUSH instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPopReg(reg)</code>: put a POP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPushImmPtr(immPtr)</code>: put a PUSH instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPushax()</code>: put a PUSHAX instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPopax()</code>: put a POPAX instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPushfx()</code>: put a PUSHFX instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPopfx()</code>: put a POPFX instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putTestRegReg(regA, regB)</code>: put a TEST instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putTestRegU32(reg, immValue)</code>: put a TEST instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCmpRegI32(reg, immValue)</code>: put a CMP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCmpRegOffsetPtrReg(regA, offset, regB)</code>: put a CMP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCmpImmPtrImmU32(immPtr, immValue)</code>: put a CMP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCmpRegReg(regA, regB)</code>: put a CMP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putClc()</code>: put a CLC instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putStc()</code>: put a STC instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCld()</code>: put a CLD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putStd()</code>: put a STD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCpuid()</code>: put a CPUID instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLfence()</code>: put an LFENCE instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putRdtsc()</code>: put an RDTSC instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPause()</code>: put a PAUSE instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putNop()</code>: put a NOP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBreakpoint()</code>: put an OS/architecture-specific breakpoint instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPadding(n)</code>: put <code class="language-plaintext highlighter-rouge">n</code> guard instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putNopPadding(n)</code>: put <code class="language-plaintext highlighter-rouge">n</code> NOP instructions</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putU8(value)</code>: put a uint8</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putS8(value)</code>: put an int8</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBytes(data)</code>: put raw data from the provided <strong><a href="#arraybuffer">ArrayBuffer</a></strong></p>
  </li>
</ul>

<h3 id="x86relocator">X86Relocator</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new X86Relocator(inputCode, output)</code>: create a new code relocator for
copying x86 instructions from one memory location to another, taking
care to adjust position-dependent instructions accordingly.
The source address is specified by <code class="language-plaintext highlighter-rouge">inputCode</code>, a <strong><a href="#nativepointer">NativePointer</a></strong>.
The destination is given by <code class="language-plaintext highlighter-rouge">output</code>, an <strong><a href="#x86writer">X86Writer</a></strong> pointed
at the desired target memory address.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">reset(inputCode, output)</code>: recycle instance</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dispose()</code>: eagerly clean up memory</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">input</code>: latest <strong><a href="#instruction">Instruction</a></strong> read so far. Starts out <code class="language-plaintext highlighter-rouge">null</code>
and changes on every call to <a href="#x86relocator-readone"><code class="language-plaintext highlighter-rouge">readOne()</code></a>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">eob</code>: boolean indicating whether end-of-block has been reached, i.e. we’ve
reached a branch of any kind, like CALL, JMP, BL, RET.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">eoi</code>: boolean indicating whether end-of-input has been reached, e.g. we’ve
reached JMP/B/RET, an instruction after which there may or may not be valid
code.</p>
  </li>
  <li>
    <p id="x86relocator-readone"><code class="language-plaintext highlighter-rouge">readOne()</code>: read the next instruction into the relocator’s internal buffer
and return the number of bytes read so far, including previous calls.
You may keep calling this method to keep buffering, or immediately call
either <a href="#x86relocator-writeone"><code class="language-plaintext highlighter-rouge">writeOne()</code></a> or <a href="#x86relocator-skipone"><code class="language-plaintext highlighter-rouge">skipOne()</code></a>.
Or, you can buffer up until the desired point and then call <a href="#x86relocator-writeall"><code class="language-plaintext highlighter-rouge">writeAll()</code></a>.
Returns zero when end-of-input is reached, which means the <code class="language-plaintext highlighter-rouge">eoi</code> property is
now <code class="language-plaintext highlighter-rouge">true</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">peekNextWriteInsn()</code>: peek at the next <strong><a href="#instruction">Instruction</a></strong> to be
written or skipped</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">peekNextWriteSource()</code>: peek at the address of the next instruction to be
written or skipped</p>
  </li>
  <li>
    <p id="x86relocator-skipone"><code class="language-plaintext highlighter-rouge">skipOne()</code>: skip the instruction that would have been written next</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">skipOneNoLabel()</code>: skip the instruction that would have been written next,
but without a label for internal use. This breaks relocation of branches to
locations inside the relocated range, and is an optimization for use-cases
where all branches are rewritten (e.g. Frida’s <strong><a href="#stalker">Stalker</a></strong>).</p>
  </li>
  <li>
    <p id="x86relocator-writeone"><code class="language-plaintext highlighter-rouge">writeOne()</code>: write the next buffered instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">writeOneNoLabel()</code>: write the next buffered instruction, but without a
label for internal use. This breaks relocation of branches to locations
inside the relocated range, and is an optimization for use-cases where all
branches are rewritten (e.g. Frida’s <strong><a href="#stalker">Stalker</a></strong>).</p>
  </li>
  <li>
    <p id="x86relocator-writeall"><code class="language-plaintext highlighter-rouge">writeAll()</code>: write all buffered instructions</p>
  </li>
</ul>

<h3 id="x86-enum-types">x86 enum types</h3>

<ul>
  <li>Register: <code class="language-plaintext highlighter-rouge">xax</code> <code class="language-plaintext highlighter-rouge">xcx</code> <code class="language-plaintext highlighter-rouge">xdx</code> <code class="language-plaintext highlighter-rouge">xbx</code> <code class="language-plaintext highlighter-rouge">xsp</code> <code class="language-plaintext highlighter-rouge">xbp</code> <code class="language-plaintext highlighter-rouge">xsi</code> <code class="language-plaintext highlighter-rouge">xdi</code> <code class="language-plaintext highlighter-rouge">eax</code> <code class="language-plaintext highlighter-rouge">ecx</code> <code class="language-plaintext highlighter-rouge">edx</code>
<code class="language-plaintext highlighter-rouge">ebx</code> <code class="language-plaintext highlighter-rouge">esp</code> <code class="language-plaintext highlighter-rouge">ebp</code> <code class="language-plaintext highlighter-rouge">esi</code> <code class="language-plaintext highlighter-rouge">edi</code> <code class="language-plaintext highlighter-rouge">rax</code> <code class="language-plaintext highlighter-rouge">rcx</code> <code class="language-plaintext highlighter-rouge">rdx</code> <code class="language-plaintext highlighter-rouge">rbx</code> <code class="language-plaintext highlighter-rouge">rsp</code> <code class="language-plaintext highlighter-rouge">rbp</code> <code class="language-plaintext highlighter-rouge">rsi</code>
<code class="language-plaintext highlighter-rouge">rdi</code> <code class="language-plaintext highlighter-rouge">r8</code> <code class="language-plaintext highlighter-rouge">r9</code> <code class="language-plaintext highlighter-rouge">r10</code> <code class="language-plaintext highlighter-rouge">r11</code> <code class="language-plaintext highlighter-rouge">r12</code> <code class="language-plaintext highlighter-rouge">r13</code> <code class="language-plaintext highlighter-rouge">r14</code> <code class="language-plaintext highlighter-rouge">r15</code> <code class="language-plaintext highlighter-rouge">r8d</code> <code class="language-plaintext highlighter-rouge">r9d</code> <code class="language-plaintext highlighter-rouge">r10d</code>
<code class="language-plaintext highlighter-rouge">r11d</code> <code class="language-plaintext highlighter-rouge">r12d</code> <code class="language-plaintext highlighter-rouge">r13d</code> <code class="language-plaintext highlighter-rouge">r14d</code> <code class="language-plaintext highlighter-rouge">r15d</code> <code class="language-plaintext highlighter-rouge">xip</code> <code class="language-plaintext highlighter-rouge">eip</code> <code class="language-plaintext highlighter-rouge">rip</code></li>
  <li>InstructionId: <code class="language-plaintext highlighter-rouge">jo</code> <code class="language-plaintext highlighter-rouge">jno</code> <code class="language-plaintext highlighter-rouge">jb</code> <code class="language-plaintext highlighter-rouge">jae</code> <code class="language-plaintext highlighter-rouge">je</code> <code class="language-plaintext highlighter-rouge">jne</code> <code class="language-plaintext highlighter-rouge">jbe</code> <code class="language-plaintext highlighter-rouge">ja</code> <code class="language-plaintext highlighter-rouge">js</code> <code class="language-plaintext highlighter-rouge">jns</code> <code class="language-plaintext highlighter-rouge">jp</code>
<code class="language-plaintext highlighter-rouge">jnp</code> <code class="language-plaintext highlighter-rouge">jl</code> <code class="language-plaintext highlighter-rouge">jge</code> <code class="language-plaintext highlighter-rouge">jle</code> <code class="language-plaintext highlighter-rouge">jg</code> <code class="language-plaintext highlighter-rouge">jcxz</code> <code class="language-plaintext highlighter-rouge">jecxz</code> <code class="language-plaintext highlighter-rouge">jrcxz</code></li>
  <li>BranchHint: <code class="language-plaintext highlighter-rouge">no-hint</code> <code class="language-plaintext highlighter-rouge">likely</code> <code class="language-plaintext highlighter-rouge">unlikely</code></li>
  <li>PointerTarget: <code class="language-plaintext highlighter-rouge">byte</code> <code class="language-plaintext highlighter-rouge">dword</code> <code class="language-plaintext highlighter-rouge">qword</code></li>
</ul>

<h3 id="armwriter">ArmWriter</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new ArmWriter(codeAddress[, { pc: ptr('0x1234') }])</code>: create a new code
writer for generating ARM machine code written directly to memory at
<code class="language-plaintext highlighter-rouge">codeAddress</code>, specified as a <strong><a href="#nativepointer">NativePointer</a></strong>.
The second argument is an optional options object where the initial program
counter may be specified, which is useful when generating code to a scratch
buffer. This is essential when using <a href="#memory-patchcode"><code class="language-plaintext highlighter-rouge">Memory.patchCode()</code></a>
on iOS, which may provide you with a temporary location that later gets mapped
into memory at the intended memory location.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">reset(codeAddress[, { pc: ptr('0x1234') }])</code>: recycle instance</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dispose()</code>: eagerly clean up memory</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">flush()</code>: resolve label references and write pending data to memory. You
should always call this once you’ve finished generating code. It is usually
also desirable to do this between pieces of unrelated code, e.g. when
generating multiple functions in one go.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">base</code>: memory location of the first byte of output, as a <strong><a href="#nativepointer">NativePointer</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">code</code>: memory location of the next byte of output, as a <strong><a href="#nativepointer">NativePointer</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">pc</code>: program counter at the next byte of output, as a <strong><a href="#nativepointer">NativePointer</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">offset</code>: current offset as a JavaScript Number</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">skip(nBytes)</code>: skip <code class="language-plaintext highlighter-rouge">nBytes</code></p>
  </li>
  <li>
    <p id="armwriter-putlabel"><code class="language-plaintext highlighter-rouge">putLabel(id)</code>: put a label at the current position, where <code class="language-plaintext highlighter-rouge">id</code> is a string
that may be referenced in past and future <code class="language-plaintext highlighter-rouge">put*Label()</code> calls</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallAddressWithArguments(func, args)</code>: put code needed for calling a C
function with the specified <code class="language-plaintext highlighter-rouge">args</code>, specified as a JavaScript array where
each element is either a string specifying the register, or a Number or
<strong><a href="#nativepointer">NativePointer</a></strong> specifying the immediate value.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBranchAddress(address)</code>: put code needed for branching/jumping to the
given address</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">canBranchDirectlyBetween(from, to)</code>: determine whether a direct branch is
possible between the two given memory locations</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBImm(target)</code>: put a B instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBCondImm(cc, target)</code>: put a B COND instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBLabel(labelId)</code>: put a B instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#armwriter-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBCondLabel(cc, labelId)</code>: put a B COND instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#armwriter-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBlImm(target)</code>: put a BL instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBlxImm(target)</code>: put a BLX instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBlLabel(labelId)</code>: put a BL instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#armwriter-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBxReg(reg)</code>: put a BX instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBlxReg(reg)</code>: put a BLX instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putRet()</code>: put a RET instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdrRegAddress(reg, address)</code>: put an LDR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdrRegU32(reg, val)</code>: put an LDR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdrRegRegOffset(dstReg, srcReg, srcOffset)</code>: put an LDR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdrCondRegRegOffset(cc, dstReg, srcReg, srcOffset)</code>: put an LDR COND instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdmiaRegMask(reg, mask)</code>: put an LDMIA MASK instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putStrRegRegOffset(srcReg, dstReg, dstOffset)</code>: put a STR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putStrCondRegRegOffset(cc, srcReg, dstReg, dstOffset)</code>: put a STR COND instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegReg(dstReg, srcReg)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegRegShift(dstReg, srcReg, shift, shiftValue)</code>: put a MOV SHIFT instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegCpsr(reg)</code>: put a MOV CPSR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovCpsrReg(reg)</code>: put a MOV CPSR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddRegU16(dstReg, val)</code>: put an ADD U16 instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddRegU32(dstReg, val)</code>: put an ADD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddRegRegImm(dstReg, srcReg, immVal)</code>: put an ADD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddRegRegReg(dstReg, srcReg1, srcReg2)</code>: put an ADD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddRegRegRegShift(dstReg, srcReg1, srcReg2, shift,
 shiftValue)</code>: put an ADD SHIFT instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putSubRegU16(dstReg, val)</code>: put a SUB U16 instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putSubRegU32(dstReg, val)</code>: put a SUB instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putSubRegRegImm(dstReg, srcReg, immVal)</code>: put a SUB instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putSubRegRegReg(dstReg, srcReg1, srcReg2)</code>: put a SUB instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAndsRegRegImm(dstReg, srcReg, immVal)</code>: put an ANDS instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCmpRegImm(dstReg, immVal)</code>: put a CMP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putNop()</code>: put a NOP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBreakpoint()</code>: put an OS/architecture-specific breakpoint instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBrkImm(imm)</code>: put a BRK instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putInstruction(insn)</code>: put a raw instruction as a JavaScript Number</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBytes(data)</code>: put raw data from the provided <strong><a href="#arraybuffer">ArrayBuffer</a></strong></p>
  </li>
</ul>

<h3 id="armrelocator">ArmRelocator</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new ArmRelocator(inputCode, output)</code>: create a new code relocator for
copying ARM instructions from one memory location to another, taking
care to adjust position-dependent instructions accordingly.
The source address is specified by <code class="language-plaintext highlighter-rouge">inputCode</code>, a <strong><a href="#nativepointer">NativePointer</a></strong>.
The destination is given by <code class="language-plaintext highlighter-rouge">output</code>, an <strong><a href="#armwriter">ArmWriter</a></strong> pointed
at the desired target memory address.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">reset(inputCode, output)</code>: recycle instance</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dispose()</code>: eagerly clean up memory</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">input</code>: latest <strong><a href="#instruction">Instruction</a></strong> read so far. Starts out <code class="language-plaintext highlighter-rouge">null</code>
and changes on every call to <a href="#armrelocator-readone"><code class="language-plaintext highlighter-rouge">readOne()</code></a>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">eob</code>: boolean indicating whether end-of-block has been reached, i.e. we’ve
reached a branch of any kind, like CALL, JMP, BL, RET.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">eoi</code>: boolean indicating whether end-of-input has been reached, e.g. we’ve
reached JMP/B/RET, an instruction after which there may or may not be valid
code.</p>
  </li>
  <li>
    <p id="armrelocator-readone"><code class="language-plaintext highlighter-rouge">readOne()</code>: read the next instruction into the relocator’s internal buffer
and return the number of bytes read so far, including previous calls.
You may keep calling this method to keep buffering, or immediately call
either <a href="#armrelocator-writeone"><code class="language-plaintext highlighter-rouge">writeOne()</code></a> or <a href="#armrelocator-skipone"><code class="language-plaintext highlighter-rouge">skipOne()</code></a>.
Or, you can buffer up until the desired point and then call <a href="#armrelocator-writeall"><code class="language-plaintext highlighter-rouge">writeAll()</code></a>.
Returns zero when end-of-input is reached, which means the <code class="language-plaintext highlighter-rouge">eoi</code> property is
now <code class="language-plaintext highlighter-rouge">true</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">peekNextWriteInsn()</code>: peek at the next <strong><a href="#instruction">Instruction</a></strong> to be
written or skipped</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">peekNextWriteSource()</code>: peek at the address of the next instruction to be
written or skipped</p>
  </li>
  <li>
    <p id="armrelocator-skipone"><code class="language-plaintext highlighter-rouge">skipOne()</code>: skip the instruction that would have been written next</p>
  </li>
  <li>
    <p id="armrelocator-writeone"><code class="language-plaintext highlighter-rouge">writeOne()</code>: write the next buffered instruction</p>
  </li>
  <li>
    <p id="armrelocator-writeall"><code class="language-plaintext highlighter-rouge">writeAll()</code>: write all buffered instructions</p>
  </li>
</ul>

<h3 id="thumbwriter">ThumbWriter</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new ThumbWriter(codeAddress[, { pc: ptr('0x1234') }])</code>: create a new code
writer for generating ARM machine code written directly to memory at
<code class="language-plaintext highlighter-rouge">codeAddress</code>, specified as a <strong><a href="#nativepointer">NativePointer</a></strong>.
The second argument is an optional options object where the initial program
counter may be specified, which is useful when generating code to a scratch
buffer. This is essential when using <a href="#memory-patchcode"><code class="language-plaintext highlighter-rouge">Memory.patchCode()</code></a>
on iOS, which may provide you with a temporary location that later gets mapped
into memory at the intended memory location.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">reset(codeAddress[, { pc: ptr('0x1234') }])</code>: recycle instance</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dispose()</code>: eagerly clean up memory</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">flush()</code>: resolve label references and write pending data to memory. You
should always call this once you’ve finished generating code. It is usually
also desirable to do this between pieces of unrelated code, e.g. when
generating multiple functions in one go.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">base</code>: memory location of the first byte of output, as a <strong><a href="#nativepointer">NativePointer</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">code</code>: memory location of the next byte of output, as a <strong><a href="#nativepointer">NativePointer</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">pc</code>: program counter at the next byte of output, as a <strong><a href="#nativepointer">NativePointer</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">offset</code>: current offset as a JavaScript Number</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">skip(nBytes)</code>: skip <code class="language-plaintext highlighter-rouge">nBytes</code></p>
  </li>
  <li>
    <p id="thumbwriter-putlabel"><code class="language-plaintext highlighter-rouge">putLabel(id)</code>: put a label at the current position, where <code class="language-plaintext highlighter-rouge">id</code> is a string
that may be referenced in past and future <code class="language-plaintext highlighter-rouge">put*Label()</code> calls</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">commitLabel(id)</code>: commit the first pending reference to the given label,
returning <code class="language-plaintext highlighter-rouge">true</code> on success. Returns <code class="language-plaintext highlighter-rouge">false</code> if the given label hasn’t been
defined yet, or there are no more pending references to it.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallAddressWithArguments(func, args)</code>: put code needed for calling a C
function with the specified <code class="language-plaintext highlighter-rouge">args</code>, specified as a JavaScript array where
each element is either a string specifying the register, or a Number or
<strong><a href="#nativepointer">NativePointer</a></strong> specifying the immediate value.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallRegWithArguments(reg, args)</code>: put code needed for calling a C
function with the specified <code class="language-plaintext highlighter-rouge">args</code>, specified as a JavaScript array where
each element is either a string specifying the register, or a Number or
<strong><a href="#nativepointer">NativePointer</a></strong> specifying the immediate value.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBImm(target)</code>: put a B instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBLabel(labelId)</code>: put a B instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#thumbwriter-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBLabelWide(labelId)</code>: put a B WIDE instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBxReg(reg)</code>: put a BX instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBlImm(target)</code>: put a BL instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBlLabel(labelId)</code>: put a BL instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#thumbwriter-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBlxImm(target)</code>: put a BLX instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBlxReg(reg)</code>: put a BLX instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCmpRegImm(reg, immValue)</code>: put a CMP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBeqLabel(labelId)</code>: put a BEQ instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#thumbwriter-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBneLabel(labelId)</code>: put a BNE instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#thumbwriter-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBCondLabel(cc, labelId)</code>: put a B COND instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#thumbwriter-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBCondLabelWide(cc, labelId)</code>: put a B COND WIDE instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCbzRegLabel(reg, labelId)</code>: put a CBZ instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#thumbwriter-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCbnzRegLabel(reg, labelId)</code>: put a CBNZ instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#thumbwriter-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPushRegs(regs)</code>: put a PUSH instruction with the specified registers,
specified as a JavaScript array where each element is a string specifying
the register name.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPopRegs(regs)</code>: put a POP instruction with the specified registers,
specified as a JavaScript array where each element is a string specifying
the register name.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdrRegAddress(reg, address)</code>: put an LDR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdrRegU32(reg, val)</code>: put an LDR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdrRegReg(dstReg, srcReg)</code>: put an LDR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdrRegRegOffset(dstReg, srcReg, srcOffset)</code>: put an LDR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdrbRegReg(dstReg, srcReg)</code>: put an LDRB instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putVldrRegRegOffset(dstReg, srcReg, srcOffset)</code>: put a VLDR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdmiaRegMask(reg, mask)</code>: put an LDMIA MASK instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putStrRegReg(srcReg, dstReg)</code>: put a STR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putStrRegRegOffset(srcReg, dstReg, dstOffset)</code>: put a STR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegReg(dstReg, srcReg)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegU8(dstReg, immValue)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegCpsr(reg)</code>: put a MOV CPSR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovCpsrReg(reg)</code>: put a MOV CPSR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddRegImm(dstReg, immValue)</code>: put an ADD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddRegReg(dstReg, srcReg)</code>: put an ADD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddRegRegReg(dstReg, leftReg, rightReg)</code>: put an ADD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddRegRegImm(dstReg, leftReg, rightValue)</code>: put an ADD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putSubRegImm(dstReg, immValue)</code>: put a SUB instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putSubRegReg(dstReg, srcReg)</code>: put a SUB instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putSubRegRegReg(dstReg, leftReg, rightReg)</code>: put a SUB instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putSubRegRegImm(dstReg, leftReg, rightValue)</code>: put a SUB instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAndRegRegImm(dstReg, leftReg, rightValue)</code>: put an AND instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLslsRegRegImm(dstReg, leftReg, rightValue)</code>: put a LSLS instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLsrsRegRegImm(dstReg, leftReg, rightValue)</code>: put a LSRS instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMrsRegReg(dstReg, srcReg)</code>: put a MRS instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMsrRegReg(dstReg, srcReg)</code>: put a MSR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putNop()</code>: put a NOP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBkptImm(imm)</code>: put a BKPT instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBreakpoint()</code>: put an OS/architecture-specific breakpoint instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putInstruction(insn)</code>: put a raw instruction as a JavaScript Number</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putInstructionWide(upper, lower)</code>: put a raw Thumb-2 instruction from
two JavaScript Number values</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBytes(data)</code>: put raw data from the provided <strong><a href="#arraybuffer">ArrayBuffer</a></strong></p>
  </li>
</ul>

<h3 id="thumbrelocator">ThumbRelocator</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new ThumbRelocator(inputCode, output)</code>: create a new code relocator for
copying ARM instructions from one memory location to another, taking
care to adjust position-dependent instructions accordingly.
The source address is specified by <code class="language-plaintext highlighter-rouge">inputCode</code>, a <strong><a href="#nativepointer">NativePointer</a></strong>.
The destination is given by <code class="language-plaintext highlighter-rouge">output</code>, a <strong><a href="#thumbwriter">ThumbWriter</a></strong> pointed
at the desired target memory address.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">reset(inputCode, output)</code>: recycle instance</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dispose()</code>: eagerly clean up memory</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">input</code>: latest <strong><a href="#instruction">Instruction</a></strong> read so far. Starts out <code class="language-plaintext highlighter-rouge">null</code>
and changes on every call to <a href="#thumbrelocator-readone"><code class="language-plaintext highlighter-rouge">readOne()</code></a>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">eob</code>: boolean indicating whether end-of-block has been reached, i.e. we’ve
reached a branch of any kind, like CALL, JMP, BL, RET.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">eoi</code>: boolean indicating whether end-of-input has been reached, e.g. we’ve
reached JMP/B/RET, an instruction after which there may or may not be valid
code.</p>
  </li>
  <li>
    <p id="thumbrelocator-readone"><code class="language-plaintext highlighter-rouge">readOne()</code>: read the next instruction into the relocator’s internal buffer
and return the number of bytes read so far, including previous calls.
You may keep calling this method to keep buffering, or immediately call
either <a href="#thumbrelocator-writeone"><code class="language-plaintext highlighter-rouge">writeOne()</code></a> or <a href="#thumbrelocator-skipone"><code class="language-plaintext highlighter-rouge">skipOne()</code></a>.
Or, you can buffer up until the desired point and then call <a href="#thumbrelocator-writeall"><code class="language-plaintext highlighter-rouge">writeAll()</code></a>.
Returns zero when end-of-input is reached, which means the <code class="language-plaintext highlighter-rouge">eoi</code> property is
now <code class="language-plaintext highlighter-rouge">true</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">peekNextWriteInsn()</code>: peek at the next <strong><a href="#instruction">Instruction</a></strong> to be
written or skipped</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">peekNextWriteSource()</code>: peek at the address of the next instruction to be
written or skipped</p>
  </li>
  <li>
    <p id="thumbrelocator-skipone"><code class="language-plaintext highlighter-rouge">skipOne()</code>: skip the instruction that would have been written next</p>
  </li>
  <li>
    <p id="thumbrelocator-writeone"><code class="language-plaintext highlighter-rouge">writeOne()</code>: write the next buffered instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">copyOne()</code>: copy out the next buffered instruction without advancing the
output cursor, allowing the same instruction to be written out multiple
times</p>
  </li>
  <li>
    <p id="thumbrelocator-writeall"><code class="language-plaintext highlighter-rouge">writeAll()</code>: write all buffered instructions</p>
  </li>
</ul>

<h3 id="arm-enum-types">ARM enum types</h3>

<ul>
  <li>Register: <code class="language-plaintext highlighter-rouge">r0</code> <code class="language-plaintext highlighter-rouge">r1</code> <code class="language-plaintext highlighter-rouge">r2</code> <code class="language-plaintext highlighter-rouge">r3</code> <code class="language-plaintext highlighter-rouge">r4</code> <code class="language-plaintext highlighter-rouge">r5</code> <code class="language-plaintext highlighter-rouge">r6</code> <code class="language-plaintext highlighter-rouge">r7</code> <code class="language-plaintext highlighter-rouge">r8</code> <code class="language-plaintext highlighter-rouge">r9</code> <code class="language-plaintext highlighter-rouge">r10</code> <code class="language-plaintext highlighter-rouge">r11</code>
<code class="language-plaintext highlighter-rouge">r12</code> <code class="language-plaintext highlighter-rouge">r13</code> <code class="language-plaintext highlighter-rouge">r14</code> <code class="language-plaintext highlighter-rouge">r15</code> <code class="language-plaintext highlighter-rouge">sp</code> <code class="language-plaintext highlighter-rouge">lr</code> <code class="language-plaintext highlighter-rouge">sb</code> <code class="language-plaintext highlighter-rouge">sl</code> <code class="language-plaintext highlighter-rouge">fp</code> <code class="language-plaintext highlighter-rouge">ip</code> <code class="language-plaintext highlighter-rouge">pc</code></li>
  <li>SystemRegister: <code class="language-plaintext highlighter-rouge">apsr-nzcvq</code></li>
  <li>ConditionCode: <code class="language-plaintext highlighter-rouge">eq</code> <code class="language-plaintext highlighter-rouge">ne</code> <code class="language-plaintext highlighter-rouge">hs</code> <code class="language-plaintext highlighter-rouge">lo</code> <code class="language-plaintext highlighter-rouge">mi</code> <code class="language-plaintext highlighter-rouge">pl</code> <code class="language-plaintext highlighter-rouge">vs</code> <code class="language-plaintext highlighter-rouge">vc</code> <code class="language-plaintext highlighter-rouge">hi</code> <code class="language-plaintext highlighter-rouge">ls</code> <code class="language-plaintext highlighter-rouge">ge</code> <code class="language-plaintext highlighter-rouge">lt</code>
<code class="language-plaintext highlighter-rouge">gt</code> <code class="language-plaintext highlighter-rouge">le</code> <code class="language-plaintext highlighter-rouge">al</code></li>
  <li>Shifter: <code class="language-plaintext highlighter-rouge">asr</code> <code class="language-plaintext highlighter-rouge">lsl</code> <code class="language-plaintext highlighter-rouge">lsr</code> <code class="language-plaintext highlighter-rouge">ror</code> <code class="language-plaintext highlighter-rouge">rrx</code> <code class="language-plaintext highlighter-rouge">asr-reg</code> <code class="language-plaintext highlighter-rouge">lsl-reg</code> <code class="language-plaintext highlighter-rouge">lsr-reg</code>
<code class="language-plaintext highlighter-rouge">ror-reg</code> <code class="language-plaintext highlighter-rouge">rrx-reg</code></li>
</ul>

<h3 id="arm64writer">Arm64Writer</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new Arm64Writer(codeAddress[, { pc: ptr('0x1234') }])</code>: create a new code
writer for generating AArch64 machine code written directly to memory at
<code class="language-plaintext highlighter-rouge">codeAddress</code>, specified as a <strong><a href="#nativepointer">NativePointer</a></strong>.
The second argument is an optional options object where the initial program
counter may be specified, which is useful when generating code to a scratch
buffer. This is essential when using <a href="#memory-patchcode"><code class="language-plaintext highlighter-rouge">Memory.patchCode()</code></a>
on iOS, which may provide you with a temporary location that later gets mapped
into memory at the intended memory location.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">reset(codeAddress[, { pc: ptr('0x1234') }])</code>: recycle instance</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dispose()</code>: eagerly clean up memory</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">flush()</code>: resolve label references and write pending data to memory. You
should always call this once you’ve finished generating code. It is usually
also desirable to do this between pieces of unrelated code, e.g. when
generating multiple functions in one go.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">base</code>: memory location of the first byte of output, as a NativePointer</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">code</code>: memory location of the next byte of output, as a NativePointer</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">pc</code>: program counter at the next byte of output, as a NativePointer</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">offset</code>: current offset as a JavaScript Number</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">skip(nBytes)</code>: skip <code class="language-plaintext highlighter-rouge">nBytes</code></p>
  </li>
  <li>
    <p id="arm64writer-putlabel"><code class="language-plaintext highlighter-rouge">putLabel(id)</code>: put a label at the current position, where <code class="language-plaintext highlighter-rouge">id</code> is a string
that may be referenced in past and future <code class="language-plaintext highlighter-rouge">put*Label()</code> calls</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallAddressWithArguments(func, args)</code>: put code needed for calling a C
function with the specified <code class="language-plaintext highlighter-rouge">args</code>, specified as a JavaScript array where
each element is either a string specifying the register, or a Number or
<strong><a href="#nativepointer">NativePointer</a></strong> specifying the immediate value.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallRegWithArguments(reg, args)</code>: put code needed for calling a C
function with the specified <code class="language-plaintext highlighter-rouge">args</code>, specified as a JavaScript array where
each element is either a string specifying the register, or a Number or
<strong><a href="#nativepointer">NativePointer</a></strong> specifying the immediate value.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBranchAddress(address)</code>: put code needed for branching/jumping to the
given address</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">canBranchDirectlyBetween(from, to)</code>: determine whether a direct branch is
possible between the two given memory locations</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBImm(address)</code>: put a B instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBLabel(labelId)</code>: put a B instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#arm64writer-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBCondLabel(cc, labelId)</code>: put a B COND instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#arm64writer-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBlImm(address)</code>: put a BL instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBlLabel(labelId)</code>: put a BL instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#arm64writer-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBrReg(reg)</code>: put a BR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBrRegNoAuth(reg)</code>: put a BR instruction expecting a raw pointer
without any authentication bits</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBlrReg(reg)</code>: put a BLR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBlrRegNoAuth(reg)</code>: put a BLR instruction expecting a raw pointer
without any authentication bits</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putRet()</code>: put a RET instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCbzRegLabel(reg, labelId)</code>: put a CBZ instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#arm64writer-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCbnzRegLabel(reg, labelId)</code>: put a CBNZ instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#arm64writer-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putTbzRegImmLabel(reg, bit, labelId)</code>: put a TBZ instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#arm64writer-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putTbnzRegImmLabel(reg, bit, labelId)</code>: put a TBNZ instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#arm64writer-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPushRegReg(regA, regB)</code>: put a PUSH instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPopRegReg(regA, regB)</code>: put a POP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPushAllXRegisters()</code>: put code needed for pushing all X registers on the stack</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPopAllXRegisters()</code>: put code needed for popping all X registers off the stack</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPushAllQRegisters()</code>: put code needed for pushing all Q registers on the stack</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPopAllQRegisters()</code>: put code needed for popping all Q registers off the stack</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdrRegAddress(reg, address)</code>: put an LDR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdrRegU64(reg, val)</code>: put an LDR instruction</p>
  </li>
  <li>
    <p id="arm64writer-putldrregref"><code class="language-plaintext highlighter-rouge">putLdrRegRef(reg)</code>: put an LDR instruction with a dangling data reference,
returning an opaque ref value that should be passed to <a href="#arm64writer-putldrregvalue"><code class="language-plaintext highlighter-rouge">putLdrRegValue()</code></a>
at the desired location</p>
  </li>
  <li>
    <p id="arm64writer-putldrregvalue"><code class="language-plaintext highlighter-rouge">putLdrRegValue(ref, value)</code>: put the value and update the LDR instruction
from a previous <a href="#arm64writer-putldrregref"><code class="language-plaintext highlighter-rouge">putLdrRegRef()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdrRegRegOffset(dstReg, srcReg, srcOffset)</code>: put an LDR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdrswRegRegOffset(dstReg, srcReg, srcOffset)</code>: put an LDRSW instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAdrpRegAddress(reg, address)</code>: put an ADRP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putStrRegRegOffset(srcReg, dstReg, dstOffset)</code>: put a STR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdpRegRegRegOffset(regA, regB, regSrc, srcOffset, mode)</code>: put an LDP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putStpRegRegRegOffset(regA, regB, regDst, dstOffset, mode)</code>: put a STP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMovRegReg(dstReg, srcReg)</code>: put a MOV instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putUxtwRegReg(dstReg, srcReg)</code>: put an UXTW instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddRegRegImm(dstReg, leftReg, rightValue)</code>: put an ADD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddRegRegReg(dstReg, leftReg, rightReg)</code>: put an ADD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putSubRegRegImm(dstReg, leftReg, rightValue)</code>: put a SUB instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putSubRegRegReg(dstReg, leftReg, rightReg)</code>: put a SUB instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAndRegRegImm(dstReg, leftReg, rightValue)</code>: put an AND instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putTstRegImm(reg, immValue)</code>: put a TST instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCmpRegReg(regA, regB)</code>: put a CMP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putXpaciReg(reg)</code>: put an XPACI instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putNop()</code>: put a NOP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBrkImm(imm)</code>: put a BRK instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putInstruction(insn)</code>: put a raw instruction as a JavaScript Number</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBytes(data)</code>: put raw data from the provided <strong><a href="#arraybuffer">ArrayBuffer</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">sign(value)</code>: sign the given pointer value</p>
  </li>
</ul>

<h3 id="arm64relocator">Arm64Relocator</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new Arm64Relocator(inputCode, output)</code>: create a new code relocator for
copying AArch64 instructions from one memory location to another, taking
care to adjust position-dependent instructions accordingly.
The source address is specified by <code class="language-plaintext highlighter-rouge">inputCode</code>, a <strong><a href="#nativepointer">NativePointer</a></strong>.
The destination is given by <code class="language-plaintext highlighter-rouge">output</code>, an <strong><a href="#arm64writer">Arm64Writer</a></strong> pointed
at the desired target memory address.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">reset(inputCode, output)</code>: recycle instance</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dispose()</code>: eagerly clean up memory</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">input</code>: latest <strong><a href="#instruction">Instruction</a></strong> read so far. Starts out <code class="language-plaintext highlighter-rouge">null</code>
and changes on every call to <a href="#arm64relocator-readone"><code class="language-plaintext highlighter-rouge">readOne()</code></a>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">eob</code>: boolean indicating whether end-of-block has been reached, i.e. we’ve
reached a branch of any kind, like CALL, JMP, BL, RET.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">eoi</code>: boolean indicating whether end-of-input has been reached, e.g. we’ve
reached JMP/B/RET, an instruction after which there may or may not be valid
code.</p>
  </li>
  <li>
    <p id="arm64relocator-readone"><code class="language-plaintext highlighter-rouge">readOne()</code>: read the next instruction into the relocator’s internal buffer
and return the number of bytes read so far, including previous calls.
You may keep calling this method to keep buffering, or immediately call
either <a href="#arm64relocator-writeone"><code class="language-plaintext highlighter-rouge">writeOne()</code></a> or <a href="#arm64relocator-skipone"><code class="language-plaintext highlighter-rouge">skipOne()</code></a>.
Or, you can buffer up until the desired point and then call <a href="#arm64relocator-writeall"><code class="language-plaintext highlighter-rouge">writeAll()</code></a>.
Returns zero when end-of-input is reached, which means the <code class="language-plaintext highlighter-rouge">eoi</code> property is
now <code class="language-plaintext highlighter-rouge">true</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">peekNextWriteInsn()</code>: peek at the next <strong><a href="#instruction">Instruction</a></strong> to be
written or skipped</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">peekNextWriteSource()</code>: peek at the address of the next instruction to be
written or skipped</p>
  </li>
  <li>
    <p id="arm64relocator-skipone"><code class="language-plaintext highlighter-rouge">skipOne()</code>: skip the instruction that would have been written next</p>
  </li>
  <li>
    <p id="arm64relocator-writeone"><code class="language-plaintext highlighter-rouge">writeOne()</code>: write the next buffered instruction</p>
  </li>
  <li>
    <p id="arm64relocator-writeall"><code class="language-plaintext highlighter-rouge">writeAll()</code>: write all buffered instructions</p>
  </li>
</ul>

<h3 id="aarch64-enum-types">AArch64 enum types</h3>

<ul>
  <li>Register: <code class="language-plaintext highlighter-rouge">x0</code> <code class="language-plaintext highlighter-rouge">x1</code> <code class="language-plaintext highlighter-rouge">x2</code> <code class="language-plaintext highlighter-rouge">x3</code> <code class="language-plaintext highlighter-rouge">x4</code> <code class="language-plaintext highlighter-rouge">x5</code> <code class="language-plaintext highlighter-rouge">x6</code> <code class="language-plaintext highlighter-rouge">x7</code> <code class="language-plaintext highlighter-rouge">x8</code> <code class="language-plaintext highlighter-rouge">x9</code> <code class="language-plaintext highlighter-rouge">x10</code> <code class="language-plaintext highlighter-rouge">x11</code>
<code class="language-plaintext highlighter-rouge">x12</code> <code class="language-plaintext highlighter-rouge">x13</code> <code class="language-plaintext highlighter-rouge">x14</code> <code class="language-plaintext highlighter-rouge">x15</code> <code class="language-plaintext highlighter-rouge">x16</code> <code class="language-plaintext highlighter-rouge">x17</code> <code class="language-plaintext highlighter-rouge">x18</code> <code class="language-plaintext highlighter-rouge">x19</code> <code class="language-plaintext highlighter-rouge">x20</code> <code class="language-plaintext highlighter-rouge">x21</code> <code class="language-plaintext highlighter-rouge">x22</code> <code class="language-plaintext highlighter-rouge">x23</code>
<code class="language-plaintext highlighter-rouge">x24</code> <code class="language-plaintext highlighter-rouge">x25</code> <code class="language-plaintext highlighter-rouge">x26</code> <code class="language-plaintext highlighter-rouge">x27</code> <code class="language-plaintext highlighter-rouge">x28</code> <code class="language-plaintext highlighter-rouge">x29</code> <code class="language-plaintext highlighter-rouge">x30</code> <code class="language-plaintext highlighter-rouge">w0</code> <code class="language-plaintext highlighter-rouge">w1</code> <code class="language-plaintext highlighter-rouge">w2</code> <code class="language-plaintext highlighter-rouge">w3</code> <code class="language-plaintext highlighter-rouge">w4</code> <code class="language-plaintext highlighter-rouge">w5</code>
<code class="language-plaintext highlighter-rouge">w6</code> <code class="language-plaintext highlighter-rouge">w7</code> <code class="language-plaintext highlighter-rouge">w8</code> <code class="language-plaintext highlighter-rouge">w9</code> <code class="language-plaintext highlighter-rouge">w10</code> <code class="language-plaintext highlighter-rouge">w11</code> <code class="language-plaintext highlighter-rouge">w12</code> <code class="language-plaintext highlighter-rouge">w13</code> <code class="language-plaintext highlighter-rouge">w14</code> <code class="language-plaintext highlighter-rouge">w15</code> <code class="language-plaintext highlighter-rouge">w16</code> <code class="language-plaintext highlighter-rouge">w17</code> <code class="language-plaintext highlighter-rouge">w18</code>
<code class="language-plaintext highlighter-rouge">w19</code> <code class="language-plaintext highlighter-rouge">w20</code> <code class="language-plaintext highlighter-rouge">w21</code> <code class="language-plaintext highlighter-rouge">w22</code> <code class="language-plaintext highlighter-rouge">w23</code> <code class="language-plaintext highlighter-rouge">w24</code> <code class="language-plaintext highlighter-rouge">w25</code> <code class="language-plaintext highlighter-rouge">w26</code> <code class="language-plaintext highlighter-rouge">w27</code> <code class="language-plaintext highlighter-rouge">w28</code> <code class="language-plaintext highlighter-rouge">w29</code> <code class="language-plaintext highlighter-rouge">w30</code>
<code class="language-plaintext highlighter-rouge">sp</code> <code class="language-plaintext highlighter-rouge">lr</code> <code class="language-plaintext highlighter-rouge">fp</code> <code class="language-plaintext highlighter-rouge">wsp</code> <code class="language-plaintext highlighter-rouge">wzr</code> <code class="language-plaintext highlighter-rouge">xzr</code> <code class="language-plaintext highlighter-rouge">nzcv</code> <code class="language-plaintext highlighter-rouge">ip0</code> <code class="language-plaintext highlighter-rouge">ip1</code> <code class="language-plaintext highlighter-rouge">s0</code> <code class="language-plaintext highlighter-rouge">s1</code> <code class="language-plaintext highlighter-rouge">s2</code> <code class="language-plaintext highlighter-rouge">s3</code>
<code class="language-plaintext highlighter-rouge">s4</code> <code class="language-plaintext highlighter-rouge">s5</code> <code class="language-plaintext highlighter-rouge">s6</code> <code class="language-plaintext highlighter-rouge">s7</code> <code class="language-plaintext highlighter-rouge">s8</code> <code class="language-plaintext highlighter-rouge">s9</code> <code class="language-plaintext highlighter-rouge">s10</code> <code class="language-plaintext highlighter-rouge">s11</code> <code class="language-plaintext highlighter-rouge">s12</code> <code class="language-plaintext highlighter-rouge">s13</code> <code class="language-plaintext highlighter-rouge">s14</code> <code class="language-plaintext highlighter-rouge">s15</code> <code class="language-plaintext highlighter-rouge">s16</code>
<code class="language-plaintext highlighter-rouge">s17</code> <code class="language-plaintext highlighter-rouge">s18</code> <code class="language-plaintext highlighter-rouge">s19</code> <code class="language-plaintext highlighter-rouge">s20</code> <code class="language-plaintext highlighter-rouge">s21</code> <code class="language-plaintext highlighter-rouge">s22</code> <code class="language-plaintext highlighter-rouge">s23</code> <code class="language-plaintext highlighter-rouge">s24</code> <code class="language-plaintext highlighter-rouge">s25</code> <code class="language-plaintext highlighter-rouge">s26</code> <code class="language-plaintext highlighter-rouge">s27</code> <code class="language-plaintext highlighter-rouge">s28</code>
<code class="language-plaintext highlighter-rouge">s29</code> <code class="language-plaintext highlighter-rouge">s30</code> <code class="language-plaintext highlighter-rouge">s31</code> <code class="language-plaintext highlighter-rouge">d0</code> <code class="language-plaintext highlighter-rouge">d1</code> <code class="language-plaintext highlighter-rouge">d2</code> <code class="language-plaintext highlighter-rouge">d3</code> <code class="language-plaintext highlighter-rouge">d4</code> <code class="language-plaintext highlighter-rouge">d5</code> <code class="language-plaintext highlighter-rouge">d6</code> <code class="language-plaintext highlighter-rouge">d7</code> <code class="language-plaintext highlighter-rouge">d8</code> <code class="language-plaintext highlighter-rouge">d9</code> <code class="language-plaintext highlighter-rouge">d10</code>
<code class="language-plaintext highlighter-rouge">d11</code> <code class="language-plaintext highlighter-rouge">d12</code> <code class="language-plaintext highlighter-rouge">d13</code> <code class="language-plaintext highlighter-rouge">d14</code> <code class="language-plaintext highlighter-rouge">d15</code> <code class="language-plaintext highlighter-rouge">d16</code> <code class="language-plaintext highlighter-rouge">d17</code> <code class="language-plaintext highlighter-rouge">d18</code> <code class="language-plaintext highlighter-rouge">d19</code> <code class="language-plaintext highlighter-rouge">d20</code> <code class="language-plaintext highlighter-rouge">d21</code> <code class="language-plaintext highlighter-rouge">d22</code>
<code class="language-plaintext highlighter-rouge">d23</code> <code class="language-plaintext highlighter-rouge">d24</code> <code class="language-plaintext highlighter-rouge">d25</code> <code class="language-plaintext highlighter-rouge">d26</code> <code class="language-plaintext highlighter-rouge">d27</code> <code class="language-plaintext highlighter-rouge">d28</code> <code class="language-plaintext highlighter-rouge">d29</code> <code class="language-plaintext highlighter-rouge">d30</code> <code class="language-plaintext highlighter-rouge">d31</code> <code class="language-plaintext highlighter-rouge">q0</code> <code class="language-plaintext highlighter-rouge">q1</code> <code class="language-plaintext highlighter-rouge">q2</code> <code class="language-plaintext highlighter-rouge">q3</code>
<code class="language-plaintext highlighter-rouge">q4</code> <code class="language-plaintext highlighter-rouge">q5</code> <code class="language-plaintext highlighter-rouge">q6</code> <code class="language-plaintext highlighter-rouge">q7</code> <code class="language-plaintext highlighter-rouge">q8</code> <code class="language-plaintext highlighter-rouge">q9</code> <code class="language-plaintext highlighter-rouge">q10</code> <code class="language-plaintext highlighter-rouge">q11</code> <code class="language-plaintext highlighter-rouge">q12</code> <code class="language-plaintext highlighter-rouge">q13</code> <code class="language-plaintext highlighter-rouge">q14</code> <code class="language-plaintext highlighter-rouge">q15</code> <code class="language-plaintext highlighter-rouge">q16</code>
<code class="language-plaintext highlighter-rouge">q17</code> <code class="language-plaintext highlighter-rouge">q18</code> <code class="language-plaintext highlighter-rouge">q19</code> <code class="language-plaintext highlighter-rouge">q20</code> <code class="language-plaintext highlighter-rouge">q21</code> <code class="language-plaintext highlighter-rouge">q22</code> <code class="language-plaintext highlighter-rouge">q23</code> <code class="language-plaintext highlighter-rouge">q24</code> <code class="language-plaintext highlighter-rouge">q25</code> <code class="language-plaintext highlighter-rouge">q26</code> <code class="language-plaintext highlighter-rouge">q27</code> <code class="language-plaintext highlighter-rouge">q28</code>
<code class="language-plaintext highlighter-rouge">q29</code> <code class="language-plaintext highlighter-rouge">q30</code> <code class="language-plaintext highlighter-rouge">q31</code></li>
  <li>ConditionCode: <code class="language-plaintext highlighter-rouge">eq</code> <code class="language-plaintext highlighter-rouge">ne</code> <code class="language-plaintext highlighter-rouge">hs</code> <code class="language-plaintext highlighter-rouge">lo</code> <code class="language-plaintext highlighter-rouge">mi</code> <code class="language-plaintext highlighter-rouge">pl</code> <code class="language-plaintext highlighter-rouge">vs</code> <code class="language-plaintext highlighter-rouge">vc</code> <code class="language-plaintext highlighter-rouge">hi</code> <code class="language-plaintext highlighter-rouge">ls</code> <code class="language-plaintext highlighter-rouge">ge</code> <code class="language-plaintext highlighter-rouge">lt</code>
<code class="language-plaintext highlighter-rouge">gt</code> <code class="language-plaintext highlighter-rouge">le</code> <code class="language-plaintext highlighter-rouge">al</code> <code class="language-plaintext highlighter-rouge">nv</code></li>
  <li>IndexMode: <code class="language-plaintext highlighter-rouge">post-adjust</code> <code class="language-plaintext highlighter-rouge">signed-offset</code> <code class="language-plaintext highlighter-rouge">pre-adjust</code></li>
</ul>

<h3 id="mipswriter">MipsWriter</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new MipsWriter(codeAddress[, { pc: ptr('0x1234') }])</code>: create a new code
writer for generating MIPS machine code written directly to memory at
<code class="language-plaintext highlighter-rouge">codeAddress</code>, specified as a <strong><a href="#nativepointer">NativePointer</a></strong>.
The second argument is an optional options object where the initial program
counter may be specified, which is useful when generating code to a scratch
buffer. This is essential when using <a href="#memory-patchcode"><code class="language-plaintext highlighter-rouge">Memory.patchCode()</code></a>
on iOS, which may provide you with a temporary location that later gets mapped
into memory at the intended memory location.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">reset(codeAddress[, { pc: ptr('0x1234') }])</code>: recycle instance</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dispose()</code>: eagerly clean up memory</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">flush()</code>: resolve label references and write pending data to memory. You
should always call this once you’ve finished generating code. It is usually
also desirable to do this between pieces of unrelated code, e.g. when
generating multiple functions in one go.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">base</code>: memory location of the first byte of output, as a <strong><a href="#nativepointer">NativePointer</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">code</code>: memory location of the next byte of output, as a <strong><a href="#nativepointer">NativePointer</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">pc</code>: program counter at the next byte of output, as a <strong><a href="#nativepointer">NativePointer</a></strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">offset</code>: current offset as a JavaScript Number</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">skip(nBytes)</code>: skip <code class="language-plaintext highlighter-rouge">nBytes</code></p>
  </li>
  <li>
    <p id="mipswriter-putlabel"><code class="language-plaintext highlighter-rouge">putLabel(id)</code>: put a label at the current position, where <code class="language-plaintext highlighter-rouge">id</code> is a string
that may be referenced in past and future <code class="language-plaintext highlighter-rouge">put*Label()</code> calls</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallAddressWithArguments(func, args)</code>: put code needed for calling a C
function with the specified <code class="language-plaintext highlighter-rouge">args</code>, specified as a JavaScript array where
each element is either a string specifying the register, or a Number or
<strong><a href="#nativepointer">NativePointer</a></strong> specifying the immediate value.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putCallRegWithArguments(reg, args)</code>: put code needed for calling a C
function with the specified <code class="language-plaintext highlighter-rouge">args</code>, specified as a JavaScript array where
each element is either a string specifying the register, or a Number or
<strong><a href="#nativepointer">NativePointer</a></strong> specifying the immediate value.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJAddress(address)</code>: put a J instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJAddressWithoutNop(address)</code>: put a J WITHOUT NOP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJLabel(labelId)</code>: put a J instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#mipswriter-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJrReg(reg)</code>: put a JR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJalAddress(address)</code>: put a JAL instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putJalrReg(reg)</code>: put a JALR instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBOffset(offset)</code>: put a B instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBeqRegRegLabel(rightReg, leftReg, labelId)</code>: put a BEQ instruction
referencing <code class="language-plaintext highlighter-rouge">labelId</code>, defined by a past or future <a href="#mipswriter-putlabel"><code class="language-plaintext highlighter-rouge">putLabel()</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putRet()</code>: put a RET instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLaRegAddress(reg, address)</code>: put a LA instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLuiRegImm(reg, imm)</code>: put a LUI instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putDsllRegReg(dstReg, srcReg, amount)</code>: put a DSLL instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putOriRegRegImm(rt, rs, imm)</code>: put an ORI instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLdRegRegOffset(dstReg, srcReg, srcOffset)</code>: put an LD instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putLwRegRegOffset(dstReg, srcReg, srcOffset)</code>: put a LW instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putSwRegRegOffset(srcReg, dstReg, dstOffset)</code>: put a SW instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMoveRegReg(dstReg, srcReg)</code>: put a MOVE instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAdduRegRegReg(dstReg, leftReg, rightReg)</code>: put an ADDU instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddiRegRegImm(dstReg, leftReg, imm)</code>: put an ADDI instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putAddiRegImm(dstReg, imm)</code>: put an ADDI instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putSubRegRegImm(dstReg, leftReg, imm)</code>: put a SUB instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPushReg(reg)</code>: put a PUSH instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPopReg(reg)</code>: put a POP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMfhiReg(reg)</code>: put a MFHI instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMfloReg(reg)</code>: put a MFLO instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMthiReg(reg)</code>: put a MTHI instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putMtloReg(reg)</code>: put a MTLO instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putNop()</code>: put a NOP instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBreak()</code>: put a BREAK instruction</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putPrologueTrampoline(reg, address)</code>: put a minimal sized trampoline for
vectoring to the given address</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putInstruction(insn)</code>: put a raw instruction as a JavaScript Number</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">putBytes(data)</code>: put raw data from the provided <strong><a href="#arraybuffer">ArrayBuffer</a></strong></p>
  </li>
</ul>

<h3 id="mipsrelocator">MipsRelocator</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">new MipsRelocator(inputCode, output)</code>: create a new code relocator for
copying MIPS instructions from one memory location to another, taking
care to adjust position-dependent instructions accordingly.
The source address is specified by <code class="language-plaintext highlighter-rouge">inputCode</code>, a <strong><a href="#nativepointer">NativePointer</a></strong>.
The destination is given by <code class="language-plaintext highlighter-rouge">output</code>, a <strong><a href="#mipswriter">MipsWriter</a></strong> pointed
at the desired target memory address.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">reset(inputCode, output)</code>: recycle instance</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dispose()</code>: eagerly clean up memory</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">input</code>: latest <strong><a href="#instruction">Instruction</a></strong> read so far. Starts out <code class="language-plaintext highlighter-rouge">null</code>
and changes on every call to <a href="#mipsrelocator-readone"><code class="language-plaintext highlighter-rouge">readOne()</code></a>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">eob</code>: boolean indicating whether end-of-block has been reached, i.e. we’ve
reached a branch of any kind, like CALL, JMP, BL, RET.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">eoi</code>: boolean indicating whether end-of-input has been reached, e.g. we’ve
reached JMP/B/RET, an instruction after which there may or may not be valid
code.</p>
  </li>
  <li>
    <p id="mipsrelocator-readone"><code class="language-plaintext highlighter-rouge">readOne()</code>: read the next instruction into the relocator’s internal buffer
and return the number of bytes read so far, including previous calls.
You may keep calling this method to keep buffering, or immediately call
either <a href="#mipsrelocator-writeone"><code class="language-plaintext highlighter-rouge">writeOne()</code></a> or <a href="#mipsrelocator-skipone"><code class="language-plaintext highlighter-rouge">skipOne()</code></a>.
Or, you can buffer up until the desired point and then call <a href="#mipsrelocator-writeall"><code class="language-plaintext highlighter-rouge">writeAll()</code></a>.
Returns zero when end-of-input is reached, which means the <code class="language-plaintext highlighter-rouge">eoi</code> property is
now <code class="language-plaintext highlighter-rouge">true</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">peekNextWriteInsn()</code>: peek at the next <strong><a href="#instruction">Instruction</a></strong> to be
written or skipped</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">peekNextWriteSource()</code>: peek at the address of the next instruction to be
written or skipped</p>
  </li>
  <li>
    <p id="mipsrelocator-skipone"><code class="language-plaintext highlighter-rouge">skipOne()</code>: skip the instruction that would have been written next</p>
  </li>
  <li>
    <p id="mipsrelocator-writeone"><code class="language-plaintext highlighter-rouge">writeOne()</code>: write the next buffered instruction</p>
  </li>
  <li>
    <p id="mipsrelocator-writeall"><code class="language-plaintext highlighter-rouge">writeAll()</code>: write all buffered instructions</p>
  </li>
</ul>

<h3 id="mips-enum-types">MIPS enum types</h3>

<ul>
  <li>Register: <code class="language-plaintext highlighter-rouge">v0</code> <code class="language-plaintext highlighter-rouge">v1</code> <code class="language-plaintext highlighter-rouge">a0</code> <code class="language-plaintext highlighter-rouge">a1</code> <code class="language-plaintext highlighter-rouge">a2</code> <code class="language-plaintext highlighter-rouge">a3</code> <code class="language-plaintext highlighter-rouge">t0</code> <code class="language-plaintext highlighter-rouge">t1</code> <code class="language-plaintext highlighter-rouge">t2</code> <code class="language-plaintext highlighter-rouge">t3</code> <code class="language-plaintext highlighter-rouge">t4</code> <code class="language-plaintext highlighter-rouge">t5</code> <code class="language-plaintext highlighter-rouge">t6</code>
<code class="language-plaintext highlighter-rouge">t7</code> <code class="language-plaintext highlighter-rouge">s0</code> <code class="language-plaintext highlighter-rouge">s1</code> <code class="language-plaintext highlighter-rouge">s2</code> <code class="language-plaintext highlighter-rouge">s3</code> <code class="language-plaintext highlighter-rouge">s4</code> <code class="language-plaintext highlighter-rouge">s5</code> <code class="language-plaintext highlighter-rouge">s6</code> <code class="language-plaintext highlighter-rouge">s7</code> <code class="language-plaintext highlighter-rouge">t8</code> <code class="language-plaintext highlighter-rouge">t9</code> <code class="language-plaintext highlighter-rouge">k0</code> <code class="language-plaintext highlighter-rouge">k1</code> <code class="language-plaintext highlighter-rouge">gp</code> <code class="language-plaintext highlighter-rouge">sp</code>
<code class="language-plaintext highlighter-rouge">fp</code> <code class="language-plaintext highlighter-rouge">s8</code> <code class="language-plaintext highlighter-rouge">ra</code> <code class="language-plaintext highlighter-rouge">hi</code> <code class="language-plaintext highlighter-rouge">lo</code> <code class="language-plaintext highlighter-rouge">zero</code> <code class="language-plaintext highlighter-rouge">at</code> <code class="language-plaintext highlighter-rouge">0</code> <code class="language-plaintext highlighter-rouge">1</code> <code class="language-plaintext highlighter-rouge">2</code> <code class="language-plaintext highlighter-rouge">3</code> <code class="language-plaintext highlighter-rouge">4</code> <code class="language-plaintext highlighter-rouge">5</code> <code class="language-plaintext highlighter-rouge">6</code> <code class="language-plaintext highlighter-rouge">7</code> <code class="language-plaintext highlighter-rouge">8</code>
<code class="language-plaintext highlighter-rouge">9</code> <code class="language-plaintext highlighter-rouge">10</code> <code class="language-plaintext highlighter-rouge">11</code> <code class="language-plaintext highlighter-rouge">12</code> <code class="language-plaintext highlighter-rouge">13</code> <code class="language-plaintext highlighter-rouge">14</code> <code class="language-plaintext highlighter-rouge">15</code> <code class="language-plaintext highlighter-rouge">16</code> <code class="language-plaintext highlighter-rouge">17</code> <code class="language-plaintext highlighter-rouge">18</code> <code class="language-plaintext highlighter-rouge">19</code> <code class="language-plaintext highlighter-rouge">20</code> <code class="language-plaintext highlighter-rouge">21</code> <code class="language-plaintext highlighter-rouge">22</code> <code class="language-plaintext highlighter-rouge">23</code>
<code class="language-plaintext highlighter-rouge">24</code> <code class="language-plaintext highlighter-rouge">25</code> <code class="language-plaintext highlighter-rouge">26</code> <code class="language-plaintext highlighter-rouge">27</code> <code class="language-plaintext highlighter-rouge">28</code> <code class="language-plaintext highlighter-rouge">29</code> <code class="language-plaintext highlighter-rouge">30</code> <code class="language-plaintext highlighter-rouge">31</code></li>
</ul>

<hr />

<h2 id="others">Others</h2>

<h3 id="console">Console</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">console.log(line)</code>, <code class="language-plaintext highlighter-rouge">console.warn(line)</code>, <code class="language-plaintext highlighter-rouge">console.error(line)</code>:
write <code class="language-plaintext highlighter-rouge">line</code> to the console of your Frida-based application. The exact
behavior depends on where <a href="https://github.com/frida/frida-core">frida-core</a>
is integrated.
For example, this output goes to <em>stdout</em> or <em>stderr</em> when using Frida
through <a href="https://github.com/frida/frida-python">frida-python</a>,
<strong><a href="https://doc.qt.io/qt-5/qdebug.html">qDebug</a></strong> when using
<strong><a href="https://github.com/frida/frida-qml">frida-qml</a></strong>, etc.</p>

    <p>Arguments that are <strong><a href="#arraybuffer">ArrayBuffer</a></strong> objects will be substituted by
the result of <a href="#hexdump"><code class="language-plaintext highlighter-rouge">hexdump()</code></a> with default options.</p>
  </li>
</ul>

<h3 id="hexdump">Hexdump</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">hexdump(target[, options])</code>: generate a hexdump from the provided
<strong><a href="#arraybuffer">ArrayBuffer</a></strong> or <a href="#nativepointer">NativePointer</a> <code class="language-plaintext highlighter-rouge">target</code>,
optionally with <code class="language-plaintext highlighter-rouge">options</code> for customizing the output.</p>

    <p>For example:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">libc</span> <span class="o">=</span> <span class="nx">Module</span><span class="p">.</span><span class="nx">findBaseAddress</span><span class="p">(</span><span class="dl">'</span><span class="s1">libc.so</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">hexdump</span><span class="p">(</span><span class="nx">libc</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">offset</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="na">length</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
  <span class="na">header</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">ansi</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}));</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">           0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF
00000000  7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00  .ELF............
00000010  03 00 28 00 01 00 00 00 00 00 00 00 34 00 00 00  ..<span class="o">(</span>.........4...
00000020  34 a8 04 00 00 00 00 05 34 00 20 00 08 00 28 00  4.......4. ...<span class="o">(</span><span class="nb">.</span>
00000030  1e 00 1d 00 06 00 00 00 34 00 00 00 34 00 00 00  ........4...4...</code></pre></figure>

<h3 id="shorthand">Shorthand</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">int64(v)</code>: short-hand for <a href="#int64"><code class="language-plaintext highlighter-rouge">new Int64(v)</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">uint64(v)</code>: short-hand for <a href="#uint64"><code class="language-plaintext highlighter-rouge">new UInt64(v)</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ptr(s)</code>: short-hand for <a href="#nativepointer"><code class="language-plaintext highlighter-rouge">new NativePointer(s)</code></a></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">NULL</code>: short-hand for <code class="language-plaintext highlighter-rouge">ptr("0")</code></p>
  </li>
</ul>

<h3 id="communication-between-host-and-injected-process">Communication between host and injected process</h3>

<ul>
  <li>
    <p id="communication-recv"><code class="language-plaintext highlighter-rouge">recv([type, ]callback)</code>: request <code class="language-plaintext highlighter-rouge">callback</code> to be called on the next
message received from your Frida-based application. Optionally <code class="language-plaintext highlighter-rouge">type</code> may
be specified to only receive a message where the <code class="language-plaintext highlighter-rouge">type</code> field is set to
<code class="language-plaintext highlighter-rouge">type</code>.</p>

    <p>This will only give you one message, so you need to call <code class="language-plaintext highlighter-rouge">recv()</code> again
to receive the next one.</p>
  </li>
  <li>
    <p id="communication-send"><code class="language-plaintext highlighter-rouge">send(message[, data])</code>: send the JavaScript object <code class="language-plaintext highlighter-rouge">message</code> to your
Frida-based application (it must be serializable to JSON). If you also have
some raw binary data that you’d like to send along with it, e.g. you dumped
some memory using <a href="#nativepointer-readbytearray"><code class="language-plaintext highlighter-rouge">NativePointer#readByteArray</code></a>,
then you may pass this through the optional <code class="language-plaintext highlighter-rouge">data</code> argument. This requires it to
either be an <strong><a href="#arraybuffer">ArrayBuffer</a></strong> or an array of integers between
0 and 255.</p>

    <div class="note">
<h5>Performance considerations</h5>
<p>
    While <i>send()</i> is asynchronous, the total overhead of sending a single
    message is not optimized for high frequencies, so that means Frida leaves
    it up to you to batch multiple values into a single <i>send()</i>-call,
    based on whether low delay or high throughput is desired.
</p>
</div>
  </li>
  <li>
    <p id="rpc-exports"><code class="language-plaintext highlighter-rouge">rpc.exports</code>: empty object that you can either replace or insert into to
expose an RPC-style API to your application. The key specifies the method
name and the value is your exported function. This function may either
return a plain value for returning that to the caller immediately, or a
Promise for returning asynchronously.</p>
  </li>
</ul>

<blockquote>
  <p>For example:</p>
</blockquote>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">rpc</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">sub</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">(</span><span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span><span class="p">);</span>
      <span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span></code></pre></figure>

<blockquote>
  <p>From an application using the Node.js bindings this API would be consumed
  like this:</p>
</blockquote>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">frida</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">frida</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">util</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">util</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">readFile</span> <span class="o">=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">promisify</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">session</span><span class="p">,</span> <span class="nx">script</span><span class="p">;</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">readFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">_agent.js</span><span class="dl">'</span><span class="p">),</span> <span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">session</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">frida</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="dl">'</span><span class="s1">iTunes</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">script</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">session</span><span class="p">.</span><span class="nx">createScript</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>
  <span class="nx">script</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">onMessage</span><span class="p">);</span>
  <span class="k">await</span> <span class="nx">script</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">await</span> <span class="nx">script</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">await</span> <span class="nx">script</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">sub</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
<span class="p">}</span>

<span class="nx">run</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">onError</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">onError</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">onMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">send</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">payload</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<blockquote>
  <p>The Python version would be very similar:</p>
</blockquote>

<figure class="highlight"><pre><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">frida</span>

<span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">message</span><span class="p">[</span><span class="s">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'send'</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s">'payload'</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">message</span><span class="p">[</span><span class="s">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'error'</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s">'stack'</span><span class="p">])</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">frida</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="s">'iTunes'</span><span class="p">)</span>
<span class="k">with</span> <span class="n">codecs</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'./agent.js'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">,</span> <span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">script</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">create_script</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<span class="n">script</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">'message'</span><span class="p">,</span> <span class="n">on_message</span><span class="p">)</span>
<span class="n">script</span><span class="p">.</span><span class="n">load</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">script</span><span class="p">.</span><span class="n">exports</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">script</span><span class="p">.</span><span class="n">exports</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">session</span><span class="p">.</span><span class="n">detach</span><span class="p">()</span></code></pre></figure>

<p>In the example above we used <code class="language-plaintext highlighter-rouge">script.on('message', on_message)</code> to monitor for
any messages from the injected process, JavaScript side.  There are other
notifications that you can watch for as well on both the <code class="language-plaintext highlighter-rouge">script</code> and <code class="language-plaintext highlighter-rouge">session</code>.
If you want to be notified when the target process exits, use
<code class="language-plaintext highlighter-rouge">session.on('detached', your_function)</code>.</p>

<h3 id="timing-events">Timing events</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">setTimeout(func, delay[, ...parameters])</code>: call <code class="language-plaintext highlighter-rouge">func</code> after <code class="language-plaintext highlighter-rouge">delay</code>
milliseconds, optionally passing it one or more <code class="language-plaintext highlighter-rouge">parameters</code>.
Returns an id that can be passed to <code class="language-plaintext highlighter-rouge">clearTimeout</code> to cancel it.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">clearTimeout(id)</code>: cancel id returned by call to <code class="language-plaintext highlighter-rouge">setTimeout</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">setInterval(func, delay[, ...parameters])</code>: call <code class="language-plaintext highlighter-rouge">func</code> every <code class="language-plaintext highlighter-rouge">delay</code>
milliseconds, optionally passing it one or more <code class="language-plaintext highlighter-rouge">parameters</code>.
Returns an id that can be passed to <code class="language-plaintext highlighter-rouge">clearInterval</code> to cancel it.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">clearInterval(id)</code>: cancel id returned by call to <code class="language-plaintext highlighter-rouge">setInterval</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">setImmediate(func[, ...parameters])</code>: schedules <code class="language-plaintext highlighter-rouge">func</code> to be called on
Frida’s JavaScript thread as soon as possible, optionally passing it one
or more <code class="language-plaintext highlighter-rouge">parameters</code>.
Returns an id that can be passed to <code class="language-plaintext highlighter-rouge">clearImmediate</code> to cancel it.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">clearImmediate(id)</code>: cancel id returned by call to <code class="language-plaintext highlighter-rouge">setImmediate</code>.</p>
  </li>
</ul>

<h3 id="garbage-collection">Garbage collection</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">gc()</code>: force garbage collection. Useful for testing, especially logic
involving <a href="#bindweak"><code class="language-plaintext highlighter-rouge">Script.bindWeak()</code></a>.</li>
</ul>


            <!-- / Window Content-->
		</div>
	</div>

	<script type="text/javascript">
    // Close dialog, make no changes to the device
    document.getElementById("CloseDevice").onclick = function () {
    	window.close();
    }

    // Implement custom search using "window.find"
    // --> Yes this is rubbish, .. but more hacking less JS please
    function docSearch() {
      var searchTerm = document.getElementById("FridaDocSearch");
      if (searchTerm.value && searchTerm.value.length > 0) {
        findString(searchTerm.value);
        s = window.getSelection();
        oRange = s.getRangeAt(0);
        oRect = oRange.getBoundingClientRect();
        if (oRect.top != 0 && oRect.bottom != 0) {
          document.getElementById("DataContainer").scrollTop = document.getElementById("DataContainer").scrollTop + oRect.top - 400;
        }
      }
    }

    // Also trigger search on enter
    document.addEventListener("keydown", function (e) {
    	if (e.keyCode == 13) {
    		e.preventDefault();
    		docSearch();
    	}
    }, false);

    function findString(str) {
      var bFound = window.find(str, false, false, true);
      if (bFound) {
        return true;
      } else {
        return false;
      }
        }
	</script>
</body>

</html>